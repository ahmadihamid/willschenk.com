<!DOCTYPE html>
<html class='no-js'>
  <head>
    <meta charset='utf-8'>
    <meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
    <title>Bot Design Patterns | Blank Page Tech</title>
    <meta name="site" content="Blank Page Tech" />
    <meta name="og:site_name" content="Blank Page Tech" />
    <meta name="title" content="Bot Design Patterns" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Bot Design Patterns" />
    <meta name="twitter:site" content="@wschenk" />
    <meta name="og:title" content="Bot Design Patterns" />
    <meta content='width=device-width' name='viewport'>
    <link href="../stylesheets/application-25f4f7e0.css" rel="stylesheet" type="text/css" /><link href="../stylesheets/webicons-da5ecace.css" rel="stylesheet" type="text/css" /><link href="../stylesheets/socicons-d8ab83dd.css" rel="stylesheet" type="text/css" /><link href="../stylesheets/animate-8335fea6.css" rel="stylesheet" type="text/css" /><link href="../stylesheets/googlecode-d3629bf4.css" rel="stylesheet" type="text/css" />
    <link href='//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.3/styles/default.min.css' rel='stylesheet'>
    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />
  </head>
  <body data-spy='scroll' data-target='.sidebar'>
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">
      <div class='visible-xs-block'>
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapsable">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a href="/" class="navbar-brand">
        Blank Page Tech
      </a>
        
      </div>
    </div>
    <div class='hidden-xs'>
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapsable">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a href="/" class="navbar-brand">
        Technology for the blank page
      </a>
        
      </div>
    </div>
    <div class="collapse navbar-collapse" id="navbar-collapsable">
      <ul class="nav navbar-nav navbar-right foo" id="menu">
      <li>
      <a href="/articles/">
        Articles
      </a>
    </li>
    <li class="dropdown">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown">Topics <b class="caret"></b></a>
      <ul class="dropdown-menu">
        <li>
      <a href="/tags/howto/">
        Howtos
      </a>
    </li>
    <li>
      <a href="/tags/overview/">
        Overviews
      </a>
    </li>
    <li>
      <a href="/tags/product/">
        Product
      </a>
    </li>
    <li>
      <a href="/tags/tools/">
        Tools
      </a>
    </li>
    <li>
      <a href="/tags/socialinvestigator/">
        Social Investigator
      </a>
    </li>
    <li>
      <a href="/tags/ruby/">
        Ruby & Rails
      </a>
    </li>
    
      </ul>
    </li>
    <li class="dropdown">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tags <b class="caret"></b></a>
      <ul class="dropdown-menu">
        <li>
      <a href="/bootstrap-advanced-grid-tricks/">
        bootstrap (1)
      </a>
    </li>
    <li>
      <a href="/tags/bots/">
        bots (2)
      </a>
    </li>
    <li>
      <a href="/using-rake-for-dataflow-programming-and-data-science/">
        data (1)
      </a>
    </li>
    <li>
      <a href="/osx-script-for-kiosk-mode/">
        gaze (1)
      </a>
    </li>
    <li>
      <a href="/pulling-data-out-of-google-analytics/">
        googleanalytics (1)
      </a>
    </li>
    <li>
      <a href="/tags/happy_seed/">
        happy_seed (3)
      </a>
    </li>
    <li>
      <a href="/tags/howto/">
        howto (15)
      </a>
    </li>
    <li>
      <a href="/bower-with-rails/">
        javascript (1)
      </a>
    </li>
    <li>
      <a href="/tags/middleman/">
        middleman (5)
      </a>
    </li>
    <li>
      <a href="/setting-up-devise-with-twitter-and-facebook-and-other-omniauth-schemes-without-email-addresses/">
        oauth (1)
      </a>
    </li>
    <li>
      <a href="/tags/osx/">
        osx (2)
      </a>
    </li>
    <li>
      <a href="/tags/overview/">
        overview (4)
      </a>
    </li>
    <li>
      <a href="/tags/product/">
        product (2)
      </a>
    </li>
    <li>
      <a href="/tags/rails/">
        rails (4)
      </a>
    </li>
    <li>
      <a href="/using-rake-for-dataflow-programming-and-data-science/">
        rake (1)
      </a>
    </li>
    <li>
      <a href="/how-to-track-your-coworkers/">
        redis (1)
      </a>
    </li>
    <li>
      <a href="/tags/ruby/">
        ruby (15)
      </a>
    </li>
    <li>
      <a href="/tags/socialinvestigator/">
        socialinvestigator (4)
      </a>
    </li>
    <li>
      <a href="/dateslice-writing-rails-extensions/">
        sql (1)
      </a>
    </li>
    <li>
      <a href="/field-of-dreams-is-25-years-old-and-hasn-t-aged-well/">
        startupmyths (1)
      </a>
    </li>
    <li>
      <a href="/slow-data-and-fast-sites/">
        static_sites (1)
      </a>
    </li>
    <li>
      <a href="/setting-up-testing/">
        testing (1)
      </a>
    </li>
    <li>
      <a href="/making-a-command-line-utility-with-gems-and-thor/">
        thor (1)
      </a>
    </li>
    <li>
      <a href="/tags/tools/">
        tools (5)
      </a>
    </li>
    <li>
      <a href="/tags/toys/">
        toys (3)
      </a>
    </li>
    
      </ul>
    </li>
    <li class="dropdown">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown">Archives <b class="caret"></b></a>
      <ul class="dropdown-menu">
        <li>
      <a href="/bower-with-rails/">
        Jul 2015 (1)
      </a>
    </li>
    <li>
      <a href="/adding-search-to-a-middleman-blog/">
        Jun 2015 (1)
      </a>
    </li>
    <li>
      <a href="/2015/05/">
        May 2015 (2)
      </a>
    </li>
    <li>
      <a href="/why-engineers-build-crappy-products/">
        Feb 2015 (1)
      </a>
    </li>
    <li>
      <a href="/2015/01/">
        Jan 2015 (2)
      </a>
    </li>
    <li>
      <a href="/2014/12/">
        Dec 2014 (5)
      </a>
    </li>
    <li>
      <a href="/2014/11/">
        Nov 2014 (10)
      </a>
    </li>
    <li>
      <a href="/how-to-track-your-coworkers/">
        Oct 2014 (1)
      </a>
    </li>
    
      </ul>
    </li>
    
    </ul>
    <form class='navbar-form navbar-right' id='search' role='search'>
      <div class='form-group dropdown'>
        <div class='input-group'>
          <input autocomplete='off' class='form-control' id='search_box' placeholder='Search' type='text'>
          <span class='input-group-btn'>
            <button class='btn btn-default'>
              <span class='glyphicon glyphicon-search'></span>
            </button>
          </span>
        </div>
        <ul class='dropdown-menu dropdown-menu-left results'>
          <a href="/url">Title</a>
        </ul>
      </div>
    </form>
    
    </div>
    
    </div>
    </nav>
    <div class='article-header  '>
      <h1>Bot Design Patterns</h1>
      <h2>different ways to make different bots</h2>
      <div class='tags'>
        <div class='tag'><a class="btn btn-primary" href="/tags/bots/">bots</a></div>
        <div class='tag'><a class="btn btn-primary" href="/tags/overview/">overview</a></div>
      </div>
      <a href='#comment_shower' id='comment_shower_scroll'>
        <span class='disqus-comment-count' data-disqus-identifier='2014-11-11-bot-design-patterns.html'></span>
      </a>
    </div>
    <div class='content'>
      <div class='row'>
        <div class='sidebar'>
          <ul class='nav toc' data-offset-top='400' data-spy='affix'>
            <li><a href="#top">Bot Design Patterns</a></li>
            <li><a href="#notifiers">Notifiers</a></li>
            <li><a href="#reactors">Reactors</a></li>
            <li><a href="#message-dispatching">Message Dispatching</a></li>
            <li><a href="#space-reactors">Space Reactors</a></li>
            <li><a href="#responders">Responders</a></li>
            <li><a href="#space-responders">Space Responders</a></li>
            <li><a href="#conversationists">Conversationists</a></li>
            <li><a href="#thats-the-shape-of-it">Thats the shape of it</a></li>
            <li><a href="#towards-a-taxonomy-of-twitter-bots">Towards a taxonomy of Twitter Bots</a></li>
            <li><a href="#hubot-from-github-is-a-company-chat-bot-written-in-node">Hubot from Github is a company chat bot written in Node</a></li>
            <li><a href="#lita-is-similar-to-hubot-but-written-in-ruby">Lita is similar to Hubot but written in Ruby</a></li>
            <li><a href="#huginn-is-your-agent-standing-by">Huginn is your agent, standing by</a></li>
          </ul>
        </div>
        <div class='article' id='top'>
          <p>In the antediluvian days before Google found everything for us, personal <em>software agents</em> were going to continuously do our bidding in <em>cyberspace</em>, tracking down air fares, making stock trades and otherwise doing futuristic things that we soon wouldn&#39;t be able to live without.  The anxiety of Y2K rose and crested, and the messianic aura of <em>agents</em> was washed away by more centralized and effective solutions.</p>
          
          <p>The aspirational residue did yield some nuggets, and the idea has found partial success in the form of the <em>bot</em>. In the popular imagination bots exist on <a href="http://www.newyorker.com/tech/elements/the-rise-of-twitter-bots">Twitter as art projects</a> or as <a href="http://www.nytimes.com/2013/08/11/sunday-review/i-flirt-and-tweet-follow-me-at-socialbot.html?_r=0">marketing machines</a> or as <a href="http://www.radiolab.org/story/137407-talking-to-machines/">the perfect online dating scandal</a>.</p>
          
          <p>Bots can be characterized by asking a few questions, and from these answers we can tell something about their implementation and what it takes to build one:  <strong>Do they react to messages?</strong> <strong>Do they know who they are talking to?</strong> <strong>Can they learn from what was said?</strong> <strong>Do they know where the conversation is taking place?</strong>  <strong>Do they remember the overall conversation?</strong></p>
          
          <p>From this, we can classify bots into one of six types:</p>
          
          <ul>
          <li>Notifiers</li>
          <li>Reactors</li>
          <li>Space Reactors</li>
          <li>Responders</li>
          <li>Space Responders</li>
          <li>Conversationists</li>
          </ul>
          
          <p>Each of these have progressively more complex context that the bot is operating in.  Most chat mediums have different message types, where message can be directed towards or private to a particular user.  Confounding things further, some have a native concept of <em>spaces</em>, generally called a <em>room</em> or a <em>channel</em>, and as we treat people differently in different context the bot will also need to be aware of the difference context that the conversion is taking place.  We can call those services <em>Spaced</em>.</p>
          
          <table><thead>
          <tr>
          <th>Service</th>
          <th>Spaced</th>
          <th>Notes</th>
          </tr>
          </thead><tbody>
          <tr>
          <td>SMS</td>
          <td>No</td>
          <td>Groups are a dynamic list of people</td>
          </tr>
          <tr>
          <td>Desktop Notifications</td>
          <td>No</td>
          <td>Stuck on one computer</td>
          </tr>
          <tr>
          <td>Push Notifications</td>
          <td>No</td>
          <td>One way communication</td>
          </tr>
          <tr>
          <td><a href="https://www.aim.com">AIM</a></td>
          <td>No</td>
          <td>Group chat not core usage</td>
          </tr>
          <tr>
          <td><a href="https://support.google.com/chat/answer/159495?hl=en">GChat</a></td>
          <td>No</td>
          <td>Group chat not core usage</td>
          </tr>
          <tr>
          <td><a href="https://www.apple.com/ios/messages/">iMessage</a></td>
          <td>No</td>
          <td>Groups are a dynamic list of people</td>
          </tr>
          <tr>
          <td><a href="http://twitter.com/">Twitter</a></td>
          <td>No</td>
          <td>Lists aren&#39;t groups</td>
          </tr>
          <tr>
          <td><a href="https://www.yammer.com">Yammer</a></td>
          <td>Yes</td>
          <td>Sorta</td>
          </tr>
          <tr>
          <td><a href="http://en.wikipedia.org/wiki/Internet_Relay_Chat">IRC</a></td>
          <td>Yes</td>
          <td><em>Channels</em></td>
          </tr>
          <tr>
          <td><a href="https://www.hipchat.com">HipChat</a></td>
          <td>Yes</td>
          <td><em>Rooms</em></td>
          </tr>
          <tr>
          <td><a href="https://slack.com">Slack</a></td>
          <td>Yes</td>
          <td></td>
          </tr>
          <tr>
          <td><a href="https://campfirenow.com">Campfire</a></td>
          <td>Yes</td>
          <td><em>Rooms</em></td>
          </tr>
          </tbody></table>
          
          <p><em>Keeping track of User / Space context is more challenging than just User context</em></p>
          
          <h2 id="notifiers">Notifiers</h2>
          
          <p><em>Notifiers</em> are the &quot;simplest type&quot;of bots, in the sense that the messaging logic is a minor part of the overall program.  As a consequence they are the most common and the most varied.</p>
          
          <ul>
          <li>Broadcast a message based upon an external source</li>
          <li>Don&#39;t react to messages, so the answers to all the other questions are irrelevant.</li>
          </ul>
          
          <p>The trick in <em>Notifiers</em> is in figuring out what to say, not sending the message.</p>
          
          <pre><code class="rb"># Twitter Example&#x000A;message = &quot;Hello, World&quot;&#x000A;client.update( message )&#x000A;</code></pre>
          
          <pre><code class="sh"># AppleScript from the command line example&#x000A;$ MESSAGE=&quot;Hello, World&quot;&#x000A;$ /usr/bin/osascript -e &quot;display notification \&quot;$MESSAGE\&quot;&quot;&#x000A;</code></pre>
          
          <pre><code class="rb"># Using the terminal-notifier gem&#x000A;require &#39;terminal-notifier&#39;&#x000A;TerminalNotifier.notify &quot;\u2705 green!&quot;, :title =&gt; &quot;Hello, World&quot;&#x000A;</code></pre>
          
          <p>These are best implemented by having one program generate the information, and sending that to another program that sends the message to the chat service.  This could be a monitoring agent that is checking to see if a URL is responding, and if not, sends an alert.  It could be a build process that returns a success or failure message.  </p>
          
          <p>It could be a program that selects &quot;the next word&quot; from a lists of words and tweets one out every hour.  Or it could make a bunch of API calls to different services, correlate that with information from a database, do more complicated calculations, and then post it.  There&#39;s a bot that monitors the top links on hacker news, so it needs to pull down a list of top content, keep track of if it&#39;s tweeted it out before, and then send out the message.  The sending part is simple, but the overall bot may not be.</p>
          
          <h2 id="reactors">Reactors</h2>
          
          <p><em>Reactors</em> take action based upon incoming messages, but have no memory of who it&#39;s talking with or what space it&#39;s talking in.  The who and where maybe in the message headers, and the bot can return the message in the correct place, but there is no bot-persisted memory of them.</p>
          
          <ul>
          <li>Reacts to messages on the chat service</li>
          <li>Doesn&#39;t remember anything that was said</li>
          </ul>
          
          <p>The basic idea is that a reactor gets a message, does something with it, and moves on.  A lot of twitter bots follow this pattern, where they are looking at things on the stream and commenting upon them.</p>
          
          <pre><code>on_message( message ) = -&gt;&#x000A;  result = act_on_message( message )&#x000A;  message.reply( result )&#x000A;</code></pre>
          
          <p>For example, here&#39;s something that listens for tweets matching the string <code>not a feminist</code> and reacts by tweeting that that user isn&#39;t a feminist:</p>
          
          <pre><code class="rb">streaming_client.filter(track: &quot;not a feminist&quot;) do |object|&#x000A;  if object.is_a?( Twitter::Tweet ) &amp;&amp; object.user.user_name != BOT_NAME&#x000A;    client.update( &quot;. @#{object.user.user_name} is not a feminist&quot; )&#x000A;  end&#x000A;end&#x000A;</code></pre>
          
          <p>It could do something more interesting, like looking for an image url, downloading it, running it through ImageMagick, posting it to S3, and then tweeting it back out.  But since the bot itself keeps no message or user state, we consider it a <em>reactor</em>.</p>
          
          <h2 id="message-dispatching">Message Dispatching</h2>
          
          <p>Here we reach a phase change in the level of ambient complexity of the bot.  Simple <em>Reactors</em> respond to all messages the same way, relying on the filter to select messages that it cares about.  More complex reactors need to figure out what message it&#39;s being sent and reply differently:</p>
          
          <p>Case loop:</p>
          
          <pre><code>on_message( message ) = -&gt;&#x000A;  dispatch( message )&#x000A;&#x000A;dispach( message ) = -&gt;&#x000A;  case message.text&#x000A;    when /^echo/&#x000A;      do_echo( message )&#x000A;    else&#x000A;      message.reply( &quot;Don&#39;t know what you mean&quot; )&#x000A;&#x000A;do_echo( message ) = -&gt;&#x000A;  message.reply( message )&#x000A;</code></pre>
          
          <p>Command objects:</p>
          
          <pre><code>on_message( message ) = -&gt;&#x000A;  dispatch( message )&#x000A;&#x000A;dispatch( message ) = -&gt;&#x000A;  command = find_command_object( message )&#x000A;  command.execute( message )&#x000A;&#x000A;echo_command.execute( message ) = -&gt;&#x000A;  message.reply( message )&#x000A;</code></pre>
          
          <p>This can also be done using <em>metaprogramming</em>, something like this:</p>
          
          <pre><code>class Dispatcher&#x000A;  dispatch( message ) = -&gt;&#x000A;    if reponds_to? message.command&#x000A;      self.send( message.command, message )&#x000A;&#x000A;class MyBotClass &lt; Dispatcher&#x000A;  echo( message ) = -&gt;&#x000A;    message.reply( message )&#x000A;&#x000A;bot = MyBotClass.new&#x000A;&#x000A;on_message( message ) = -&gt;&#x000A;  bot.dispatch( message )  &#x000A;</code></pre>
          
          <p>That is nonsense pseudo code, but a lot of chat bot libraries focus in on that area doing something very similar to what <code>Thor</code> does for command line programs.</p>
          
          <h2 id="space-reactors">Space Reactors</h2>
          
          <p><em>Space Reactors</em>, in addition to having an awesome name, react to incoming messages, and know where they are receiving a message.  The bot has memory of the place, and will respond to the user differently depending upon where the conversation was taking place.</p>
          
          <ul>
          <li>Reacts to messages on the chat service</li>
          <li>Knows where its being addressed</li>
          <li>Doesn&#39;t remember anything that was said</li>
          </ul>
          
          <p>When a reactor is run in on Spaced chat medium, it needs to factor in where the message was received.  Instead of having <em>user</em> and <em>message</em> to work with, it now has <em>user</em>, <em>message</em>, and <em>space</em>.</p>
          
          <p>You can either find the space within each of the commands:</p>
          
          <pre><code>class MyBot &lt; Dispatcher&#x000A;  wtf( message ) = -&gt;&#x000A;    space = find_space_from( message )&#x000A;    commit_message = space.last_commit_message&#x000A;    message.reply( commit_message )&#x000A;&#x000A;bot = MyBot.new&#x000A;&#x000A;on_message( message ) = -&gt;&#x000A;  bot.dispatch( message )&#x000A;</code></pre>
          
          <p>Or locate the commands inside of the space, which lets you separate out which commands are available depending the properties of the space.</p>
          
          <pre><code>class PublicSpaceReactor &lt; Dispatcher&#x000A;  wtf( message ) = -&gt;&#x000A;    message.reply( &quot;This space has no commits&quot; )&#x000A;&#x000A;class ProjectSpaceReactor &lt; Dispatcher&#x000A;  wtf( message ) = -&gt;&#x000A;    message.reply( project.last_commit_message )&#x000A;&#x000A;class SpaceDispatcher &lt; Dispatcher&#x000A;  dispatch( message ) = -&gt;&#x000A;    space = find_space( message )&#x000A;    responder = nil&#x000A;    if space.project?&#x000A;      responder =  ProjectSpaceReactor.new( space.project )&#x000A;    else&#x000A;      responder = PublicSpaceReactor.new&#x000A;    responder.dispatch( message )&#x000A;&#x000A;bot = SpaceDispatcher.new&#x000A;&#x000A;on_message( message ) = -&gt;&#x000A;  bot.dispatch( message )&#x000A;</code></pre>
          
          <p>If you have a HipChat bot and have a room for each company project, and you want to have the bot respond to <code>wtf</code> with the last commit message on github.  The first thing that you need to do is look at which room the message came from, and correlate that a list of repositories, then make a Github API call, and finally post the commit message back to the room.</p>
          
          <pre><code class="rb">  # This is a lita based bot, which provides dispatching &#x000A;  # so we find the space inside of the command&#x000A;  def wtf(response)&#x000A;    project = find_project response.message.source.room&#x000A;    message = project.last_commit_message&#x000A;    response.reply message&#x000A;  end&#x000A;</code></pre>
          
          <p>The <code>find_project</code> method implies that you now need to have persistent state associated with the <em>Space</em>, in this case the unspecified <code>project</code> object.  It&#39;s not just a matter of making sure that your reply goes to the correct place, but that what you reply will changed based upon where the person said it.</p>
          
          <h2 id="responders">Responders</h2>
          
          <p><em>Responders</em> listen for messages and remember what was said to them.  They are different from <em>Reactors</em> because they have persisted User state, and so can learn something from the user.</p>
          
          <ul>
          <li>Reacts to messages</li>
          <li>Knows who they are talking to</li>
          <li>Can learn from what was said</li>
          </ul>
          
          <p>It&#39;s natural here to include the dispatching inside of the object that keeps track of the user state.  Here&#39;s a pseudo example of a bot that lets you update your nickname. First by loading the user inside of the Bot:</p>
          
          <pre><code>class NickBot &lt; Dispatcher&#x000A;  nick( message ) = -&gt;&#x000A;    user = User.load_from_datastore( message.user )&#x000A;    user.nickname = message.arg1&#x000A;    user.save&#x000A;    message.reply( &quot;Your nick name has been updated to &quot; + message.arg1 )&#x000A;&#x000A;bot = NickBot.new&#x000A;&#x000A;on_message( message ) = -&gt;&#x000A;  bot.dispatch( message )&#x000A;</code></pre>
          
          <p>But it may also make sense to create different types of dispatchers for different users, in this pseudo code there are 3 different types of responders and depending upon who is sending the message different functions are available to them:</p>
          
          <pre><code>class AnonymousUserResponder &lt; Dispatcher&#x000A;  nick( message ) = -&gt;&#x000A;    user.nickname = message.arg1&#x000A;    user.save&#x000A;    message.reply( &quot;Your nick name has been updated to &quot; + message.arg1 )&#x000A;&#x000A;class NamedUserResponder &lt; AnonymousUserResponder&#x000A;  comment( message ) = -&gt;&#x000A;    create_a_comment( user.nickname, message )&#x000A;    message.reply( &quot;Thanks for the message&quot; )&#x000A;&#x000A;class AdminResponder &lt; NamedUserResponder&#x000A;  restart( message ) = -&gt;&#x000A;    restart_server&#x000A;    message.reply( &quot;You&#39;ve restarted the server&quot; )&#x000A;&#x000A;class UserDispatcher &lt; Dispatcher&#x000A;  dispatch( message ) = -&gt;&#x000A;    user = User.load_from_datastore( message.user )&#x000A;    responder = nil&#x000A;    if user.admin?&#x000A;      responder = AdminResponder.new( user )&#x000A;    elseif user.nickname?&#x000A;      responder = NamedUserResponder.new( user )&#x000A;    else&#x000A;      responder = AnonymousUserResponder.new( user )&#x000A;    responder.dispatch( message )&#x000A;&#x000A;bot = UserDispatcher.new&#x000A;&#x000A;on_message( message )&#x000A;  bot.dispatch( message )&#x000A;</code></pre>
          
          <p><em>This example is misleading because in real life direct inherency doesn&#39;t scale well, as we&#39;ll see below.</em></p>
          
          <h2 id="space-responders">Space Responders</h2>
          
          <p><em>Space Responder</em> learn things about who is talking with them and the context in which they are speaking.</p>
          
          <ul>
          <li>Reacts to messages</li>
          <li>Knows who they are talking to</li>
          <li>Can learn from what was said</li>
          <li>Knows where its being addressed</li>
          </ul>
          
          <p>The challenge here is how do you juggle the permutations of state.  Lets take the example of a user is an admin in one project, where they can send commands to reboot the server, and in another project they can only open new tickets.  In the basic case, you can do everything in each of your methods:</p>
          
          <pre><code>class ServerBot &lt; Dispatcher&#x000A;  restart( message ) = -&gt;&#x000A;    user = find_user( message )&#x000A;    space = find_space( message )&#x000A;    if space.is_admin?( user )&#x000A;      restart_server&#x000A;      message.reply( &quot;Go go go&quot; )&#x000A;    else&#x000A;      message.reply( &quot;Sorry Charlie, try again&quot; )&#x000A;&#x000A;  ticket( message ) = -&gt;&#x000A;    space = find_space( message )&#x000A;    ticket = space.create_ticket_message( message )&#x000A;    message.reply( ticket.id + &quot; has been created&quot; )&#x000A;&#x000A;bot = ServerBot.new&#x000A;&#x000A;on_message( message ) = -&gt;&#x000A;  bot.dispatch( message )&#x000A;</code></pre>
          
          <p>Lets say that we had two different types of users, admins or not, and two different types of spaces, one that mapped to a project and another that mapped to a hangout area.  We could expand out idea of the SpaceDispatcher to return a different command object based upon the combinations.</p>
          
          <pre><code>class SpaceDispatcher &lt; Dispatcher&#x000A;  dispatch( message ) = -&gt;&#x000A;    space = find_space( message )&#x000A;    user = find_user( message )&#x000A;    if !space.project?&#x000A;      if space.is_admin?( user )&#x000A;        AdminLobbyResponder.new( space, user ).dispatch( message )&#x000A;      else&#x000A;        LobbyResponder.new( space, user ).dispatch( message )&#x000A;    else if space.is_admin?( user )&#x000A;      AdminSpaceResponder.new( space, user ).dispatch( message )&#x000A;    else&#x000A;      ProjectResponder.new( space, user ).dispatch( message )&#x000A;&#x000A;class LobbyResponder &lt; Dispatcher&#x000A;  vote( message ) = -&gt;&#x000A;    votes = space.tally_term( message )&#x000A;    message.reply( &quot;That totals: &quot; + votes )&#x000A;&#x000A;class AdminLobbyResponder &lt; LobbyResponder&#x000A;  topic( message ) = -&gt;&#x000A;    space.set_topic( message )&#x000A;    message.reply( &quot;Topic updated&quot; )&#x000A;&#x000A;class ProjectResponder &lt; LobbyResponder&#x000A;  ticket( message ) = -&gt;&#x000A;    ticket = space.create_ticket( message )&#x000A;    message.reply( ticket.id + &quot; has been created&quot; )&#x000A;&#x000A;class AdminProjectResponder &lt; ProjectResponder&#x000A;  restart( message ) = -&gt;&#x000A;    restart_server&#x000A;    message.reply( &quot;Server restarted&quot; )&#x000A;&#x000A;bot = SpaceDispatcher.new&#x000A;&#x000A;on_message( message ) = -&gt;&#x000A;  bot.dispatch( message )&#x000A;</code></pre>
          
          <p>We&#39;re also using inheritance to include all of the methods that the regular user can do into the class that has all of the Admin methods.  This pseudocode has turned into an unholey mixture of Ruby and CoffeeScript, so it probably isn&#39;t work doing into language details with this.  But straight up inheritance doesn&#39;t work well for this type of reuse, and in our example project admins won&#39;t be able to change the <code>topic</code>.  These commands would better be structured as mixins.</p>
          
          <h2 id="conversationists">Conversationists</h2>
          
          <p>The final, and technically most complicated type of bot to write is a <em>Conversationalist</em>.</p>
          
          <ul>
          <li>Reacts to messages</li>
          <li>Knows who they are talking to</li>
          <li>Can learn from what was said</li>
          <li>Has conversational state</li>
          <li>Knows where its being addressed</li>
          </ul>
          
          <p>The basic structure is:</p>
          
          <pre><code>class Conversation &lt; Dispatcher&#x000A;  # knowledge collected during the course of the conversation #&#x000A;&#x000A;  # state machine mapping conversion state #&#x000A;&#x000A;  dispatch( message ) = -&gt;&#x000A;    # Store incoming message in log&#x000A;    # interpret the response based upon the current state&#x000A;    # print a message on state transition&#x000A;&#x000A;class ChatBot &lt; Dispatcher&#x000A;  dispatch( message ) = -&gt;&#x000A;    user = find_user( message )&#x000A;    conversation = user.current_conversation&#x000A;    conversation.dispatch( message )&#x000A;&#x000A;bot = ChatBot.new&#x000A;&#x000A;on_message(message) = -&gt;&#x000A;  bot.dispatch( message )&#x000A;</code></pre>
          
          <p>The <code>User</code> object is responsible for keeping track of conversations.  <code>current_conversation</code> can be smart enough to create a new conversation when things are stale or if there user explicitly closed out an active one.</p>
          
          <p>Here is an example of code from a bot that asks you questions about where you are and what sort of food you are looking for.  It searches a number of APIs in the background to see what information it can get from what you say.  The code is written with an Adaptor to talk Twitter or GChat, and they both have a different idea of location.  Sometimes it can get an accurate enough location the message metadata, but more likely it&#39;s too vague and it will ask you to clarify.  (<em>Not all of that logic is below, but its useful to demonstrate the use of the state machine</em>.)</p>
          
          <p>The knowledge attributes are what the bot knows in the conversation.  Below you&#39;ll see an example of <em>knowledge of the conversation</em> from the state machine, <em>knowledge of what as been said</em> from previous messages, and <em>knowledge of deduction</em> from the content and context of the messages.</p>
          
          <pre><code>class ConversationResponder&#x000A;  # State Machine&#x000A;  workflow do&#x000A;    state :new do&#x000A;      event :process_message,  :transitions_to =&gt; :processing_location&#x000A;    end&#x000A;&#x000A;    state :processing_location do&#x000A;      event :needs_location,    :transitions_to =&gt; :clarify_location&#x000A;      event :location_clear,    :transitions_to =&gt; :has_location&#x000A;    end&#x000A;&#x000A;    state :clarify_location do&#x000A;      event :process_message,   :transitions_to =&gt; :processing_location&#x000A;    end&#x000A;&#x000A;    state :has_location do&#x000A;      event :needs_keywords,    :transitions_to =&gt; :clarify_keywords&#x000A;      event :has_keywords,      :transitions_to =&gt; :processing_keywords&#x000A;    end&#x000A;&#x000A;    state :clarify_keywords do&#x000A;      event :process_message,   :transitions_to =&gt; :processing_keywords&#x000A;    end&#x000A;&#x000A;    state :processing_keywords do&#x000A;      event :needs_keywords,    :transitions_to =&gt; :clarify_keywords&#x000A;      event :needs_location,    :transitions_to =&gt; :clarify_location&#x000A;      event :found_places,      :transitions_to =&gt; :refining_selection&#x000A;      event :no_places_found,   :transitions_to =&gt; :clarify_keywords&#x000A;    end&#x000A;&#x000A;    state :refining_selection do&#x000A;      event :process_message,   :transitions_to =&gt; :processing_keywords&#x000A;    end&#x000A;  end&#x000A;&#x000A;  # Knowledge Attributes&#x000A;  def looking_for_location?&#x000A;    !knows_location? || location_vague?&#x000A;  end&#x000A;&#x000A;  def knows_location?&#x000A;    !lat.blank? &amp;&amp; !lng.blank?&#x000A;  end&#x000A;&#x000A;  def location_vague?&#x000A;    return false if location_range == &quot;ROOFTOP&quot; || location_range == &quot;RANGE_INTERPOLATED&quot;&#x000A;    #Added by Jon so that zip codes are sufficient&#x000A;    return false if location_range == &quot;APPROXIMATE&quot;&#x000A;    #TODO: put more intelligence into this: eg location_range = &quot;GEOMETRIC_CENTER&quot; is good enough for Iowa but not for NYC&#x000A;    true&#x000A;  end&#x000A;&#x000A;  def location_name&#x000A;    if knows_location?&#x000A;      status,address =  Geocode.reverse_geocode([lat,lng])&#x000A;      return address&#x000A;    else&#x000A;      return nil&#x000A;    end&#x000A;  end&#x000A;&#x000A;  def looking_for_places?&#x000A;    places.count == 0&#x000A;  end&#x000A;&#x000A;  def have_keyword_messages?&#x000A;    !keyword_messages.nil? &amp;&amp; keyword_messages.length &gt; 0&#x000A;  end&#x000A;&#x000A;  def keyword_messages&#x000A;    @keyword_messages ||= messages.select{ |x| x.looks_like_keyword? &amp;&amp; !x.is_a?( OutgoingMessage ) }&#x000A;  end&#x000A;&#x000A;  def keywords&#x000A;    keyword_messages.collect { |x| x.search_terms }.join( &quot;, &quot;)&#x000A;  end&#x000A;end&#x000A;</code></pre>
          
          <hr>
          
          <h2 id="thats-the-shape-of-it">Thats the shape of it</h2>
          
          <p><em>Notifiers</em>, <em>Reactors</em>, <em>Space Reactors</em>, <em>Responders</em>, <em>Space Responders</em>, and <em>Conversationists</em>.  Writing <em>Notifiers</em> and <em>Reactors</em> are more playful, and as you get into things later in the list you spend a lot more time dealing with code and logic complexity.</p>
          
          <p>The distinction between a <em>Spaced</em> and <em>Global</em> chat medium is something that makes using chat libraries, and building <strong>Adapters</strong> to different services difficult.  If the library was built with a <em>Spaced</em> service in mind it&#39;s pretty straightforward to make it work for one, but going the other way isn&#39;t swimming upstream.</p>
          
          <hr>
          
          <h2 id="towards-a-taxonomy-of-twitter-bots">Towards a taxonomy of Twitter Bots</h2>
          
          <p><a href="http://tinysubversions.com/botsummit/2014/">BotSummit</a> was a few days ago, and a bunch of people got together to talk about Twitter bots that they made largely as art projects.  Here&#39;s a draft of a taxonomy of Twitter bots made by <a href="https://twitter.com/tullyhansen">Tully Hanson</a>.  In the parlance of this post, these are mainly <em>Notifiers</em> and <em>Reactors</em>, with some possible <em>Responders</em> thrown in:</p>
          
          <p><img alt="Twitter Bot Taxonomy" src="http://i.imgur.com/bKXNQ0V.png" /></p>
          
          <p><em>Here&#39;s the <a href="https://gist.github.com/tullyhansen/7621632">source document</a></em></p>
          
          <p><em>Notifiers</em> are interesting not because of their technology, but because of what they actually do.  Here&#39;s a <a href="https://docs.google.com/document/d/1bka4o1RE9RPUeoUzgpTIKRWsgWHzZEKEADialnv7haQ/view">list of ideas that people came up with</a>.</p>
          
          <hr>
          
          <h1 id="agents-of-note">Agents of Note</h1>
          
          <h2 id="hubot-from-github-is-a-company-chat-bot-written-in-node">Hubot from Github is a company chat bot written in Node</h2>
          
          <p><img alt="left_float" src="https://silvrback.s3.amazonaws.com/uploads/5a2b7f44-c37b-4cfc-b0df-16e28a889160/HUBOT_large.jpg" /></p>
          
          <p><a href="https://hubot.github.com">Hubot from Github</a>:</p>
          
          <blockquote>
          <p>GitHub, Inc., wrote the first version of Hubot to automate our company chat room. Hubot knew how to deploy the site, automate a lot of tasks, and be a source of fun in the company. Eventually he grew to become a formidable force in GitHub. But he led a private, messy life. So we rewrote him.</p>
          </blockquote>
          
          <p><em>Image from <a href="https://hubot.github.com">Hubot site</a></em></p>
          
          <h2 id="lita-is-similar-to-hubot-but-written-in-ruby">Lita is similar to Hubot but written in Ruby</h2>
          
          <p><a href="https://www.lita.io">Lita homepage</a></p>
          
          <p><img alt="left_float" src="https://silvrback.s3.amazonaws.com/uploads/a1895cd0-8429-4a82-9cd7-2b7557d3c0a3/lita-94f070fbb79e8ec62cc7a21ca39f8448_large.png" />
          <em>Image from <a href="https://www.lita.io">Lita</a></em></p>
          
          <h2 id="huginn-is-your-agent,-standing-by">Huginn is your agent, standing by</h2>
          
          <p><img alt="left_float" src="https://silvrback.s3.amazonaws.com/uploads/4c8d7718-e8a1-4d6f-92b7-e2d1c92cec43/220px-Odin%2C_der_G%C3%B6ttervater_large.jpg" /></p>
          
          <p><a href="https://github.com/cantino/huginn">Huginn</a> takes a bit to install, but it&#39;s a full on <em>software agent</em> of the old school.</p>
          
          <blockquote>
          <p>Huginn is a system for building agents that perform automated tasks for you online. They can read the web, watch for events, and take actions on your behalf. Huginn&#39;s Agents create and consume events, propagating them along a directed graph. Think of it as a hackable Yahoo! Pipes plus IFTTT on your own server. You always know who has your data. You do.</p>
          
          <p>We&#39;re just getting started, but here are some of the things that you can do with Huginn right now:</p>
          
          <ul>
          <li>Track the weather and get an email when it&#39;s going to rain (or snow) tomorrow (&quot;Don&#39;t forget your umbrella!&quot;)</li>
          <li>List terms that you care about and receive emails when their occurrence on Twitter changes. (For example, want to know when something interesting has happened in the world of Machine Learning? Huginn will watch the term &quot;machine learning&quot; on Twitter and tell you when there is a large spike.)</li>
          <li>Watch for air travel or shopping deals</li>
          <li>Follow your project names on Twitter and get updates when people mention them</li>
          <li>Scrape websites and receive emails when they change</li>
          <li>Connect to Adioso, HipChat, Basecamp, Growl, FTP, IMAP, Jabber, JIRA, MQTT, nextbus, Pushbullet, Pushover, RSS, Bash, Slack, StubHub, translation APIs, Twilio, Twitter, Wunderground, and Weibo, to name a few.</li>
          <li>Compose digest emails about things you care about to be sent at specific times of the day</li>
          <li>Track counts of high frequency events and send an SMS within moments when they spike, such as the term &quot;san francisco emergency&quot;</li>
          <li>Send and receive WebHooks</li>
          <li>Run arbitrary JavaScript Agents on the server</li>
          <li>Track your location over time</li>
          <li>Create Amazon Mechanical Turk workflows as the inputs, or outputs, of agents. (&quot;Once a day, ask 5 people for a funny cat photo; send the results to 5 more people to be rated; send the top-rated photo to 5 people for a funny caption; send to 5 final people to rate for funniest caption; finally, post the best captioned photo on my blog.&quot;)</li>
          </ul>
          </blockquote>
          
          <p><em>Image &quot;Odin, der Göttervater&quot; by Carl Emil Doepler (1824-1905) - Wägner, Wilhelm. 1882. Nordisch-germanische Götter und Helden. Otto Spamer, Leipzig &amp; Berlin. Page 7.. Licensed under Public domain via Wikimedia Commons - <a href="http://commons.wikimedia.org/wiki/File:Odin,_der_G%C3%B6ttervater.jpg#mediaviewer/File:Odin,_der_G%C3%B6ttervater.jpg">Link</a></em></p>
          
          <hr>
          
          <p>Let me know cool things you build!</p>
        </div>
        <div class='navigation' data-offset-top='400' data-spy='affix'>
          <div class='next'>
            <p>
              Next in
              <a href="/tag/Chronological.html">Chronological</a>
            </p>
            <p class='title'><a href="/personal-information-from-only-a-url/">Personal information from only a URL</a></p>
            <p>
              Next in
              <a href="/tag/Overview.html">Overview</a>
            </p>
            <p class='title'><a href="/why-engineers-build-crappy-products/">Why Engineers build crappy products</a></p>
            <p>
              Next in
              <a href="/tag/Bots.html">Bots</a>
            </p>
            <p class='title'><a href="/scripting-twitter/">Scripting Twitter: Collecting Data and Writing Bots</a></p>
          </div>
          <div class='prev'>
            <p>
              Previously in
              <a href="/tag/Chronological.html">Chronological</a>
            </p>
            <p class='title'><a href="/making-a-command-line-utility-with-gems-and-thor/">Making a command line utility with gems and thor</a></p>
            <p>
              Previously in
              <a href="/tag/Overview.html">Overview</a>
            </p>
            <p class='title'><a href="/bootstrap-advanced-grid-tricks/">Bootstrap: Advanced Grid Tricks</a></p>
          </div>
        </div>
      </div>
      <div class="row article_footer">
        <div class="comments">
            <a href="#" id="comment_shower">
              <span class="socicon socicon-disqus fgcolor"></span>
              <span class="disqus-comment-count" data-disqus-identifier="2014-11-11-bot-design-patterns.html">Be the first to comment.</span>
            </a>
        </div>
        <div class="sharing">
          <a href="http://www.twitter.com/share?url=http://willschenk.com//bot-design-patterns/&amp;text=Bot Design Patterns by @wschenk" title="Share this post on Twitter" data-lang="en" onclick="return !window.open(this.href, 'Twitter', 'width=640,height=300')"><span class="socicon socicon-twitter fgcolor"></span></a>
      
          <a target="_blank" onclick="return !window.open(this.href, 'Facebook', 'width=640,height=300')" href="http://www.facebook.com/sharer/sharer.php?u=http://willschenk.com//bot-design-patterns/" title="Share this post on Facebook"><span class="socicon socicon-facebook fgcolor"></span></a>
      
          <a href="http://plus.google.com/share?url=http://willschenk.com//bot-design-patterns/" target="_blank" onclick="return !window.open(this.href, 'Google +', 'width=640,height=300')" title="Share this post on Google +"><span class="socicon socicon-google fgcolor"></span></a>
        </div>
      </div>
        <div class="comment_row">
          <div class="comment_universe">
            <div id="disqus_thread" class="col-sm-10 col-sm-offset-1"></div>
          </div>
        </div>
    </div>
    <footer class='academy'>
      <div class='container'>
        <div class='row'>
          <div class='logo'>
            <a href='http://academy.happyfuncorp.com/'>
              <img class="img-responsive" src="../images/academy-logo-f112afa1.png" />
            </a>
          </div>
          <div class='body'>
            <h1>Come join us in person!</h1>
            <p>HFC Technology Academy is dedicated to teaching people the skills they need to succeed in the world of technology and startups.</p>
            <p>The Academy is for anyone with the passion to learn about entrepreneurship, development, product management and other skills within the start-up community.</p>
            <h2><a href="http://academy.happyfuncorp.com/">Read about our free events</a></h2>
          </div>
        </div>
      </div>
    </footer>
    <footer class='footer  '>
      <div class='container'>
        <div class='row'>
          <div class='social'>
            <span>
              <a class='webicon twitter' href='http://twitter.com/wschenk'></a>
            </span>
            <span>
              <a class='webicon tumblr' href='http://sublimeguile.com/'></a>
            </span>
            <span>
              <a class='webicon instagram' href='http://instagram.com/wschenk'></a>
            </span>
            <span>
              <a class='webicon linkedin' href='http://www.linkedin.com/pub/will-schenk/0/266/420/'></a>
            </span>
            <span>
              <a class='webicon github' href='https://github.com/wschenk'></a>
            </span>
            <span>
              <a class='webicon rss' href='http://willschenk.com/feed.xml'></a>
            </span>
            <span>
              <a class='webicon mail' href='mailto:will@happyfuncorp.com'></a>
            </span>
          </div>
          <div class='made_in_bk'>
            <h3>Made in Brooklyn, NY</h3>
          </div>
        </div>
      </div>
    </footer>
    <script src="../javascripts/application-b5017286.js" type="text/javascript"></script><script src="../javascripts/modernizr-84a49412.js" type="text/javascript"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.3/highlight.min.js"></script>
    <script type="text/javascript">
      var _gaq=[['_setAccount','UA-56296045-1'],['_trackPageview']];
      (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
      g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
      s.parentNode.insertBefore(g,s)}(document,'script'));
    </script>
    
    <script type="text/javascript">
      hljs.initHighlightingOnLoad();
      $(".article img").addClass( "img-responsive");
      $("iframe").map( function(e) {
        $(this).css( "max-width", $(this).width() );
        $(this).width( "100%" );
      });
      var _gaq=[['_setAccount','UA-56296045-1'],['_trackPageview']];
      (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
      g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
      s.parentNode.insertBefore(g,s)}(document,'script'));
      var disqus_shortname = 'willschenk';
        var disqus_identifier = '2014-11-11-bot-design-patterns.html';
            
      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
      (function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
    </script>
  </body>
</html>
