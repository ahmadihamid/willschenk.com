<!DOCTYPE html>
<html class='no-js'>
  <head>
    <meta charset='utf-8'>
    <meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
    <title>How to track your coworkers | Blank Page Tech</title>
    <meta name="site" content="Blank Page Tech" />
    <meta name="og:site_name" content="Blank Page Tech" />
    <meta name="title" content="How to track your coworkers" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="How to track your coworkers" />
    <meta name="twitter:site" content="@wschenk" />
    <meta name="og:title" content="How to track your coworkers" />
    <meta content='width=device-width' name='viewport'>
    <link href="../stylesheets/application-25f4f7e0.css" rel="stylesheet" type="text/css" /><link href="../stylesheets/webicons-da5ecace.css" rel="stylesheet" type="text/css" /><link href="../stylesheets/socicons-d8ab83dd.css" rel="stylesheet" type="text/css" /><link href="../stylesheets/animate-8335fea6.css" rel="stylesheet" type="text/css" /><link href="../stylesheets/googlecode-d3629bf4.css" rel="stylesheet" type="text/css" />
    <link href='//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.3/styles/default.min.css' rel='stylesheet'>
    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />
  </head>
  <body data-spy='scroll' data-target='.sidebar'>
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">
      <div class='visible-xs-block'>
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapsable">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a href="/" class="navbar-brand">
        Blank Page Tech
      </a>
        
      </div>
    </div>
    <div class='hidden-xs'>
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapsable">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a href="/" class="navbar-brand">
        Technology for the blank page
      </a>
        
      </div>
    </div>
    <div class="collapse navbar-collapse" id="navbar-collapsable">
      <ul class="nav navbar-nav navbar-right foo" id="menu">
      <li>
      <a href="/articles/">
        Articles
      </a>
    </li>
    <li class="dropdown">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown">Topics <b class="caret"></b></a>
      <ul class="dropdown-menu">
        <li>
      <a href="/tags/howto/">
        Howtos
      </a>
    </li>
    <li>
      <a href="/tags/overview/">
        Overviews
      </a>
    </li>
    <li>
      <a href="/tags/product/">
        Product
      </a>
    </li>
    <li>
      <a href="/tags/tools/">
        Tools
      </a>
    </li>
    <li>
      <a href="/tags/socialinvestigator/">
        Social Investigator
      </a>
    </li>
    <li>
      <a href="/tags/ruby/">
        Ruby & Rails
      </a>
    </li>
    
      </ul>
    </li>
    <li class="dropdown">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tags <b class="caret"></b></a>
      <ul class="dropdown-menu">
        <li>
      <a href="/bootstrap-advanced-grid-tricks/">
        bootstrap (1)
      </a>
    </li>
    <li>
      <a href="/tags/bots/">
        bots (2)
      </a>
    </li>
    <li>
      <a href="/using-rake-for-dataflow-programming-and-data-science/">
        data (1)
      </a>
    </li>
    <li>
      <a href="/osx-script-for-kiosk-mode/">
        gaze (1)
      </a>
    </li>
    <li>
      <a href="/pulling-data-out-of-google-analytics/">
        googleanalytics (1)
      </a>
    </li>
    <li>
      <a href="/tags/happy_seed/">
        happy_seed (3)
      </a>
    </li>
    <li>
      <a href="/tags/howto/">
        howto (15)
      </a>
    </li>
    <li>
      <a href="/tags/middleman/">
        middleman (5)
      </a>
    </li>
    <li>
      <a href="/setting-up-devise-with-twitter-and-facebook-and-other-omniauth-schemes-without-email-addresses/">
        oauth (1)
      </a>
    </li>
    <li>
      <a href="/tags/osx/">
        osx (2)
      </a>
    </li>
    <li>
      <a href="/tags/overview/">
        overview (4)
      </a>
    </li>
    <li>
      <a href="/tags/product/">
        product (2)
      </a>
    </li>
    <li>
      <a href="/tags/rails/">
        rails (3)
      </a>
    </li>
    <li>
      <a href="/using-rake-for-dataflow-programming-and-data-science/">
        rake (1)
      </a>
    </li>
    <li class="active">
      <a href="/how-to-track-your-coworkers/">
        redis (1)
      </a>
    </li>
    <li>
      <a href="/tags/ruby/">
        ruby (15)
      </a>
    </li>
    <li>
      <a href="/tags/socialinvestigator/">
        socialinvestigator (4)
      </a>
    </li>
    <li>
      <a href="/dateslice-writing-rails-extensions/">
        sql (1)
      </a>
    </li>
    <li>
      <a href="/field-of-dreams-is-25-years-old-and-hasn-t-aged-well/">
        startupmyths (1)
      </a>
    </li>
    <li>
      <a href="/slow-data-and-fast-sites/">
        static_sites (1)
      </a>
    </li>
    <li>
      <a href="/setting-up-testing/">
        testing (1)
      </a>
    </li>
    <li>
      <a href="/making-a-command-line-utility-with-gems-and-thor/">
        thor (1)
      </a>
    </li>
    <li>
      <a href="/tags/tools/">
        tools (5)
      </a>
    </li>
    <li>
      <a href="/tags/toys/">
        toys (3)
      </a>
    </li>
    
      </ul>
    </li>
    <li class="dropdown">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown">Archives <b class="caret"></b></a>
      <ul class="dropdown-menu">
        <li>
      <a href="/adding-search-to-a-middleman-blog/">
        Jun 2015 (1)
      </a>
    </li>
    <li>
      <a href="/2015/05/">
        May 2015 (2)
      </a>
    </li>
    <li>
      <a href="/why-engineers-build-crappy-products/">
        Feb 2015 (1)
      </a>
    </li>
    <li>
      <a href="/2015/01/">
        Jan 2015 (2)
      </a>
    </li>
    <li>
      <a href="/2014/12/">
        Dec 2014 (5)
      </a>
    </li>
    <li>
      <a href="/2014/11/">
        Nov 2014 (10)
      </a>
    </li>
    <li class="active">
      <a href="/how-to-track-your-coworkers/">
        Oct 2014 (1)
      </a>
    </li>
    
      </ul>
    </li>
    
    </ul>
    <form class='navbar-form navbar-right' id='search' role='search'>
      <div class='form-group dropdown'>
        <div class='input-group'>
          <input autocomplete='off' class='form-control' id='search_box' placeholder='Search' type='text'>
          <span class='input-group-btn'>
            <button class='btn btn-default'>
              <span class='glyphicon glyphicon-search'></span>
            </button>
          </span>
        </div>
        <ul class='dropdown-menu dropdown-menu-left results'>
          <a href="/url">Title</a>
        </ul>
      </div>
    </form>
    
    </div>
    
    </div>
    </nav>
    <div class='article-header  '>
      <h1>How to track your coworkers</h1>
      <h2>Simple passive network surveillance</h2>
      <div class='tags'>
        <div class='tag'><a class="btn btn-primary" href="/tags/howto/">howto</a></div>
        <div class='tag'><a class="btn btn-primary" href="/tags/redis/">redis</a></div>
        <div class='tag'><a class="btn btn-primary" href="/tags/ruby/">ruby</a></div>
        <div class='tag'><a class="btn btn-primary" href="/tags/toys/">toys</a></div>
      </div>
      <a href='#comment_shower' id='comment_shower_scroll'>
        <span class='disqus-comment-count' data-disqus-identifier='silvrback-wschenk-9332'></span>
      </a>
    </div>
    <div class='content'>
      <div class='row'>
        <div class='sidebar'>
          <ul class='nav toc' data-offset-top='400' data-spy='affix'>
            <li><a href="#top">How to track your coworkers</a></li>
            <li><a href="#networking-primer">Networking primer</a></li>
            <li><a href="#the-plan">The plan</a></li>
            <li><a href="#the-code">The Code</a></li>
            <li><a href="#next-steps">Next steps</a></li>
          </ul>
        </div>
        <div class='article' id='top'>
          <p>How much information do you bleed?</p>
          
          <p>Ever wonder who is else is using your network?  Or,who has actually showed up at the office?</p>
          
          <h2 id="networking-primer">Networking primer</h2>
          
          <p>The simplest thing we can do to make this work is to check to see which devices have registered themselves on the network.  As devices come and go, they connect automatically, so we will have a pretty good idea if people are there or not.  Phones seem to attach and detach quite frequency, probably to conserve battery, so if we are want to answer the question &quot;is so-and-so in the office&quot; we&#39;ll need to add additional logic to determine how far spaced the &quot;sighting&quot; events are to mean that the person has left the office, rather than the phone has gone to sleep.</p>
          
          <p>There are a couple of ways to do this. One is to log on you your router and look at the <code>DHCP</code> routing tables to see which devices have leased an IP address.  Have you looked at those router webpages though?  Pretty gross.  You&#39;d need to do some scraping, something different for each of the router types, all together pretty gross.</p>
          
          <p>Another thing to consider is <code>DNS multicast</code>, also called <code>Bonjour</code> or zero-config networking.  This is pretty much the standard now for services announcing themselves on the human-used networks.  (Server rooms have fancier service discovery mechanisms.)  If you want to find a printer, or someone else&#39;s iTunes library it works great, but it doesn&#39;t do much for phones.</p>
          
          <p>We are going to do this using ping.   This is simple and works everywhere.</p>
          
          <h2 id="the-plan">The plan</h2>
          
          <p>The code below using <code>ruby</code> and <code>redis</code> to track which devices have been seen.  You&#39;ll need to have <code>redis</code> installed and running for this code to work, but it should be easily portable to any Unix system, not just OSX.  So if you have a <code>RaspberryPI</code>laying around, it would be run to run it on there.</p>
          
          <p>This code does the following things:</p>
          
          <ol>
          <li>Find the local broadcast address.  This is normally <code>192.168.1.255</code> on home routers but could be anything.</li>
          <li>Send 4 pings to the broadcast address and listen for replies.  It may take some time to return back,which is why we have multiple pings.  Collect those IP addresses as a response.</li>
          <li>Do a reverse DNS lookup on those IP addresses, and mark them as seen in <code>redis</code>.</li>
          <li>(Commented out) Look at the arp table to see if any other devices have announced themselves.  This will discover mode devices, but the ARP cache lasts an unknown amount of time, so this will not correctly track leaving events.</li>
          <li>The <code>def seen</code> method will set a key in <code>redis</code> and expire it in <code>30</code> seconds.  The scan runs every <code>10</code> seconds.  So if we having seen a device in 2 or 3 scans then we assume it has left the network.  We look at each of the keys in the redis set <code>hosts</code> to see if it still exists, and if not, assume that the device has left.</li>
          </ol>
          
          <h2 id="the-code">The Code</h2>
          
          <p>The only <code>OSX</code> ism of this script is that its using <code>osascript</code> to push a notification to the desktop that a device name has come on or left.  See below for further things to play with:</p>
          
          <pre><code>#!/usr/bin/env ruby -wKU&#x000A;&#x000A;require &#39;resolv&#39;&#x000A;require &#39;redis&#39;&#x000A;&#x000A;def notify( text )&#x000A;  system( &quot;/usr/bin/osascript -e \&quot;display notification \\\&quot;#{text}\\\&quot;\&quot;&quot; )&#x000A;end&#x000A;&#x000A;def scan&#x000A;  # Look for the network broadcast address&#x000A;  broadcast = `ifconfig -a | grep broadcast`.split[-1]&#x000A;&#x000A;  # puts &quot;Broadcast Address #{broadcast}&quot;&#x000A;&#x000A;  unless broadcast =~ /\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}/&#x000A;    puts &quot;#{broadcast} doesn&#39;t look correct&quot;&#x000A;    exit 1&#x000A;  end&#x000A;&#x000A;  # Ping the broadcast address 4 times and wait for responses&#x000A;  ips = `ping -t 4 #{broadcast}`.split(/\n/).collect do |x|&#x000A;    if x =~ /(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}):/&#x000A;      $1&#x000A;    else&#x000A;      nil&#x000A;    end&#x000A;  end.select { |x| x &amp;&amp; x != broadcast}.sort.uniq&#x000A;&#x000A;  dns = Resolv.new&#x000A;&#x000A;  # Do a host name lookup on all of the addresses and put in redis&#x000A;  ips.each do |ip|&#x000A;    name = dns.getname ip&#x000A;    seen( name )&#x000A;  end&#x000A;&#x000A;  # If you want to catch the other devices that don&#39;t respond to pings&#x000A;  # but have an arp, you can scan below.  However, arp addresses get&#x000A;  # cached for a while, &#x000A;  # Catch the other devices that don&#39;t respond to pings but have arp addresses&#x000A;  # (pinging the broadcast address will help populate the local arp table)&#x000A;  # `arp -a`.split( /\n/ ).collect do |x|&#x000A;  #   if x =~ /^([^\s]*).*\((\d+\.\d+\.\d+\.\d+)\)/&#x000A;  #     seen( $1 )&#x000A;  #   end&#x000A;  # end&#x000A;&#x000A;  # Look through all of the members in redis, and for any ones that have&#x000A;  # expired say that they&#39;ve left the system&#x000A;  redis = Redis.new&#x000A;&#x000A;  redis.smembers( &quot;hosts&quot; ).each do |host|&#x000A;    unless redis.get host&#x000A;      redis.srem &quot;hosts&quot;, host&#x000A;&#x000A;      puts &quot;#{Time.new} #{host} left the network&quot;&#x000A;      notify &quot;#{host} left the network&quot;&#x000A;    end&#x000A;  end&#x000A;end&#x000A;&#x000A;# Mark the name as being seen.  Create a key with the name and expire it in&#x000A;# 30 seconds.  Also add it to the hosts set.  If we don&#39;t see the name again&#x000A;# in 3 sweeps, the key will expire.&#x000A;def seen( name )&#x000A;  name = name.downcase&#x000A;  redis = Redis.new&#x000A;  unless redis.get name&#x000A;    puts &quot;#{Time.new} #{name} joined the network&quot;&#x000A;    notify &quot;#{name} joined the network&quot;&#x000A;  end&#x000A;  redis.set name, &quot;1&quot;&#x000A;  redis.expire name, &quot;30&quot;&#x000A;  redis.sadd &quot;hosts&quot;, name&#x000A;end&#x000A;&#x000A;# Run forever&#x000A;while true&#x000A;  scan&#x000A;  sleep 10&#x000A;end&#x000A;</code></pre>
          
          <h2 id="next-steps">Next steps</h2>
          
          <p>Other things to play around with:</p>
          
          <ol>
          <li><code>nmap -O hostname</code> will do a scan of the device to see what operation system it is.  However, this is a little more intrusive, needs to run as root, and takes a while to run so it should be queued.</li>
          <li>Instead of using osascript, post the device joined, left, or presence events to an internal website to make a better UI.</li>
          <li>This would allow you to map multiple device names to a person.  For example, I know that <code>willschiphone5s.home</code> is my phone and <code>combray.home</code> is my computer, but how do you keep a mapping of those names to people?</li>
          <li><code>MAC addresses</code> should be stable for devices once they may contact to the site.  We can get this from the <code>arp</code> tables, and those can&#39;t be changed like the computer names can.</li>
          </ol>
          
          <p>Remember, information can bleed and there&#39;s a whole lot you can do to see about the people around you.</p>
        </div>
        <div class='navigation' data-offset-top='400' data-spy='affix'>
          <div class='next'>
            <p>
              Next in
              <a href="/tag/Chronological.html">Chronological</a>
            </p>
            <p class='title'><a href="/bootstrap-advanced-grid-tricks/">Bootstrap: Advanced Grid Tricks</a></p>
            <p>
              Next in
              <a href="/tag/Toys.html">Toys</a>
            </p>
            <p class='title'><a href="/embedding-3d-models-on-your-page/">Embedding 3d models on your page</a></p>
            <p>
              Next in
              <a href="/tag/Ruby.html">Ruby</a>
            </p>
            <p class='title'><a href="/making-a-command-line-utility-with-gems-and-thor/">Making a command line utility with gems and thor</a></p>
            <p>
              Next in
              <a href="/tag/Howto.html">Howto</a>
            </p>
            <p class='title'><a href="/making-yosemite-faster/">Making Yosemite Faster</a></p>
          </div>
          <div class='prev'>
          </div>
        </div>
      </div>
      <div class="row article_footer">
        <div class="comments">
            <a href="#" id="comment_shower">
              <span class="socicon socicon-disqus fgcolor"></span>
              <span class="disqus-comment-count" data-disqus-identifier="silvrback-wschenk-9332">Be the first to comment.</span>
            </a>
        </div>
        <div class="sharing">
          <a href="http://www.twitter.com/share?url=http://willschenk.com//how-to-track-your-coworkers/&amp;text=How to track your coworkers by @wschenk" title="Share this post on Twitter" data-lang="en" onclick="return !window.open(this.href, 'Twitter', 'width=640,height=300')"><span class="socicon socicon-twitter fgcolor"></span></a>
      
          <a target="_blank" onclick="return !window.open(this.href, 'Facebook', 'width=640,height=300')" href="http://www.facebook.com/sharer/sharer.php?u=http://willschenk.com//how-to-track-your-coworkers/" title="Share this post on Facebook"><span class="socicon socicon-facebook fgcolor"></span></a>
      
          <a href="http://plus.google.com/share?url=http://willschenk.com//how-to-track-your-coworkers/" target="_blank" onclick="return !window.open(this.href, 'Google +', 'width=640,height=300')" title="Share this post on Google +"><span class="socicon socicon-google fgcolor"></span></a>
        </div>
      </div>
        <div class="comment_row">
          <div class="comment_universe">
            <div id="disqus_thread" class="col-sm-10 col-sm-offset-1"></div>
          </div>
        </div>
    </div>
    <footer class='academy'>
      <div class='container'>
        <div class='row'>
          <div class='logo'>
            <a href='http://academy.happyfuncorp.com/'>
              <img class="img-responsive" src="../images/academy-logo-f112afa1.png" />
            </a>
          </div>
          <div class='body'>
            <h1>Come join us in person!</h1>
            <p>HFC Technology Academy is dedicated to teaching people the skills they need to succeed in the world of technology and startups.</p>
            <p>The Academy is for anyone with the passion to learn about entrepreneurship, development, product management and other skills within the start-up community.</p>
            <h2><a href="http://academy.happyfuncorp.com/">Read about our free events</a></h2>
          </div>
        </div>
      </div>
    </footer>
    <footer class='footer  '>
      <div class='container'>
        <div class='row'>
          <div class='social'>
            <span>
              <a class='webicon twitter' href='http://twitter.com/wschenk'></a>
            </span>
            <span>
              <a class='webicon tumblr' href='http://sublimeguile.com/'></a>
            </span>
            <span>
              <a class='webicon instagram' href='http://instagram.com/wschenk'></a>
            </span>
            <span>
              <a class='webicon linkedin' href='http://www.linkedin.com/pub/will-schenk/0/266/420/'></a>
            </span>
            <span>
              <a class='webicon github' href='https://github.com/wschenk'></a>
            </span>
            <span>
              <a class='webicon rss' href='http://willschenk.com/feed.xml'></a>
            </span>
            <span>
              <a class='webicon mail' href='mailto:will@happyfuncorp.com'></a>
            </span>
          </div>
          <div class='made_in_bk'>
            <h3>Made in Brooklyn, NY</h3>
          </div>
        </div>
      </div>
    </footer>
    <script src="../javascripts/application-b5017286.js" type="text/javascript"></script><script src="../javascripts/modernizr-84a49412.js" type="text/javascript"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.3/highlight.min.js"></script>
    <script type="text/javascript">
      var _gaq=[['_setAccount','UA-56296045-1'],['_trackPageview']];
      (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
      g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
      s.parentNode.insertBefore(g,s)}(document,'script'));
    </script>
    
    <script type="text/javascript">
      hljs.initHighlightingOnLoad();
      $(".article img").addClass( "img-responsive");
      $("iframe").map( function(e) {
        $(this).css( "max-width", $(this).width() );
        $(this).width( "100%" );
      });
      var _gaq=[['_setAccount','UA-56296045-1'],['_trackPageview']];
      (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
      g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
      s.parentNode.insertBefore(g,s)}(document,'script'));
      var disqus_shortname = 'willschenk';
        var disqus_identifier = 'silvrback-wschenk-9332';
            
      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
      (function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
    </script>
  </body>
</html>
