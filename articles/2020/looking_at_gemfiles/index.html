<!doctype html><html><head><title>Looking at Gemfiles</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=stylesheet href=../../../css/theme.css><link rel=stylesheet href=../../../css/syntax.css><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-56296045-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script async defer data-domain=willschenk.com src=https://plausible.io/js/plausible.js></script><meta property="og:title" content="Looking at Gemfiles"><meta property="og:description" content="Bundler is the standard way for ruby projects to specifiy dependancies. Lets take a look at how that works, reimplement bundle outdated, and be able to see the changes that took place between the build you are using at the latest one. Ruby ecosystem: Rubygems, Bundler, Gemfile, Gemfile.lock   rubygems is the overall ecosystem, which includes the main rubygems.org database of shared packages, and how they depend upon each other."><meta property="og:type" content="article"><meta property="og:url" content="https://willschenk.com/articles/2020/looking_at_gemfiles/"><meta property="article:published_time" content="2020-09-04T00:00:00+00:00"><meta property="article:modified_time" content="2020-09-04T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Looking at Gemfiles"><meta name=twitter:description content="Bundler is the standard way for ruby projects to specifiy dependancies. Lets take a look at how that works, reimplement bundle outdated, and be able to see the changes that took place between the build you are using at the latest one. Ruby ecosystem: Rubygems, Bundler, Gemfile, Gemfile.lock   rubygems is the overall ecosystem, which includes the main rubygems.org database of shared packages, and how they depend upon each other."><meta name=twitter:site content="@wschenk"><style>.article p,.article ul,.article ol,.article table{max-width:45em}.article pre p{max-width:none;margin-top:-1.5rem}article.article p:first-child,.article blockquote{font-size:1.25em;font-weight:300;max-width:36em}.half-height-scroll{max-height:32em;overflow:scroll}</style></head><body><nav class="container my-5"><h1 class="pt-md-5 display-3"><a class=text-dark href=../../../>Will Schenk</a></h1><p><a class="text-dark h4 mr-3 font-weight-light" href=../../../articles/>Articles</a>
<a class="text-dark h4 mr-3 font-weight-light" href=../../../contact>Contact</a>
<a class="text-dark h4 mr-3 font-weight-light" href=../../../tags/>Tags</a>
<a href=../../../feed.xml class="mr-3 h4 text-light"><img src=../../../img/rss.svg alt=rss height=20 width=20></a>
<a href=https://twitter.com/@wschenk class="mr-3 h4 text-light"><img src=../../../img/twitter.svg alt=twitter height=20 width=20></a>
<a href=https://instagram.com/wschenk class="mr-3 h4 text-light"><img src=../../../img/instagram.svg alt=instagram height=20 width=20></a>
<a href=https://github.com/wschenk class="mr-3 h4 text-light"><img src=../../../img/github.svg alt=github height=20 width=20></a>
<a href=https://linkedin.com/in/will-schenk-420266 class="mr-3 h4 text-light"><img src=../../../img/linkedin.svg alt=linkedin height=20 width=20></a></p></nav><div class=container><h1 class=mt-5>Looking at Gemfiles</h1><h2 class="font-weight-light font-italic mb-3">making sense of Gemfile.lock</h2><p class="text-muted mt-3"><a class=text-muted href=https://willschenk.com/articles/2020/looking_at_gemfiles/>Published September 4, 2020</a>
<a class=text-muted href=../../../tags/ruby>#ruby,</a>
<a class=text-muted href=../../../tags/bundler>#bundler,</a>
<a class=text-muted href=../../../tags/packagemanagers>#packagemanagers,</a>
<a class=text-muted href=../../../tags/git>#git</a></p><article class="article mt-5"><p>Bundler is the standard way for ruby projects to specifiy
dependancies. Lets take a look at how that works, reimplement <code class=verbatim>bundle
outdated</code>, and be able to see the changes that took place between the
build you are using at the latest one.</p><h2 id=headline-1>Ruby ecosystem: Rubygems, Bundler, Gemfile, Gemfile.lock</h2><p><code class=verbatim>rubygems</code> is the overall ecosystem, which includes the main
<code class=verbatim>rubygems.org</code> database of shared packages, and how they depend upon
each other. At the heart of it is a <code class=verbatim>gemspec</code> file which describes the
package, files included in it, dependancies and other metadata.</p><p><code class=verbatim>bundler</code> the tool that helps you download and install specific gems for
your application. It used a <code class=verbatim>Gemfile</code> to define what you want, and the
resolves all the dependancies stores that into a <code class=verbatim>Gemfile.lock</code> file
that contains a list of the exact versions that you are developing
against.</p><h2 id=headline-2>Creating a working <code class=verbatim>Gemfile</code></h2><p>First lets create a project, so we are all working off of the same
thing. We'll add <code class=verbatim>bunder</code> as normal, and then <code class=verbatim>irb</code> from git directly so
we can see how that changes the <code class=verbatim>Gemfile.lock</code>. So, 3 gems, 2 from
<code class=verbatim>rubygems.org</code> and one directly from <code class=verbatim>github</code>.</p><div class="src src-bash"><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>bundle init
bundle add bundler --version <span class=s2>&#34;~&gt;2.1&#34;</span>
bundle add irb --git <span class=s2>&#34;https://github.com/ruby/irb&#34;</span>
bundle add gems --version <span class=s2>&#34;1.1.1&#34;</span></code></pre></div></div><p>Lets also add in a <code class=verbatim>ruby "2.6.6"</code> line that will tell bundler which
version of ruby we want to use. This isn't always used but lets put
it in to flesh out what is generated in the lock file. Feel free to
replace this with whatever version is on your local machine.</p><p>Which gives us a <code class=verbatim>Gemfile</code> that looks like this:</p><div class="src src-ruby"><div class=highlight><pre class=chroma><code class=language-ruby data-lang=ruby><span class=c1># frozen_string_literal: true</span>

<span class=n>source</span> <span class=s2>&#34;https://rubygems.org&#34;</span>

<span class=n>git_source</span><span class=p>(</span><span class=ss>:github</span><span class=p>)</span> <span class=p>{</span><span class=o>|</span><span class=n>repo_name</span><span class=o>|</span> <span class=s2>&#34;https://github.com/</span><span class=si>#{</span><span class=n>repo_name</span><span class=si>}</span><span class=s2>&#34;</span> <span class=p>}</span>

<span class=n>ruby</span> <span class=s2>&#34;2.6.6&#34;</span>
<span class=c1># gem &#34;rails&#34;</span>

<span class=n>gem</span> <span class=s2>&#34;bundler&#34;</span><span class=p>,</span> <span class=s2>&#34;~&gt; 2.1&#34;</span>

<span class=n>gem</span> <span class=s2>&#34;irb&#34;</span><span class=p>,</span> <span class=ss>git</span><span class=p>:</span> <span class=s2>&#34;https://github.com/ruby/irb&#34;</span>

<span class=n>gem</span> <span class=s2>&#34;gems&#34;</span><span class=p>,</span> <span class=s2>&#34;1.1.1&#34;</span></code></pre></div></div><p>Doing a <code class=verbatim>bundle add</code> adds the specification to the <code class=verbatim>Gemfile</code>, downloads
the gems and all of it's dependancies, resolving specific versions and
downloading those as well. This is specified in the lock file, which
has the main sections:</p><ol><li><p><code class=verbatim>GIT</code> which is the first remote source on the list, here telling
which commit that we are depending upon specifically.</p></li><li><p><code class=verbatim>GEM</code> which list out the the gems that are installed, with versions</p></li><li><p><code class=verbatim>PLATFORMS</code> which is for platform information (for native builds)</p></li><li><p><code class=verbatim>DEPENDENCIES</code> which is what comes out of the <code class=verbatim>Gemfile</code></p></li><li><p><code class=verbatim>RUBY VERSION</code> the version of ruby, including the patch level, that
this was bundled with.</p></li><li><p><code class=verbatim>BUNDLED WITH</code> version information about bundler.</p></li></ol><div class="src src-ruby"><div class=highlight><pre class=chroma><code class=language-ruby data-lang=ruby><span class=no>GIT</span>
  <span class=ss>remote</span><span class=p>:</span> <span class=ss>https</span><span class=p>:</span><span class=sr>//</span><span class=n>github</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>ruby</span><span class=o>/</span><span class=n>irb</span>
  <span class=ss>revision</span><span class=p>:</span> <span class=mi>9</span><span class=n>bb6562d0d841fd294e95bbb690e812cbd5090ce</span>
  <span class=ss>specs</span><span class=p>:</span>
    <span class=n>irb</span> <span class=p>(</span><span class=mi>1</span><span class=o>.</span><span class=mi>2</span><span class=o>.</span><span class=mi>4</span><span class=p>)</span>
      <span class=n>reline</span> <span class=p>(</span><span class=o>&gt;=</span> <span class=mi>0</span><span class=o>.</span><span class=mi>0</span><span class=o>.</span><span class=mi>1</span><span class=p>)</span>

<span class=no>GEM</span>
  <span class=ss>remote</span><span class=p>:</span> <span class=ss>https</span><span class=p>:</span><span class=sr>//</span><span class=n>rubygems</span><span class=o>.</span><span class=n>org</span><span class=o>/</span>
  <span class=ss>specs</span><span class=p>:</span>
    <span class=n>gems</span> <span class=p>(</span><span class=mi>1</span><span class=o>.</span><span class=mi>1</span><span class=o>.</span><span class=mi>1</span><span class=p>)</span>
      <span class=n>json</span>
    <span class=n>io</span><span class=o>-</span><span class=n>console</span> <span class=p>(</span><span class=mi>0</span><span class=o>.</span><span class=mi>5</span><span class=o>.</span><span class=mi>6</span><span class=p>)</span>
    <span class=n>json</span> <span class=p>(</span><span class=mi>2</span><span class=o>.</span><span class=mi>3</span><span class=o>.</span><span class=mi>1</span><span class=p>)</span>
    <span class=n>reline</span> <span class=p>(</span><span class=mi>0</span><span class=o>.</span><span class=mi>1</span><span class=o>.</span><span class=mi>4</span><span class=p>)</span>
      <span class=n>io</span><span class=o>-</span><span class=n>console</span> <span class=p>(</span><span class=o>~&gt;</span> <span class=mi>0</span><span class=o>.</span><span class=mi>5</span><span class=p>)</span>

<span class=no>PLATFORMS</span>
  <span class=n>ruby</span>

<span class=no>DEPENDENCIES</span>
  <span class=n>bundler</span> <span class=p>(</span><span class=o>~&gt;</span> <span class=mi>2</span><span class=o>.</span><span class=mi>1</span><span class=p>)</span>
  <span class=n>gems</span> <span class=p>(</span><span class=o>=</span> <span class=mi>1</span><span class=o>.</span><span class=mi>1</span><span class=o>.</span><span class=mi>1</span><span class=p>)</span>
  <span class=n>irb!</span>

<span class=no>RUBY</span> <span class=no>VERSION</span>
   <span class=n>ruby</span> <span class=mi>2</span><span class=o>.</span><span class=mi>6</span><span class=o>.</span><span class=mi>6</span><span class=n>p146</span>

<span class=no>BUNDLED</span> <span class=no>WITH</span>
   <span class=mi>2</span><span class=o>.</span><span class=mi>1</span><span class=o>.</span><span class=mi>4</span></code></pre></div></div><h2 id=headline-3>Parsing <code class=verbatim>Gemfile</code> and <code class=verbatim>Gemfile.lock</code> together</h2><p>In normal usage you would have both a <code class=verbatim>Gemfile</code> and a <code class=verbatim>Gemfile.lock</code>.
You'd start up your program using <code class=verbatim>bundle exec</code> which would validate
that the right things were installed, load the gems into the ruby
environment, and you'd be good to go.</p><div class="src src-ruby"><div class=highlight><pre class=chroma><code class=language-ruby data-lang=ruby>  <span class=c1>#!/usr/bin/env ruby</span>
  <span class=nb>require</span> <span class=s1>&#39;bundler&#39;</span>

  <span class=n>context</span> <span class=o>=</span> <span class=no>Bundler</span><span class=o>.</span><span class=n>load</span>

  <span class=nb>puts</span> <span class=s2>&#34;Dependencies&#34;</span>
  <span class=n>context</span><span class=o>.</span><span class=n>dependencies</span><span class=o>.</span><span class=n>each</span> <span class=k>do</span> <span class=o>|</span><span class=n>x</span><span class=o>|</span>
    <span class=nb>printf</span> <span class=s2>&#34;%-20s %s</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>x</span><span class=o>.</span><span class=n>name</span><span class=p>,</span> <span class=n>x</span><span class=o>.</span><span class=n>requirements_list</span><span class=o>.</span><span class=n>to_s</span>
  <span class=k>end</span>

  <span class=nb>puts</span>
  <span class=n>context</span><span class=o>.</span><span class=n>specs</span><span class=o>.</span><span class=n>each</span> <span class=k>do</span> <span class=o>|</span><span class=n>s</span><span class=o>|</span>
    <span class=n>code</span> <span class=o>=</span> <span class=n>s</span><span class=o>.</span><span class=n>metadata</span><span class=o>[</span><span class=s1>&#39;source_code_url&#39;</span><span class=o>]</span> <span class=o>||</span> <span class=n>s</span><span class=o>.</span><span class=n>metadata</span><span class=o>[</span><span class=s1>&#39;source_code_uri&#39;</span><span class=o>]</span>
    <span class=nb>puts</span> <span class=s2>&#34;Gem from </span><span class=si>#{</span><span class=n>s</span><span class=o>.</span><span class=n>source</span><span class=o>.</span><span class=n>to_s</span><span class=si>}</span><span class=s2>&#34;</span>
    <span class=nb>printf</span> <span class=s2>&#34;%-20s %-10s %-40s %s</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>s</span><span class=o>.</span><span class=n>name</span><span class=p>,</span> <span class=n>s</span><span class=o>.</span><span class=n>version</span><span class=o>.</span><span class=n>to_s</span><span class=p>,</span> <span class=n>code</span><span class=p>,</span> <span class=n>s</span><span class=o>.</span><span class=n>homepage</span>
  <span class=k>end</span></code></pre></div></div><p>Which yields:</p><pre class=example>
Dependencies
irb                  [&#34;&gt;= 0&#34;]
bundler              [&#34;~&gt; 2.1&#34;]

Gem from the local ruby installation
bundler              2.1.4      https://github.com/bundler/bundler/      https://bundler.io
Gem from rubygems repository https://rubygems.org/ or installed locally
gems                 1.2.0                                               https://github.com/rubygems/gems
Gem from rubygems repository https://rubygems.org/ or installed locally
io-console           0.5.6      https://github.com/ruby/io-console       https://github.com/ruby/io-console
Gem from rubygems repository https://rubygems.org/ or installed locally
reline               0.1.4                                               https://github.com/ruby/reline
Gem from https://github.com/ruby/irb (at master@9bb6562)
irb                  1.2.4                                               https://github.com/ruby/irb
</pre><p>So some gems have <code class=verbatim>source_code_uri</code> or <code class=verbatim>source_code_url</code> set, and some
don't have it at all though they point to a <code class=verbatim>github</code> page where
presumably we can figure out where the code is loaded.</p><p>For the case of <code class=verbatim>irb</code> the repo is listed in the remote <code class=verbatim>source</code> itself.</p><p>The metadata, homepage, etc are from the <code class=verbatim>gemspec</code> files.</p><h2 id=headline-4>Parsing a <code class=verbatim>Gemfile.lock</code> directly</h2><p>Let's now look at how to parse a <code class=verbatim>Gemfile.lock</code> of a different project,
where we don't have the original <code class=verbatim>Gemfile</code> handy.</p><p>When we load in the lockfile using <code class=verbatim>Bundler::LockfileParser</code> we only
have the gem name, version, and the source from which to get it. We
may or may not have the gemspec on our local machine, and so
additional metadata like the homepage, summary, codeurl, etc haven't
been loaded yet. Lets first print out what we have and then figure
out how to get gem information from the source, name, and version.</p><div class="src src-ruby"><div class=highlight><pre class=chroma><code class=language-ruby data-lang=ruby><span class=ch>#!/usr/bin/env ruby</span>
<span class=nb>require</span> <span class=s1>&#39;bundler&#39;</span>

<span class=k>def</span> <span class=nf>describe_lockfile</span> <span class=n>file</span> <span class=o>=</span> <span class=no>Bundler</span><span class=o>.</span><span class=n>default_lockfile</span>
  <span class=n>context</span> <span class=o>=</span> <span class=no>Bundler</span><span class=o>::</span><span class=no>LockfileParser</span><span class=o>.</span><span class=n>new</span><span class=p>(</span> <span class=no>Bundler</span><span class=o>.</span><span class=n>read_file</span><span class=p>(</span> <span class=n>file</span> <span class=p>)</span> <span class=p>)</span>
  <span class=nb>puts</span> <span class=s2>&#34;Bundler version&#34;</span>
  <span class=nb>puts</span> <span class=n>context</span><span class=o>.</span><span class=n>bundler_version</span><span class=o>.</span><span class=n>to_s</span>

  <span class=nb>puts</span>
  <span class=nb>puts</span> <span class=s2>&#34;Dependencies&#34;</span>
  <span class=n>context</span><span class=o>.</span><span class=n>dependencies</span><span class=o>.</span><span class=n>each</span> <span class=k>do</span> <span class=o>|</span><span class=nb>name</span><span class=p>,</span><span class=n>x</span><span class=o>|</span>
    <span class=nb>printf</span> <span class=s2>&#34;%-20s %s</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>x</span><span class=o>.</span><span class=n>name</span><span class=p>,</span> <span class=n>x</span><span class=o>.</span><span class=n>requirements_list</span><span class=o>.</span><span class=n>to_s</span>
  <span class=k>end</span>

  <span class=nb>puts</span>
  <span class=nb>puts</span> <span class=s2>&#34;Gems&#34;</span>
  <span class=n>context</span><span class=o>.</span><span class=n>specs</span><span class=o>.</span><span class=n>each</span> <span class=k>do</span> <span class=o>|</span><span class=n>s</span><span class=o>|</span>
    <span class=nb>printf</span> <span class=s2>&#34;%-20s %-10s</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>s</span><span class=o>.</span><span class=n>name</span><span class=p>,</span> <span class=n>s</span><span class=o>.</span><span class=n>version</span><span class=o>.</span><span class=n>to_s</span>
    <span class=nb>printf</span> <span class=s2>&#34;%-10s %s</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>s</span><span class=o>.</span><span class=n>source</span><span class=o>.</span><span class=n>class</span><span class=p>,</span> <span class=n>s</span><span class=o>.</span><span class=n>source</span><span class=o>.</span><span class=n>to_s</span>
  <span class=k>end</span>
<span class=k>end</span>

<span class=n>describe_lockfile</span></code></pre></div></div><pre class=example>
Bundler version
2.1.4

Dependencies
bundler              [&#34;~&gt; 2.1&#34;]
gems                 [&#34;~&gt; 1.2&#34;]
irb                  [&#34;&gt;= 0&#34;]

Gems
gems                 1.2.0     
Bundler::Source::Rubygems rubygems repository https://rubygems.org/ or installed locally
io-console           0.5.6     
Bundler::Source::Rubygems rubygems repository https://rubygems.org/ or installed locally
irb                  1.2.4     
Bundler::Source::Git https://github.com/ruby/irb (at master@9bb6562)
reline               0.1.4     
Bundler::Source::Rubygems rubygems repository https://rubygems.org/ or installed locally
</pre><p>Another thing that's interesting to node is that the version of
<code class=verbatim>bundler</code> itself doesn't show up in the specified gems, though it is
available from the <code class=verbatim>bundler_version</code> method.</p><h2 id=headline-5>Finding outdated gem versions</h2><p>If you are working with a matching set of <code class=verbatim>Gemfile</code> and <code class=verbatim>Gemfile.lock</code>
files, which most people are, there's a nifty command <code class=verbatim>bundle outdated</code>.
This looks though the gems that you have to see if there's a later
version released.</p><p>Lets recreate this using our <code class=verbatim>Gemfile.lock</code> only method so we can look
at lock files and see which gems have updated code.</p><p>First we will pull the specs out of the lockfile. Then we will loop
over them pulling in the infomation from <code class=verbatim>rubygems</code> or wherever the
remote was specified. We aren't doing anything special with git
sourced gems.</p><div class="src src-ruby"><div class=highlight><pre class=chroma><code class=language-ruby data-lang=ruby>  <span class=c1>#!/usr/bin/env ruby</span>
  <span class=nb>require</span> <span class=s1>&#39;bundler&#39;</span>
  <span class=nb>require</span> <span class=s1>&#39;gems&#39;</span>

  <span class=k>def</span> <span class=nf>specs_from_lockfile</span> <span class=n>file</span> <span class=o>=</span> <span class=no>Bundler</span><span class=o>.</span><span class=n>default_lockfile</span>
    <span class=n>gems</span> <span class=o>=</span> <span class=p>{}</span>
    <span class=n>context</span> <span class=o>=</span> <span class=no>Bundler</span><span class=o>::</span><span class=no>LockfileParser</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=no>Bundler</span><span class=o>.</span><span class=n>read_file</span><span class=p>(</span><span class=n>file</span><span class=p>))</span>
    <span class=n>context</span><span class=o>.</span><span class=n>specs</span><span class=o>.</span><span class=n>each</span> <span class=k>do</span> <span class=o>|</span><span class=n>info</span><span class=o>|</span>
      <span class=n>gems</span><span class=o>[</span><span class=n>info</span><span class=o>.</span><span class=n>name</span><span class=o>]</span> <span class=o>=</span> <span class=p>{</span><span class=ss>version</span><span class=p>:</span> <span class=n>info</span><span class=o>.</span><span class=n>version</span><span class=o>.</span><span class=n>to_s</span><span class=p>,</span> <span class=ss>source</span><span class=p>:</span> <span class=n>info</span><span class=o>.</span><span class=n>source</span><span class=o>.</span><span class=n>class</span> <span class=p>}</span>
      <span class=k>if</span> <span class=n>info</span><span class=o>.</span><span class=n>source</span><span class=o>.</span><span class=n>is_a?</span> <span class=no>Bundler</span><span class=o>::</span><span class=no>Source</span><span class=o>::</span><span class=no>Rubygems</span>
        <span class=n>gems</span><span class=o>[</span><span class=n>info</span><span class=o>.</span><span class=n>name</span><span class=o>][</span><span class=ss>:remote</span><span class=o>]</span> <span class=o>=</span> <span class=n>info</span><span class=o>.</span><span class=n>source</span><span class=o>.</span><span class=n>remotes</span><span class=o>.</span><span class=n>first</span><span class=o>.</span><span class=n>to_s</span> 
      <span class=k>elsif</span> <span class=n>info</span><span class=o>.</span><span class=n>source</span><span class=o>.</span><span class=n>is_a?</span> <span class=no>Bundler</span><span class=o>::</span><span class=no>Source</span><span class=o>::</span><span class=no>Git</span>
        <span class=n>gems</span><span class=o>[</span><span class=n>info</span><span class=o>.</span><span class=n>name</span><span class=o>][</span><span class=ss>:remote</span><span class=o>]</span> <span class=o>=</span> <span class=n>info</span><span class=o>.</span><span class=n>source</span><span class=o>.</span><span class=n>uri</span> 
        <span class=n>gems</span><span class=o>[</span><span class=n>info</span><span class=o>.</span><span class=n>name</span><span class=o>][</span><span class=ss>:ref</span><span class=o>]</span> <span class=o>=</span> <span class=n>info</span><span class=o>.</span><span class=n>source</span><span class=o>.</span><span class=n>ref</span>
        <span class=n>gems</span><span class=o>[</span><span class=n>info</span><span class=o>.</span><span class=n>name</span><span class=o>][</span><span class=ss>:revision</span><span class=o>]</span> <span class=o>=</span> <span class=n>info</span><span class=o>.</span><span class=n>source</span><span class=o>.</span><span class=n>revision</span>
      <span class=k>else</span>
        <span class=nb>puts</span> <span class=s2>&#34;Not sure how to process </span><span class=si>#{</span><span class=n>info</span><span class=o>.</span><span class=n>source</span><span class=o>.</span><span class=n>class</span><span class=si>}</span><span class=s2>&#34;</span>
      <span class=k>end</span>
    <span class=k>end</span>
    <span class=n>gems</span>
  <span class=k>end</span>

  <span class=k>def</span> <span class=nf>add_rubygems_versions</span> <span class=n>info</span>
    <span class=n>info</span><span class=o>.</span><span class=n>each</span> <span class=k>do</span> <span class=o>|</span><span class=nb>name</span><span class=p>,</span> <span class=n>spec</span><span class=o>|</span>
      <span class=k>if</span> <span class=n>spec</span><span class=o>[</span><span class=ss>:source</span><span class=o>]</span> <span class=o>==</span> <span class=no>Bundler</span><span class=o>::</span><span class=no>Source</span><span class=o>::</span><span class=no>Rubygems</span>
        <span class=n>gems_client</span> <span class=o>=</span> <span class=no>Gems</span><span class=o>::</span><span class=no>Client</span><span class=o>.</span><span class=n>new</span><span class=p>(</span> <span class=p>{</span> <span class=ss>host</span><span class=p>:</span> <span class=n>spec</span><span class=o>[</span><span class=ss>:remote</span><span class=o>]</span> <span class=p>}</span> <span class=p>)</span>
        <span class=n>spec</span><span class=o>[</span><span class=ss>:info</span><span class=o>]</span> <span class=o>=</span> <span class=n>gems_client</span><span class=o>.</span><span class=n>info</span><span class=p>(</span> <span class=nb>name</span> <span class=p>)</span>
      <span class=k>elsif</span> <span class=n>spec</span><span class=o>[</span><span class=ss>:source</span><span class=o>]</span> <span class=o>==</span> <span class=no>Bundler</span><span class=o>::</span><span class=no>Source</span><span class=o>::</span><span class=no>Git</span>
        <span class=n>spec</span><span class=o>[</span><span class=ss>:info</span><span class=o>]</span> <span class=o>=</span> <span class=no>Gems</span><span class=o>.</span><span class=n>info</span><span class=p>(</span> <span class=nb>name</span> <span class=p>)</span>
      <span class=k>else</span>
        <span class=nb>puts</span> <span class=s2>&#34;Not sure of the source of </span><span class=si>#{</span><span class=nb>name</span><span class=si>}</span><span class=s2>&#34;</span>
      <span class=k>end</span>
    <span class=k>end</span>
  <span class=k>end</span>

  <span class=n>specs</span> <span class=o>=</span> <span class=n>specs_from_lockfile</span> <span class=no>ARGV</span><span class=o>[</span><span class=mi>0</span><span class=o>]</span> <span class=o>||</span> <span class=no>Bundler</span><span class=o>.</span><span class=n>default_lockfile</span>
  <span class=n>add_rubygems_versions</span><span class=p>(</span> <span class=n>specs</span> <span class=p>)</span>

  <span class=nb>printf</span> <span class=s2>&#34;%15s  %-8s %-8s %3s %s</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;Name&#34;</span><span class=p>,</span> <span class=s2>&#34;Current&#34;</span><span class=p>,</span> <span class=s2>&#34;Latest&#34;</span><span class=p>,</span> <span class=s2>&#34;Old&#34;</span><span class=p>,</span> <span class=s2>&#34;Info&#34;</span>

  <span class=n>specs</span><span class=o>.</span><span class=n>each</span> <span class=k>do</span> <span class=o>|</span><span class=nb>name</span><span class=p>,</span><span class=n>info</span><span class=o>|</span>
    <span class=n>info</span><span class=o>[</span><span class=ss>:info</span><span class=o>]</span> <span class=o>||=</span> <span class=p>{}</span>
    <span class=n>current_version</span> <span class=o>=</span> <span class=n>info</span><span class=o>[</span><span class=ss>:version</span><span class=o>]</span>
    <span class=n>new_version</span> <span class=o>=</span> <span class=n>info</span><span class=o>[</span><span class=ss>:info</span><span class=o>][</span><span class=s2>&#34;version&#34;</span><span class=o>]</span>
    <span class=nb>printf</span> <span class=s2>&#34;%15s  %-8s %-8s %-3s %s</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> 
           <span class=nb>name</span><span class=p>,</span>
           <span class=n>current_version</span><span class=p>,</span>
           <span class=n>new_version</span><span class=p>,</span>
           <span class=n>current_version</span> <span class=o>==</span> <span class=n>new_version</span> <span class=p>?</span> <span class=s2>&#34;&#34;</span> <span class=p>:</span> <span class=s2>&#34;Y&#34;</span><span class=p>,</span>
           <span class=n>info</span><span class=o>[</span><span class=ss>:info</span><span class=o>][</span><span class=s2>&#34;info&#34;</span><span class=o>][</span><span class=mi>0</span><span class=o>..</span><span class=mi>50</span><span class=o>]</span>
  <span class=k>end</span></code></pre></div></div><pre class=example>
           Name  Current  Latest   Old Info
           gems  1.1.1    1.2.0    Y   Ruby wrapper for the RubyGems.org API
     io-console  0.5.6    0.5.6        add console capabilities to IO instances.
            irb  1.2.4    1.2.4        Interactive Ruby command-line tool for REPL (Read E
           json  2.3.1    2.3.1        This is a JSON implementation as a Ruby extension i
         reline  0.1.4    0.1.4        Alternative GNU Readline or Editline implementation
</pre><p>This is a very simple project, but we can see that the one gem that we
held back to <code class=verbatim>1.1.1</code> instead of the (current) latst of <code class=verbatim>1.2.0</code> is
outdated.</p><h2 id=headline-6>Future thoughts</h2><p>Looking at the <code class=verbatim>Gemfile.lock</code> file we're able to see which versions of
the gems are installed, and we can pull down the git repos of most of
them using the metadata. (Or homepage, for a lot of them.) The
standard bundling tools will create a git tag for each of the
releases, so in our next installment we will start looking seeing the
code different between the versions, both the commit messages as well
as overall activity in these projects. This should help us understand
how risky the upgrades are, and if we believe in semvar.</p><h2 id=headline-7>References</h2><ol><li><p><a href=https://stackoverflow.com/questions/38800129/parsing-a-gemfile-lock-with-bundl>https://stackoverflow.com/questions/38800129/parsing-a-gemfile-lock-with-bundl</a></p></li><li><p><a href=https://rdoc.info/github/bundler/bundler/Bundler/LazySpecification>https://rdoc.info/github/bundler/bundler/Bundler/LazySpecification</a></p></li><li><p><a href=https://rdoc.info/github/rubygems/rubygems/Gem/Specification>https://rdoc.info/github/rubygems/rubygems/Gem/Specification</a></p></li></ol></article></div><div class="bg-light py-5"><div class=container><h2 class=text-center>Read next</h2><div class=row><div class="col-md-6 text-center"></div><div class="col-md-6 text-center">Previous Post:
<a href=../../../articles/2020/gitlog_in_sqlite/>gitlog in sqlite</a></div></div></div></div><div class="container mt-5"><h2 class=text-center>See also</h2><div class=row><div class="col-md mb-3"><p class="lead mb-0"><a class=text-body href=../../../articles/2020/checking_rss_health/>Checking health of RSS feeds</a></p><p class="lead font-italic mb-0">Lets clean out the old stuff</p><div class="font-weight-light mt-3"><p>I still use RSS feeds as my main way of consuming stuff on the internet. Old school. I was looking at the list of things that I've subscribed to which has been imported back from the Google Reader days, and figured I'd do some exploration of ye old OPML file. Setup the Gemfile We'll need to pull in a few gems here: source 'https://rubygems.org' gem 'httparty' # To pull stuff from the network gem 'feedjira' # To parse RSS feeds gem 'nokogiri' # To parse XML gem 'domainator' # To figured out the domain from the hostname gem 'whois' # To see how old the domain is gem 'whois-parser' # To actually make sense of the result And install everything bundle Look at domains First, lets see what we can find out about the machine that hosts the feed.</p></div><a href=../../../articles/2020/checking_rss_health/ class="btn btn-primary">Read more</a></div><div class="col-md mb-3"><p class="lead mb-0"><a class=text-body href=../../../articles/2019/splitting_git_repos_and_workdirectories/>Splitting Git Repos and Work Directories</a></p><p class="lead font-italic mb-0">all the fun things git can do</p><div class="font-weight-light mt-3"><p>I found a tutorial on how to manage your dotfiles, that works by splitting up the git repository (normally the .git directory) from the work directory. Since I have a lot of code that I put in my tutorials, I adapted the technique to have individual article directories mirrored in their own github repository.
Repositories and Work Directories The normal usage of git is to type git clone &lt;remote> to get a copy of the local directory, mess with stuff, and then add and commit your changes.</p></div><a href=../../../articles/2019/splitting_git_repos_and_workdirectories/ class="btn btn-primary">Read more</a></div></div></div><footer class="footer bg-dark text-light mt-3"><div class=container><h2 class="py-5 font-weight-light my-0">Made in Brooklyn, NY.</h2></div></footer></body></html>