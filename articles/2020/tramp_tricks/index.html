<!DOCTYPE html>
<html><head>
  <title>Emacs Tramp tricks</title>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../../css/theme.css"/>
  <link rel="stylesheet" href="../../../css/syntax.css"/>

  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-56296045-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  <meta property="og:title" content="Emacs Tramp tricks" />
<meta property="og:description" content="Emacs is amazing. It&rsquo;s a very different sort of thing than a code text editor like Vim or an IDE like VSCode. It&rsquo;s a different way of thinking of how to interact with a computer, where you build up techniques on top of simple tricks that let you get amazing things done. Of course, part of the appeal/challenge is that you need to figure out how to make it work yourself." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://willschenk.com/articles/2020/tramp_tricks/" />
<meta property="article:published_time" content="2020-03-01T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-03-01T00:00:00+00:00" />

  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Emacs Tramp tricks"/>
<meta name="twitter:description" content="Emacs is amazing. It&rsquo;s a very different sort of thing than a code text editor like Vim or an IDE like VSCode. It&rsquo;s a different way of thinking of how to interact with a computer, where you build up techniques on top of simple tricks that let you get amazing things done. Of course, part of the appeal/challenge is that you need to figure out how to make it work yourself."/>
<meta name="twitter:site" content="@wschenk"/>


  <style>
    .article p, .article ul, .article ol, .article table {
      max-width: 45em;
    }

    .article pre p {
    max-width: none;
    margin-top: -1.5rem;
    }

    article.article p:first-child, .article blockquote {
      font-size: 1.25em;
      font-weight: 300;
      max-width: 36em;  
    }
  </style>
</head>
<body><nav class="container my-5">
  <h1 class="pt-md-5 display-3"><a class="text-dark" href="../../../">Will Schenk</a></h1>
  <p>
    
      <a class="text-dark h4 mr-3 font-weight-light" href="../../../articles/" title="">Articles</a>
    
      <a class="text-dark h4 mr-3 font-weight-light" href="../../../contact" title="">Contact</a>
    
      <a class="text-dark h4 mr-3 font-weight-light" href="../../../tags/" title="">Tags</a>
    
    <a href="../../../feed.xml" class="mr-3 h4 text-light"><img src="../../../img/rss.svg" alt="rss" height="20" width="20"/></a>
    
      <a href="https://twitter.com/@wschenk" class="mr-3 h4 text-light"><img src="../../../img/twitter.svg" alt="twitter" height="20" width="20"/></a>
    
    
      <a href="https://instagram.com/wschenk" class="mr-3 h4 text-light"><img src="../../../img/instagram.svg" alt="instagram" height="20" width="20"/></a>
    
    
      <a href="https://github.com/wschenk" class="mr-3 h4 text-light"><img src="../../../img/github.svg" alt="github" height="20" width="20"/></a>
    
    
      <a href="https://linkedin.com/in/will-schenk-420266" class="mr-3 h4 text-light"><img src="../../../img/linkedin.svg" alt="linkedin" height="20" width="20"/></a>
    
  </p>
</nav>

<div class="container">
  <h1 class="mt-5">Emacs Tramp tricks</h1>

  
    <h2 class="font-weight-light font-italic mb-3">Replacing terminals with emacs</h2>
  

  <p class="text-muted mt-3">
    <a class="text-muted" href="https://willschenk.com/articles/2020/tramp_tricks/">Published March 1, 2020</a>

    
      <a class="text-muted" href="../../../tags/emacs">#emacs</a>
    
      <a class="text-muted" href="../../../tags/howto">#howto</a>
    
      <a class="text-muted" href="../../../tags/tramp">#tramp</a>
    
      <a class="text-muted" href="../../../tags/docker">#docker</a>
    
  </p>

  

  

  <article class="article mt-5">
    

<p>Emacs is amazing. It&rsquo;s a very different sort of thing than a code text editor like Vim or an IDE like VSCode. It&rsquo;s a different way of thinking of how to interact with a computer, where you build up techniques on top of simple tricks that let you get amazing things done.  Of course, part of the appeal/challenge is that you need to figure out how to make it work yourself.  Since there&rsquo;s not much in the way of gentle tutorials, lets look at what you can do with tramp to get a sense of what is possible.</p>

<h2 id="edit-a-file-on-a-remote-server">Edit a file on a remote server</h2>

<p>Lets say that you have a remote server named <code>ssb.willschenk.com</code> and you want to edit the <code>/etc/hosts</code> file.  We can open that up directly in emacs. The basic form for connecting to something using TRAMP is:</p>

<p><code>C-x C-f /remotehost:filename  RET (or /method:user@remotehost:filename)</code></p>

<p>So, for example, if I type <code>C-x C-f /ssh:root@ssb.willschenk.com:/etc/host</code>= it connects over ssh to the remote server and edits that file.  If I save the file, copy and paste stuff, etc it will transparently sync the file over the network. We don&rsquo;t need to install a text editor on this server, and we&rsquo;ll have all of our local configurations and copy and paste and all that stuff that we are used to. No installing <code>vim</code> for some quick configuration file editing.</p>

<p><img class='' style='width: 100%' src='../../../articles/2020/tramp_tricks/etchost.png'></p>

<h2 id="directory-browsing">Directory browsing</h2>

<p>=dired= mode also works, so if you want to move around just =C-x C-f= and select the directory, then you can navigate around as you normally would.</p>

<p><img class='' style='width: 100%' src='../../../articles/2020/tramp_tricks/etcdir.png'></p>

<h2 id="open-a-shell">Open a shell</h2>

<p><code>M-x shell</code> opens a shell with the current working directory of the active buffer.  This also works if that is a remote file. If you use the <code>C-u</code> prefix command, you can open a shell with the buffer&rsquo;s name specified.  This is handy if you have multiple things open at the same time.</p>

<p><code>C-u M-x shell</code> will ask you want you want to name the buffer (I suggest the hostname), the starting directory which you be the <code>/ssh...</code> string, and then the shell command to use, which I leave as <code>/bin/bash</code>.  Now you are interacting over ssh to the remote server!</p>

<p>This also keeps track of which directory you are in, so if, inside of the shell you <code>cd</code>, emacs knows where you are. If you use the normal keystrokes to open a file, <code>C-x C-f</code> it defaults to the directory that you are in on the remote server. <code>TAB</code> completion works in the minibuffer too!</p>

<p>Inside of shell mode you can use <code>C-up</code> and <code>C-down</code> to cycle through command history, all the normal things work.</p>

<p><img class='' style='width: 100%' src='../../../articles/2020/tramp_tricks/shell.png'></p>

<h2 id="edit-a-file-as-root">Edit a file as root</h2>

<p>Need to edit a file as a different user?</p>

<p><code>C-x C-f /sudo::/etc/hosts</code></p>

<p>TRAMP in this case is piping things through sudo rather an ssh, so we are making a <em>remote</em> connection to a different user on our computer.</p>

<h2 id="editing-a-file-inside-of-a-docker-container">Editing a file inside of a docker container</h2>

<p>Another fun trick is to edit a file inside of a docker container.  Is this what docker is used for?  No, but it&rsquo;s sometimes useful if you are debugging a docker file or whatever and need a tigher feedback loop.</p>

<p>Inside of your <code>.emacs</code></p>
<div class="highlight"><pre class="chroma"><code class="language-elisp" data-lang="elisp"><span class="c1">;; Open files in Docker containers like so: /docker:drunk_bardeen:/etc/passwd</span>
<span class="p">(</span><span class="nb">push</span>
 <span class="p">(</span><span class="nf">cons</span>
  <span class="s">&#34;docker&#34;</span>
  <span class="o">&#39;</span><span class="p">((</span><span class="nv">tramp-login-program</span> <span class="s">&#34;docker&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">tramp-login-args</span> <span class="p">((</span><span class="s">&#34;exec&#34;</span> <span class="s">&#34;-it&#34;</span><span class="p">)</span> <span class="p">(</span><span class="s">&#34;%h&#34;</span><span class="p">)</span> <span class="p">(</span><span class="s">&#34;/bin/bash&#34;</span><span class="p">)))</span>
    <span class="p">(</span><span class="nv">tramp-remote-shell</span> <span class="s">&#34;/bin/sh&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">tramp-remote-shell-args</span> <span class="p">(</span><span class="s">&#34;-i&#34;</span><span class="p">)</span> <span class="p">(</span><span class="s">&#34;-c&#34;</span><span class="p">))))</span>
 <span class="nv">tramp-methods</span><span class="p">)</span>

<span class="p">(</span><span class="nb">defadvice</span> <span class="nv">tramp-completion-handle-file-name-all-completions</span>
  <span class="p">(</span><span class="nv">around</span> <span class="nv">dotemacs-completion-docker</span> <span class="nv">activate</span><span class="p">)</span>
  <span class="s">&#34;(tramp-completion-handle-file-name-all-completions \&#34;\&#34; \&#34;/docker:\&#34; returns
</span><span class="s">    a list of active Docker container names, followed by colons.&#34;</span>
  <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">equal</span> <span class="p">(</span><span class="nv">ad-get-arg</span> <span class="mi">1</span><span class="p">)</span> <span class="s">&#34;/docker:&#34;</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">dockernames-raw</span> <span class="p">(</span><span class="nv">shell-command-to-string</span> <span class="s">&#34;docker ps | awk &#39;$NF != \&#34;NAMES\&#34; { print $NF \&#34;:\&#34; }&#39;&#34;</span><span class="p">))</span>
             <span class="p">(</span><span class="nv">dockernames</span> <span class="p">(</span><span class="nv">cl-remove-if-not</span>
                           <span class="nf">#&#39;</span><span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">dockerline</span><span class="p">)</span> <span class="p">(</span><span class="nf">string-match</span> <span class="s">&#34;:$&#34;</span> <span class="nv">dockerline</span><span class="p">))</span>
                           <span class="p">(</span><span class="nv">split-string</span> <span class="nv">dockernames-raw</span> <span class="s">&#34;\n&#34;</span><span class="p">))))</span>
        <span class="p">(</span><span class="nb">setq</span> <span class="nv">ad-return-value</span> <span class="nv">dockernames</span><span class="p">))</span>
    <span class="nv">ad-do-it</span><span class="p">))</span></code></pre></div>
<p>To try this out, we can spin up a quick server like this</p>

<p><code>docker run --rm -p 6379:6379 --name redis_container redis</code></p>

<p>And then look at files inside of it using</p>

<p><code>C-x C-f /docker:redis_container:/</code></p>

<p>Which opens up a directory browser in the container.  The tricks of open and editing the files are the same, and you can also open up a shell in there to do what you need.</p>

<p>Now obviously one of the points of <code>Docker</code> is to ship code around that&rsquo;s repeatably built, and this goes againsts the spirit of that.  But if you want to treat them as easily distrubuted virtual machines it&rsquo;s very handy.</p>

<h2 id="inside-a-docker-container-on-a-remote-host">Inside a docker container on a remote host</h2>

<p>We can also chain things together!  Lets say that we have a <code>docker</code> container named <code>ssb-pub</code> running on a remote host <code>ssb.willschenk.com</code>, we can connect to it using:</p>

<p><code>C-x C-f /ssh:root@ssb.willschenk.com|docker:ssb-pub:/</code></p>

<p>This works for file browsing as well as opening up a shell on the container.</p>

<p><img class='' style='width: 100%' src='../../../articles/2020/tramp_tricks/redis.png'></p>

<h2 id="it-requires-play">It requires play</h2>

<p>If you want to sit down and just start working on your project, the learning curve of emacs is too great. Its better to use a tool that&rsquo;s already configured and optimized for what you want to do. The <a href="https://laracasts.com/series/laravel-6-from-scratch">Laravel from Scratch</a> documentation, which is fabulous, recommends using <a href="https://www.jetbrains.com/phpstorm/">PHP Storm</a> for people who are learning Laravel, since you can just get going and focus on solving your problem without going down the rabbit hole. This is great. But sometimes its fun to go down the rabbit hole, and if you enjoy the playing the reward is great.</p>

<p>Emacs was first released in 1976 (take a look at <a href="https://www.jwz.org/doc/emacs-timeline.html">the emacs timeline</a> if you want to see the heritage in all it&rsquo;s glory, though you&rsquo;ll notice that it ends at 2007, 13 years ago) and given that it&rsquo;s been around for 44 years at this point, I think we can say that it&rsquo;s not a fad.  What you learn here will be useful in the future no matter what the latest hot stuff is next.</p>

<h2 id="references">References</h2>

<ol>
<li><a href="https://www.emacswiki.org/emacs/TrampMode">https://www.emacswiki.org/emacs/TrampMode</a></li>
<li><a href="https://www.emacswiki.org/emacs/TrampAndDocker">https://www.emacswiki.org/emacs/TrampAndDocker</a></li>
<li><a href="https://media.emacsconf.org/2019/23.html">https://media.emacsconf.org/2019/23.html</a></li>
</ol>

  </article>

  
</div>


  <div class="bg-light py-5">
    <div class="container">
      <h2 class="text-center">Read next</h2>

      <div class="row">
        <div class="col-md-6 text-center">
          
            Next Post:
            <a href="../../../articles/2020/styling_tables_with_hugo/">Styling tables with Hugo</a>
          
        </div>
        <div class="col-md-6 text-center">
          
            Previous Post:
            <a href="../../../articles/2020/making_charts_with_vuejs_and_no_tooling/">Making charts with VueJS and no tooling</a>
          
        </div>
      </div>
    </div>
  </div>




<div class="container mt-5">
  <h2 class="text-center">See also</h2>
  <div class="row">
  	
      <div class="col-md mb-3">
        <p class="lead mb-0"><a class="text-body" href="../../../articles/2020/leveraging_disposability_for_exploration/">Leveraging disposability for exploration</a></p>

        
          <p class="lead font-italic mb-0">how to play around without leaving a mess</p>
        
        <div class="font-weight-light mt-3">
          
          
            <p>I play around with a lot of technology to see what&rsquo;s out there and keep myself current, especially trying to find simpler ways to do our work. One of the issues is that this can leave lots of stuff laying which can be messy. Here are some techniques I use to keep things under control.
There are two complementary principle&rsquo;s that I focus on. One is reproducibility, and the other is disposibility.</p>
          
        </div>
        <a href="../../../articles/2020/leveraging_disposability_for_exploration/" class="btn btn-primary">Read more</a>
      </div>
    
      <div class="col-md mb-3">
        <p class="lead mb-0"><a class="text-body" href="../../../articles/2019/building_a_slimmer_go_docker_container/">Building a slimmer go Docker container</a></p>

        
          <p class="lead font-italic mb-0">All we need is the binary</p>
        
        <div class="font-weight-light mt-3">
          
          
            <p>Go binaries are self contained, which means that they don&rsquo;t need anything special installed in the environment to deploy them.  When people make <code>Dockerfiles</code> to build go projects, they often include the the golang compilers and build tools, which isn&rsquo;t necessary for running the container.  I&rsquo;m going to use <a href="https://github.com/somarat/healer">healer</a> Docker container that &ldquo;Automatically heal docker containers that report themselves unhealthy&rdquo; as an example of reducing the image size from 648MB to 17MB.</p>
          
        </div>
        <a href="../../../articles/2019/building_a_slimmer_go_docker_container/" class="btn btn-primary">Read more</a>
      </div>
    
      <div class="col-md mb-3">
        <p class="lead mb-0"><a class="text-body" href="../../../articles/2019/setting_up_chromebook/">Setting up a chromebook for development</a></p>

        
          <p class="lead font-italic mb-0">Documenting my steps</p>
        
        <div class="font-weight-light mt-3">
          
          
            <p>I just switch my pixelbook back to the stable channel, and this is what I did to get back to developing on it.</p>
          
        </div>
        <a href="../../../articles/2019/setting_up_chromebook/" class="btn btn-primary">Read more</a>
      </div>
    
  </div>
</div>


<footer class="footer bg-dark text-light mt-3">
  <div class="container">
    <h2 class="py-5 font-weight-light my-0">Made in Brooklyn, NY.</h2>
  </div>
</footer>
</body>
</html>
