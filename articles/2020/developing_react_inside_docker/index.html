<!DOCTYPE html>
<html><head>
  <title>Developing React Inside Docker</title>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../../css/theme.css"/>
  <link rel="stylesheet" href="../../../css/syntax.css"/>

  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-56296045-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  <script async defer data-domain="willschenk.com" src="https://plausible.io/js/plausible.js"></script>  
  <meta property="og:title" content="Developing React Inside Docker" />
<meta property="og:description" content="Can we build a node application without installing node locally? We sure can! Lets walk through the process.
First make sure that docker is installed. This is handy if you are working on a remote server for example.
Bootstrap Then lets start building out the Dockerfile that we will use.
 mkdir testapp cd testapp Create a Dockerfile.initial that has node:14 in it. Start up the container with  Dockerfile.initial FROMnode:14WORKDIR/appCMD bash" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://willschenk.com/articles/2020/developing_react_inside_docker/" />
<meta property="article:published_time" content="2020-06-16T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-06-16T00:00:00+00:00" />

  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Developing React Inside Docker"/>
<meta name="twitter:description" content="Can we build a node application without installing node locally? We sure can! Lets walk through the process.
First make sure that docker is installed. This is handy if you are working on a remote server for example.
Bootstrap Then lets start building out the Dockerfile that we will use.
 mkdir testapp cd testapp Create a Dockerfile.initial that has node:14 in it. Start up the container with  Dockerfile.initial FROMnode:14WORKDIR/appCMD bash"/>
<meta name="twitter:site" content="@wschenk"/>


  <style>
    .article p, .article ul, .article ol, .article table {
      max-width: 45em;
    }

    .article pre p {
    max-width: none;
    margin-top: -1.5rem;
    }

    article.article p:first-child, .article blockquote {
      font-size: 1.25em;
      font-weight: 300;
      max-width: 36em;  
    }
  </style>
</head>
<body><nav class="container my-5">
  <h1 class="pt-md-5 display-3"><a class="text-dark" href="../../../">Will Schenk</a></h1>
  <p>
    
      <a class="text-dark h4 mr-3 font-weight-light" href="../../../articles/" title="">Articles</a>
    
      <a class="text-dark h4 mr-3 font-weight-light" href="../../../contact" title="">Contact</a>
    
      <a class="text-dark h4 mr-3 font-weight-light" href="../../../tags/" title="">Tags</a>
    
    <a href="../../../feed.xml" class="mr-3 h4 text-light"><img src="../../../img/rss.svg" alt="rss" height="20" width="20"/></a>
    
      <a href="https://twitter.com/@wschenk" class="mr-3 h4 text-light"><img src="../../../img/twitter.svg" alt="twitter" height="20" width="20"/></a>
    
    
      <a href="https://instagram.com/wschenk" class="mr-3 h4 text-light"><img src="../../../img/instagram.svg" alt="instagram" height="20" width="20"/></a>
    
    
      <a href="https://github.com/wschenk" class="mr-3 h4 text-light"><img src="../../../img/github.svg" alt="github" height="20" width="20"/></a>
    
    
      <a href="https://linkedin.com/in/will-schenk-420266" class="mr-3 h4 text-light"><img src="../../../img/linkedin.svg" alt="linkedin" height="20" width="20"/></a>
    
  </p>
</nav>

<div class="container">
  <h1 class="mt-5">Developing React Inside Docker</h1>

  
    <h2 class="font-weight-light font-italic mb-3">Clean up after your mess</h2>
  

  <p class="text-muted mt-3">
    <a class="text-muted" href="https://willschenk.com/articles/2020/developing_react_inside_docker/">Published June 16, 2020</a>

    
      <a class="text-muted" href="../../../tags/javascript">#javascript</a>
    
      <a class="text-muted" href="../../../tags/howto">#howto</a>
    
      <a class="text-muted" href="../../../tags/docker">#docker</a>
    
      <a class="text-muted" href="../../../tags/transient">#transient</a>
    
  </p>

  

  

  <article class="article mt-5">
    <p>Can we build a node application without installing node locally?  We sure can!  Lets walk through the process.</p>
<p>First make sure that docker is installed.  This is handy if you are working on a remote server for example.</p>
<h2 id="bootstrap">Bootstrap</h2>
<p>Then lets start building out the <code>Dockerfile</code> that we will use.</p>
<ol>
<li><code>mkdir testapp</code></li>
<li><code>cd testapp</code></li>
<li>Create a <code>Dockerfile.initial</code> that has <code>node:14</code> in it.</li>
<li>Start up the container with</li>
</ol>
<p><a href="Dockerfile.initial%60"><code>Dockerfile.initial</code></a>
<div class="highlight"><pre class="chroma"><code class="language-Dockerfile" data-lang="Dockerfile"><span class="k">FROM</span><span class="s"> node:14</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="k">WORKDIR</span><span class="s"> /app</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="k">CMD</span> bash</code></pre></div></p>
<p>This is going to download the <code>node:14</code> docker image, and start a shell.</p>
<p>Lets build and start it a temporary container that has our new directory mounted in there and run the <code>npx create-react-app .</code> command, which will generate the new app.</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">docker build . -f Dockerfile.initial -t testapp
docker run -it --rm -v <span class="si">${</span><span class="nv">PWD</span><span class="si">}</span>/testapp:/app  testapp npx create-react-app .
</code></pre></div><p>Once this is done, you should see a basic <code>create-react-app</code> generated folder in your local <code>testapp</code> directory.  We need to adjust some permissions here since it&rsquo;s probably owned by root.</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">sudo chown -R <span class="si">${</span><span class="nv">USER</span><span class="si">}</span> testapp
</code></pre></div><p>Revel in our generated node_modules!</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ ls -l testapp/
total <span class="m">472</span>
drwxr-xr-x <span class="m">1</span> wschenk root  <span class="m">25562</span> Jun <span class="m">16</span> 06:08 node_modules
-rw-r--r-- <span class="m">1</span> wschenk root    <span class="m">739</span> Jun <span class="m">16</span> 06:08 package.json
drwxr-xr-x <span class="m">1</span> wschenk root    <span class="m">132</span> Jun <span class="m">16</span> 06:07 public
-rw-r--r-- <span class="m">1</span> wschenk root   <span class="m">2884</span> Jun <span class="m">16</span> 06:07 README.md
drwxr-xr-x <span class="m">1</span> wschenk root    <span class="m">156</span> Jun <span class="m">16</span> 06:07 src
-rw-r--r-- <span class="m">1</span> wschenk root <span class="m">471966</span> Jun <span class="m">16</span> 06:08 yarn.lock

</code></pre></div><p>I hate <code>node_modules</code> so lets delete it.</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ rm -rf node_modules
</code></pre></div><h2 id="setting-up-for-development">Setting up for development</h2>
<p>If you keep the <code>node_modules</code> directory around you may have some cross platform issues.  <code>node_modules</code> directory may contain native code, which would be built against the libraries inside of the docker container.  If you are running the same OS as what&rsquo;s inside of the container &ndash; Linux &ndash; then you can have these co-mingle, but if you are on OSX this is potentially a pain.</p>
<p>What we are going to do is use a docker volume to hide all of this away so we never need to see it and worry about it poluting our machine. Make sure you&rsquo;ve deleted that terrible folder!</p>
<p>Lets create a <code>testapp/Dockerfile</code> to run the app itself out of the local directory:</p>
<div class="highlight"><pre class="chroma"><code class="language-Dockerfile" data-lang="Dockerfile"><span class="k">FROM</span><span class="s"> node:14</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="k">WORKDIR</span><span class="s"> /app</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="k">COPY</span> package.json yarn.lock /app/<span class="err">
</span><span class="err">
</span><span class="err"></span><span class="k">RUN</span> yarn install<span class="err">
</span><span class="err">
</span><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 3000</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="k">CMD</span> bash<span class="err">
</span></code></pre></div><ol>
<li>First we copy over package.json and yarn.lock into /app.  If these files ever change, we will rerun all of the following steps when building the container.</li>
<li>Run <code>yarn install</code> to install the local <code>node_modules</code></li>
<li>Expose port <code>3000</code> which is the development server port.</li>
<li>We&rsquo;ll create a docker volume to hide the mess away.</li>
</ol>
<p>And create a script that will build and start up the container easily, called <code>start.sh</code></p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="cp">#!/usr/bin/env bash
</span><span class="cp"></span>
docker build . -f Dockerfile -t testapp <span class="o">&amp;&amp;</span> <span class="se">\
</span><span class="se"></span>docker run -it --rm -v <span class="si">${</span><span class="nv">PWD</span><span class="si">}</span>:/app -v testapp_nodemodules:/app/node_modules --network host testapp <span class="nv">$@</span>
</code></pre></div><p>Now lets fire up a development server using</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ bash start.sh yarn start
</code></pre></div><p>And edit <code>testapp/src/App.js</code>, make a change, and revel in the automatic reloading!</p>
<h2 id="adding-a-library">Adding a library</h2>
<p>Kill the server with <code>C-c</code>. Lets go through the process of adding a library.</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ bash start.sh yarn add react-globe.gl
$ bash start.sh yarn start
</code></pre></div><p>In the first step, you see things get downloaded from the internet.  If you look at your <code>package.json</code> file after it will be updated with the dependancy.  The second time we run the <code>start.sh</code> script it will notice that <code>package.json</code> changed and rerun <code>yarn install</code>, but since we have mounted <code>node_modules</code> in a volume it doesn&rsquo;t need to pull anything more from the internet.</p>
<p>Lets edit our <code>App.js</code> file to use the new component to make sure that it works.</p>
<div class="highlight"><pre class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">Globe</span> <span class="nx">from</span> <span class="s1">&#39;react-globe.gl&#39;</span><span class="p">;</span>

<span class="kr">import</span> <span class="s1">&#39;./App.css&#39;</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Gen random data
</span><span class="c1"></span>    <span class="kr">const</span> <span class="nx">N</span> <span class="o">=</span> <span class="mi">300</span><span class="p">;</span>
    <span class="kr">const</span> <span class="nx">gData</span> <span class="o">=</span> <span class="p">[...</span><span class="nb">Array</span><span class="p">(</span><span class="nx">N</span><span class="p">).</span><span class="nx">keys</span><span class="p">()].</span><span class="nx">map</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">({</span>
        <span class="nx">lat</span><span class="o">:</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="mi">180</span><span class="p">,</span>
        <span class="nx">lng</span><span class="o">:</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="mi">360</span><span class="p">,</span>
        <span class="nx">size</span><span class="o">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span>
        <span class="nx">color</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">][</span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)]</span>
    <span class="p">}));</span>

    <span class="k">return</span> <span class="p">(</span>
        <span class="p">&lt;</span><span class="nt">Globe</span>
          <span class="na">globeImageUrl</span><span class="o">=</span><span class="s">&#34;//unpkg.com/three-globe/example/img/earth-night.jpg&#34;</span>
          <span class="na">pointsData</span><span class="o">=</span><span class="p">{</span><span class="nx">gData</span><span class="p">}</span>
          <span class="na">pointAltitude</span><span class="o">=</span><span class="s">&#34;size&#34;</span>
          <span class="na">pointColor</span><span class="o">=</span><span class="s">&#34;color&#34;</span>
        <span class="p">/&gt;</span>
    <span class="p">);</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">App</span><span class="p">;</span>
</code></pre></div><p>After a few seconds you should see the basic globe demo appear in your browser.  Love that globe.</p>
<h2 id="building">Building</h2>
<p>This is done simply by</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">bash start.sh yarn build
</code></pre></div><h2 id="cleanup">Cleanup</h2>
<p>The container that we use is temporary, and gets cleaned up after you exit out.  But we still have the docker image and docker volume floating around &ndash; <code>node_modules</code> is always out to get you! &ndash; so we&rsquo;ll need to clean that up after.  You can delete this with:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">docker image rm testapp
docker volume rm testapp_nodemodules
</code></pre></div><p>The next time you run <code>start.sh</code> this will all get recreated.</p>

  </article>

  
</div>


  <div class="bg-light py-5">
    <div class="container">
      <h2 class="text-center">Read next</h2>

      <div class="row">
        <div class="col-md-6 text-center">
          
            Next Post:
            <a href="../../../articles/2020/using_syncthing/">Using Syncthing</a>
          
        </div>
        <div class="col-md-6 text-center">
          
            Previous Post:
            <a href="../../../articles/2020/simple_cors_workaround_for_local_development/">Simple CORS workaround for local development</a>
          
        </div>
      </div>
    </div>
  </div>




<div class="container mt-5">
  <h2 class="text-center">See also</h2>
  <div class="row">
  	
      <div class="col-md mb-3">
        <p class="lead mb-0"><a class="text-body" href="../../../articles/2020/leveraging_disposability_for_exploration/">Leveraging disposability for exploration</a></p>

        
          <p class="lead font-italic mb-0">how to play around without leaving a mess</p>
        
        <div class="font-weight-light mt-3">
          
          
            <p>I play around with a lot of technology to see what&rsquo;s out there and keep myself current, especially trying to find simpler ways to do our work. One of the issues is that this can leave lots of stuff laying which can be messy. Here are some techniques I use to keep things under control.
There are two complementary principle&rsquo;s that I focus on. One is reproducibility, and the other is disposibility.</p>
          
        </div>
        <a href="../../../articles/2020/leveraging_disposability_for_exploration/" class="btn btn-primary">Read more</a>
      </div>
    
      <div class="col-md mb-3">
        <p class="lead mb-0"><a class="text-body" href="../../../articles/2020/tramp_tricks/">Emacs Tramp tricks</a></p>

        
          <p class="lead font-italic mb-0">Replacing terminals with emacs</p>
        
        <div class="font-weight-light mt-3">
          
          
            <p>Emacs is amazing. It&rsquo;s a very different sort of thing than a code text editor like Vim or an IDE like VSCode. It&rsquo;s a different way of thinking of how to interact with a computer, where you build up techniques on top of simple tricks that let you get amazing things done. Of course, part of the appeal/challenge is that you need to figure out how to make it work yourself.</p>
          
        </div>
        <a href="../../../articles/2020/tramp_tricks/" class="btn btn-primary">Read more</a>
      </div>
    
      <div class="col-md mb-3">
        <p class="lead mb-0"><a class="text-body" href="../../../articles/2019/building_a_slimmer_go_docker_container/">Building a slimmer go Docker container</a></p>

        
          <p class="lead font-italic mb-0">All we need is the binary</p>
        
        <div class="font-weight-light mt-3">
          
          
            <p>Go binaries are self contained, which means that they don&rsquo;t need anything special installed in the environment to deploy them.  When people make <code>Dockerfiles</code> to build go projects, they often include the the golang compilers and build tools, which isn&rsquo;t necessary for running the container.  I&rsquo;m going to use <a href="https://github.com/somarat/healer">healer</a> Docker container that &ldquo;Automatically heal docker containers that report themselves unhealthy&rdquo; as an example of reducing the image size from 648MB to 17MB.</p>
          
        </div>
        <a href="../../../articles/2019/building_a_slimmer_go_docker_container/" class="btn btn-primary">Read more</a>
      </div>
    
  </div>
</div>


<footer class="footer bg-dark text-light mt-3">
  <div class="container">
    <h2 class="py-5 font-weight-light my-0">Made in Brooklyn, NY.</h2>
  </div>
</footer>
</body>
</html>
