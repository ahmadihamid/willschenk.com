<!DOCTYPE html>
<html><head>
  <title>Personal information from only a URL</title>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../../css/theme.css"/>
  <link rel="stylesheet" href="../../../css/syntax.css"/>

  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-56296045-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  <meta property="og:title" content="Personal information from only a URL" />
<meta property="og:description" content="Ever wonder what you can find out by looking at a url? How about physical addresses, server location, emails, phone numbers, various links to other profiles (which can in turn be structurally scraped), technology stack, and more.
$ socialinvestigator net page http://willschenk.com/bio domain: willschenk.com created_on: 2014-10-31 expires_on: 2015-10-31 updated_on: 2014-10-31 registrar_name: ENOM, INC. registrar_url: www.enom.com registrant_contact: name: WILL SCHENK organization: HAPPYFUNCORP address: 18 BRIDGE STREET, 2E city: BROOKLYN zip: 11201 state: NY country_code: US phone: &#43;91." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://willschenk.com/articles/2014/personal-information-from-only-a-url/" />
<meta property="article:published_time" content="2014-11-14T00:00:00&#43;00:00"/>
<meta property="article:modified_time" content="2014-11-14T00:00:00&#43;00:00"/>

  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Personal information from only a URL"/>
<meta name="twitter:description" content="Ever wonder what you can find out by looking at a url? How about physical addresses, server location, emails, phone numbers, various links to other profiles (which can in turn be structurally scraped), technology stack, and more.
$ socialinvestigator net page http://willschenk.com/bio domain: willschenk.com created_on: 2014-10-31 expires_on: 2015-10-31 updated_on: 2014-10-31 registrar_name: ENOM, INC. registrar_url: www.enom.com registrant_contact: name: WILL SCHENK organization: HAPPYFUNCORP address: 18 BRIDGE STREET, 2E city: BROOKLYN zip: 11201 state: NY country_code: US phone: &#43;91."/>
<meta name="twitter:site" content="@wschenk"/>


  <style>
    .article p, .article ul, .article ol, .article table {
      max-width: 45em;
    }

    article.article p:first-child, .article blockquote {
      font-size: 1.25em;
      font-weight: 300;
      max-width: 36em;  
    }
  </style>
</head>
<body><nav class="container my-5">
  <h1 class="pt-md-5 display-3"><a class="text-dark" href="../../../">Will Schenk</a></h1>
  <p>
    
      <a class="text-dark h4 mr-3 font-weight-light" href="../../../articles/" title="">Articles</a>
    
      <a class="text-dark h4 mr-3 font-weight-light" href="../../../contact" title="">Contact</a>
    
      <a class="text-dark h4 mr-3 font-weight-light" href="../../../tags/" title="">Tags</a>
    
    <a href="../../../feed.xml" class="mr-3 h4 text-light"><img src="../../../img/rss.svg" alt="rss" height="20" width="20"/></a>
    
      <a href="https://twitter.com/@wschenk" class="mr-3 h4 text-light"><img src="../../../img/twitter.svg" alt="twitter" height="20" width="20"/></a>
    
    
      <a href="https://instagram.com/wschenk" class="mr-3 h4 text-light"><img src="../../../img/instagram.svg" alt="instagram" height="20" width="20"/></a>
    
    
      <a href="https://linkedin.com/in/will-schenk-420266" class="mr-3 h4 text-light"><img src="../../../img/linkedin.svg" alt="linkedin" height="20" width="20"/></a>
    
  </p>
</nav>

<div class="container">
  <h1 class="mt-5">Personal information from only a URL</h1>

  
    <h2 class="font-weight-light font-italic mb-3">what can automated tools find out</h2>
  

  <p class="text-muted mt-3">
    <a class="text-muted" href="https://willschenk.com/articles/2014/personal-information-from-only-a-url/">Published November 14, 2014</a>

    
      <a class="text-muted" href="../../../tags/ruby">#ruby</a>
    
      <a class="text-muted" href="../../../tags/socialinvestigator">#socialinvestigator</a>
    
  </p>

  
  <div class="alert alert-danger">This article was published a while ago and may contain obsolete information!</div>
  

  

  <article class="article mt-5">
    

<p>Ever wonder what you can find out by looking at a url?  How about physical addresses, server location, emails, phone numbers, various links to other profiles (which can in turn be structurally scraped), technology stack, and more.</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ socialinvestigator net page http://willschenk.com/bio
              domain: willschenk.com
          created_on: <span class="m">2014</span>-10-31
          expires_on: <span class="m">2015</span>-10-31
          updated_on: <span class="m">2014</span>-10-31
      registrar_name: ENOM, INC.
       registrar_url: www.enom.com
  registrant_contact:
                     name: WILL SCHENK
             organization: HAPPYFUNCORP
                  address: <span class="m">18</span> BRIDGE STREET, 2E
                     city: BROOKLYN
                      zip: <span class="m">11201</span>
                    state: NY
             country_code: US
                    phone: +91.76976430
                    email: WSCHENK@GMAIL.COM
         server_name: ec2-54-225-218-167.compute-1.amazonaws.com
      server_country: United States
     server_location: Ashburn, Virginia
     server_latitude: <span class="m">39</span>.0437
    server_longitude: -77.4875
     server_ip_owner: Amazon Technologies Inc. <span class="o">(</span>AT-88-Z<span class="o">)</span>
              emails: wschenk@gmail.com, will@happyfuncorp.com
               title: Will Schenk
         description: The blog of Will Schenk
      twitter_author: wschenk
         twitter_ids: wschenk
          responsive: <span class="nb">true</span>
            rss_feed: /feed.rss
           atom_feed: /feed
       twitter_links: https://twitter.com/wschenk, http://twitter.com/wschenk
      linkedin_links: http://www.linkedin.com/pub/will-schenk/0/266/420/
     instagram_links: http://instagram.com/wschenk
        github_links: https://github.com/wschenk
        technologies: Chartbeat, Font Awesome, Google Analytics, RackCache, Ruby</code></pre></div>
<p><em>Standalone code as <a href="https://gist.github.com/wschenk/7d333acb59b7768f2637">a gist</a>, the complete socialinvestigator code <a href="https://github.com/sublimeguile/socialinvestigator">available on github</a> or and is easily installable on your machine as a gem.</em></p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ gem install socialinvestigator
$ socialinvestigator net get_apps_json
$ socialinvestigator net page_info url</code></pre></div>
<p>Poking around different urls can give you a sense of the corporate entities behind sites, who is actually involved, and help you track down people when you can&rsquo;t find them otherwise.  It&rsquo;s actually hard to figure out which URL to include on this post since the data seems so personal and yet people put it out there.  This takes the messy HTML that&rsquo;s out there and returns structured information that you can use to explore profiles on other sites in a way that can be totally automated.</p>

<h2 id="what-does-it-do">What does it do</h2>

<p>What this code does is to first search for DNS information to see who owns the domain and if there&rsquo;s any contact information associated with it.  It then looks at who owns the IP address and tries to locate where it is geographically.</p>

<p>It then looks at the page itself to see <a href="http://ogp.me">Open Graph meta data</a>,<a href="https://dev.twitter.com/cards/overview">Twitter Card meta data</a> and other basic SEO tags.</p>

<p>Finally, it looks inside the page for likely looking links to other social networks, and scans the page and HTTP metadata for clues about what underlying technology the site was built in.  (The metadata for the technology fingerprinting is from the <a href="https://github.com/ElbertF/Wappalyzer">Wappalyzer project</a> which I cobbled together a basic ruby engine for.)</p>

<p>And finally it takes all of the facts that it has collected, figured out which ones take priority, and prints them out.</p>

<h2 id="finding-domain-info">Finding Domain info</h2>

<p>The first thing that we do is look for the URL and try to find the domain name.  The difference between a hostname and domain name is subtle, partly in some cases they are interchangeable, and partly because DNS is the <a href="http://codex.happyfuncorp.com/slides/93#1">second most amazing thing about the Internet</a>.  (The most truly mind-blowing thing clearly <a href="http://en.wikipedia.org/wiki/Default_route">the default route</a>, the <em>life, liberty, and pursuit of happiness</em> of the Internet.)  A globe spanning, highly distributed database that lets 2.5 billion internet users look up any of the 4 billion potential server addresses in less than 50ms without any real centralized control isn&rsquo;t exactly straightforward.</p>

<p>DNS manages this complexity by delegating authority for different branches of the entire namespace.  The first level is called the Top Level Domains, most famous being <em>.com</em>, when you buy a domain name from someone they delegate authority over that name space to you.  These can go deep, especially with large global organizations.  The first thing we do is look for that <strong>Start of Authority</strong> (SOA) record for machine named in the URL.  If we can&rsquo;t find one for that machine, we look up the chain until we find something.</p>

<p>This looks like:</p>
<div class="highlight"><pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">&#39;dnsruby&#39;</span>

<span class="n">hostname</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">hostname</span>

<span class="k">def</span> <span class="nf">find_domain</span><span class="p">(</span> <span class="n">hostname</span> <span class="p">)</span>
  <span class="nb">puts</span> <span class="s2">&#34;Looking for SOA of </span><span class="si">#{</span><span class="n">hostname</span><span class="si">}</span><span class="s2">&#34;</span>
  <span class="n">dns</span> <span class="o">=</span> <span class="no">Dnsruby</span><span class="o">::</span><span class="no">Resolver</span><span class="o">.</span><span class="n">new</span>
  <span class="n">soa</span> <span class="o">=</span> <span class="n">dns</span><span class="o">.</span><span class="n">query</span><span class="p">(</span> <span class="n">hostname</span><span class="p">,</span> <span class="s2">&#34;SOA&#34;</span> <span class="p">)</span><span class="o">.</span><span class="n">answer</span><span class="o">.</span><span class="n">select</span> <span class="k">do</span> <span class="o">|</span><span class="n">rr</span><span class="o">|</span>
    <span class="n">rr</span><span class="o">.</span><span class="n">is_a?</span> <span class="no">Dnsruby</span><span class="o">::</span><span class="no">RR</span><span class="o">::</span><span class="no">IN</span><span class="o">::</span><span class="no">SOA</span>
  <span class="k">end</span>

  <span class="k">return</span> <span class="n">hostname</span> <span class="k">if</span> <span class="n">soa</span><span class="o">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span>

  <span class="c1"># Go from &#34;news.bbc.co.uk&#34; -&gt; &#34;bbc.co.uk&#34;</span>
  <span class="n">parts</span> <span class="o">=</span> <span class="n">hostname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span> <span class="sr">/\./</span> <span class="p">)</span>
  <span class="k">return</span> <span class="kp">nil</span> <span class="k">if</span> <span class="n">parts</span><span class="o">.</span><span class="n">length</span> <span class="o">&lt;=</span> <span class="mi">2</span>

  <span class="n">find_domain</span><span class="p">(</span> <span class="n">parts</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="s2">&#34;.&#34;</span> <span class="p">)</span> <span class="p">)</span>
<span class="k">end</span></code></pre></div>
<p>Once we&rsquo;ve found the domain, we query the <code>whois</code> databases to find out who has owns the domain name.</p>
<div class="highlight"><pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">&#39;whois&#39;</span>

<span class="n">whois</span> <span class="o">=</span> <span class="no">Whois</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span> <span class="n">domain</span> <span class="p">)</span>

<span class="nb">puts</span> <span class="s2">&#34;Expires: </span><span class="si">#{</span><span class="n">whois</span><span class="o">.</span><span class="n">expires_on</span><span class="si">}</span><span class="s2">&#34;</span>
<span class="c1"># Print all contact information we find</span>
<span class="n">whois</span><span class="o">.</span><span class="n">contacts</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">c</span> <span class="p">}</span></code></pre></div>
<p>One of the challenges here is that there is no standardized format that there is no standardized way of parsing <code>whois</code> responses.  The <code>whois</code> gem gives it a serious try:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ ls -l <span class="sb">`</span>bundle show whois<span class="sb">`</span>/lib/whois/record/parser <span class="p">|</span> wc -l
     <span class="m">209</span></code></pre></div>
<p>But there&rsquo;s over 500 different whois servers out there, so you won&rsquo;t always get a parseable response.  In that case we print out that we can&rsquo;t find a parser, and we store the unparsed response in the data object as <code>unparsed_whois</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="n">whois</span><span class="o">.</span><span class="n">parts</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="nb">p</span><span class="o">|</span>
  <span class="c1"># Check for responses that we couldn&#39;t parse</span>
  <span class="k">if</span> <span class="no">Whois</span><span class="o">::</span><span class="no">Record</span><span class="o">::</span><span class="no">Parser</span><span class="o">.</span><span class="n">parser_for</span><span class="p">(</span><span class="nb">p</span><span class="p">)</span><span class="o">.</span><span class="n">is_a?</span> <span class="no">Whois</span><span class="o">::</span><span class="no">Record</span><span class="o">::</span><span class="no">Parser</span><span class="o">::</span><span class="no">Blank</span>
    <span class="nb">puts</span> <span class="s2">&#34;Couldn&#39;t find a parser for </span><span class="si">#{</span><span class="nb">p</span><span class="o">.</span><span class="n">host</span><span class="si">}</span><span class="s2">:&#34;</span>
    <span class="nb">puts</span> <span class="nb">p</span><span class="o">.</span><span class="n">body</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>
<h2 id="finding-ip-and-hosting-information">Finding IP and hosting information</h2>

<p>Now we look at the IP address, and then do a reverse lookup on it to see what the server machine name is.</p>
<div class="highlight"><pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="n">ip_address</span> <span class="o">=</span> <span class="no">Dnsruby</span><span class="o">::</span><span class="no">Resolv</span><span class="o">.</span><span class="n">getaddress</span> <span class="n">uri</span><span class="o">.</span><span class="n">host</span>

<span class="n">data</span><span class="o">.</span><span class="n">remember</span> <span class="ss">:ip_address</span><span class="p">,</span> <span class="n">ip_address</span>
<span class="k">begin</span>
  <span class="n">data</span><span class="o">.</span><span class="n">remember</span> <span class="ss">:server_name</span><span class="p">,</span> <span class="no">Dnsruby</span><span class="o">::</span><span class="no">Resolv</span><span class="o">.</span><span class="n">getname</span><span class="p">(</span> <span class="n">ip_address</span> <span class="p">)</span>
<span class="k">rescue</span> <span class="no">Dnsruby</span><span class="o">::</span><span class="no">NXDomain</span>
  <span class="c1"># Couldn&#39;t do the reverse lookup</span>
<span class="k">end</span></code></pre></div>
<p>Sometimes interesting things are encoded in the server name, like if it&rsquo;s a Rackspace cloud server vs a Rackspace static server, but we make no attempt to interpret that string.</p>

<p>Then we try and see where the IP address is located geographically, using <a href="http://freegeoip.net/">freegeoip.net</a>.  If you did a lot of this it would make sense to buy a more detailed database from <a href="https://www.maxmind.com/en/home">Maxmind</a> but for something quick and dirty this works.  Given that you need to follow the rules of the company you are in, it&rsquo;s interesting to see where the servers are located.</p>
<div class="highlight"><pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="n">location_info</span> <span class="o">=</span> <span class="no">HTTParty</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://freegeoip.net/json/&#39;</span> <span class="o">+</span> <span class="n">ip_address</span><span class="p">)</span>

<span class="n">data</span><span class="o">.</span><span class="n">remember</span> <span class="ss">:server_country</span><span class="p">,</span> <span class="n">location_info</span><span class="o">[</span><span class="s1">&#39;country&#39;</span><span class="o">]</span>
<span class="n">data</span><span class="o">.</span><span class="n">remember</span> <span class="ss">:server_location</span><span class="p">,</span> <span class="o">[</span><span class="n">location_info</span><span class="o">[</span><span class="s1">&#39;city&#39;</span><span class="o">]</span><span class="p">,</span> <span class="n">location_info</span><span class="o">[</span><span class="s1">&#39;region_name&#39;</span><span class="o">]].</span><span class="n">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="n">x</span> <span class="p">}</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="s2">&#34;, &#34;</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">remember</span> <span class="ss">:server_latitude</span><span class="p">,</span> <span class="n">location_info</span><span class="o">[</span><span class="s1">&#39;latitude&#39;</span><span class="o">]</span>
<span class="n">data</span><span class="o">.</span><span class="n">remember</span> <span class="ss">:server_longitude</span><span class="p">,</span> <span class="n">location_info</span><span class="o">[</span><span class="s1">&#39;longitude&#39;</span><span class="o">]</span></code></pre></div>
<p>We can also do a <code>whois</code> lookup on the IP address, to see who owns that IP block.  This should give us an idea of who is hosting the site.  Note that we don&rsquo;t even pretend to parse the <code>whois</code> response here in a clever way.</p>
<div class="highlight"><pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="n">ip_whois</span> <span class="o">=</span> <span class="no">Whois</span><span class="o">.</span><span class="n">lookup</span> <span class="n">ip_address</span>

<span class="n">ip_whois</span><span class="o">.</span><span class="n">to_s</span><span class="o">.</span><span class="n">each_line</span><span class="o">.</span><span class="n">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="n">x</span><span class="o">=~</span><span class="sr">/Organization/</span> <span class="p">}</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">org</span><span class="o">|</span>
  <span class="k">if</span> <span class="n">org</span> <span class="o">=~</span> <span class="sr">/Organization:\s*(.*)\n/</span>
    <span class="n">data</span><span class="o">.</span><span class="n">another</span> <span class="ss">:server_ip_owner</span><span class="p">,</span> <span class="vg">$1</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>
<h2 id="page-meta-data">Page meta data</h2>

<p>Now we load up the page, and look for some basic stuff.  The first thing that we do is load the <a href="http://en.wikipedia.org/wiki/Meta_element">meta tags</a> into something more accessible.</p>
<div class="highlight"><pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="n">response</span> <span class="o">=</span> <span class="no">HTTParty</span><span class="o">.</span><span class="n">get</span> <span class="n">url</span>
<span class="n">parsed</span> <span class="o">=</span> <span class="no">Nokogiri</span><span class="o">.</span><span class="n">parse</span> <span class="n">response</span><span class="o">.</span><span class="n">body</span>

<span class="c1"># Meta tags</span>

<span class="n">meta</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">parsed</span><span class="o">.</span><span class="n">css</span><span class="p">(</span> <span class="s2">&#34;meta[name]&#34;</span> <span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
  <span class="n">meta</span><span class="o">[</span><span class="n">t</span><span class="o">.</span><span class="n">attributes</span><span class="o">[</span><span class="s2">&#34;name&#34;</span><span class="o">].</span><span class="n">value</span><span class="o">]</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">attributes</span><span class="o">[</span><span class="s2">&#34;content&#34;</span><span class="o">].</span><span class="n">value</span> <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">attributes</span><span class="o">[</span><span class="s2">&#34;content&#34;</span><span class="o">]</span>
<span class="k">end</span>

<span class="n">parsed</span><span class="o">.</span><span class="n">css</span><span class="p">(</span> <span class="s2">&#34;meta[property]&#34;</span> <span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
  <span class="n">meta</span><span class="o">[</span><span class="n">t</span><span class="o">.</span><span class="n">attributes</span><span class="o">[</span><span class="s2">&#34;property&#34;</span><span class="o">].</span><span class="n">value</span><span class="o">]</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">attributes</span><span class="o">[</span><span class="s2">&#34;content&#34;</span><span class="o">].</span><span class="n">value</span>
<span class="k">end</span></code></pre></div>
<p>Now we load up some basic SEO info, including if there are any feeds for this site&rsquo;s content.</p>
<div class="highlight"><pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="n">data</span><span class="o">.</span><span class="n">remember</span><span class="p">(</span> <span class="ss">:author</span><span class="p">,</span> <span class="n">meta</span><span class="o">[</span><span class="s1">&#39;author&#39;</span><span class="o">]</span> <span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">remember</span><span class="p">(</span> <span class="ss">:description</span><span class="p">,</span> <span class="n">meta</span><span class="o">[</span><span class="s1">&#39;description&#39;</span><span class="o">]</span> <span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">remember</span><span class="p">(</span> <span class="ss">:keywords</span><span class="p">,</span> <span class="n">meta</span><span class="o">[</span><span class="s1">&#39;keywords&#39;</span><span class="o">]</span> <span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">remember</span><span class="p">(</span> <span class="ss">:generator</span><span class="p">,</span> <span class="n">meta</span><span class="o">[</span><span class="s1">&#39;generator&#39;</span><span class="o">]</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">remember</span><span class="p">(</span> <span class="ss">:responsive</span><span class="p">,</span> <span class="kp">true</span> <span class="p">)</span>  <span class="k">if</span> <span class="n">meta</span><span class="o">[</span><span class="s2">&#34;viewport&#34;</span><span class="o">]</span> <span class="o">=~</span> <span class="sr">/width=device-width/</span>
<span class="n">data</span><span class="o">.</span><span class="n">remember</span><span class="p">(</span> <span class="ss">:server</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">[</span><span class="s1">&#39;server&#39;</span><span class="o">]</span> <span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">remember</span><span class="p">(</span> <span class="ss">:page_title</span><span class="p">,</span> <span class="n">parsed</span><span class="o">.</span><span class="n">title</span> <span class="p">)</span>

<span class="c1"># RSS Feed:</span>
<span class="k">if</span> <span class="n">feed</span> <span class="o">=</span> <span class="n">parsed</span><span class="o">.</span><span class="n">css</span><span class="p">(</span> <span class="s1">&#39;link[type=&#34;application/rss+xml&#34;]&#39;</span> <span class="p">)</span><span class="o">.</span><span class="n">first</span>
  <span class="n">feed</span> <span class="o">=</span> <span class="n">feed</span><span class="o">.</span><span class="n">attributes</span><span class="o">[</span><span class="s1">&#39;href&#39;</span><span class="o">].</span><span class="n">value</span>
  <span class="n">data</span><span class="o">.</span><span class="n">remember</span><span class="p">(</span> <span class="ss">:rss_feed</span><span class="p">,</span> <span class="n">feed</span> <span class="p">)</span>
<span class="k">end</span>

<span class="c1"># Atom Feed:</span>
<span class="k">if</span> <span class="n">feed</span> <span class="o">=</span> <span class="n">parsed</span><span class="o">.</span><span class="n">css</span><span class="p">(</span> <span class="s1">&#39;link[type=&#34;application/atom+xml&#34;]&#39;</span> <span class="p">)</span><span class="o">.</span><span class="n">first</span>
  <span class="n">feed</span> <span class="o">=</span> <span class="n">feed</span><span class="o">.</span><span class="n">attributes</span><span class="o">[</span><span class="s1">&#39;href&#39;</span><span class="o">].</span><span class="n">value</span>
  <span class="n">data</span><span class="o">.</span><span class="n">remember</span><span class="p">(</span> <span class="ss">:atom_feed</span><span class="p">,</span> <span class="n">feed</span> <span class="p">)</span>
<span class="k">end</span></code></pre></div>
<h2 id="twitter-cards">Twitter Cards</h2>

<p><a href="https://dev.twitter.com/cards/overview">Twitter Card meta data</a> is a way to control how your data gets displayed on twitter, which has the benefit of defining some summary meta data around the social graph.  One thing thing to note is that <code>twitter:creator</code> is the author of this page, while <code>twitter:site</code> is the twitter account for the overall site.</p>
<div class="highlight"><pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="n">data</span><span class="o">.</span><span class="n">remember</span><span class="p">(</span> <span class="ss">:twitter_title</span><span class="p">,</span> <span class="n">meta</span><span class="o">[</span><span class="s2">&#34;twitter:title&#34;</span><span class="o">]</span> <span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">remember</span><span class="p">(</span> <span class="ss">:twitter_creator</span><span class="p">,</span> <span class="n">meta</span><span class="o">[</span><span class="s2">&#34;twitter:creator&#34;</span><span class="o">]</span> <span class="p">)</span>
<span class="k">if</span> <span class="sr">/@(.*)/</span><span class="o">.</span><span class="n">match</span><span class="p">(</span> <span class="n">meta</span><span class="o">[</span><span class="s2">&#34;twitter:creator&#34;</span><span class="o">]</span> <span class="p">)</span>
  <span class="n">data</span><span class="o">.</span><span class="n">another</span><span class="p">(</span> <span class="ss">:twitter_ids</span><span class="p">,</span> <span class="vg">$1</span> <span class="p">)</span>
<span class="k">end</span>
<span class="n">data</span><span class="o">.</span><span class="n">remember</span><span class="p">(</span> <span class="ss">:twitter_site_author</span><span class="p">,</span> <span class="n">meta</span><span class="o">[</span><span class="s2">&#34;twitter:site&#34;</span><span class="o">]</span> <span class="p">)</span>
<span class="k">if</span> <span class="sr">/@(.*)/</span><span class="o">.</span><span class="n">match</span><span class="p">(</span> <span class="n">meta</span><span class="o">[</span><span class="s2">&#34;twitter:site&#34;</span><span class="o">]</span> <span class="p">)</span>
  <span class="n">data</span><span class="o">.</span><span class="n">another</span><span class="p">(</span> <span class="ss">:twitter_ids</span><span class="p">,</span> <span class="vg">$1</span> <span class="p">)</span>
<span class="k">end</span>
<span class="n">data</span><span class="o">.</span><span class="n">remember</span><span class="p">(</span> <span class="ss">:twitter_image</span><span class="p">,</span> <span class="n">meta</span><span class="o">[</span><span class="s2">&#34;twitter:image&#34;</span><span class="o">]</span> <span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">remember</span><span class="p">(</span> <span class="ss">:twitter_description</span><span class="p">,</span> <span class="n">meta</span><span class="o">[</span><span class="s2">&#34;twitter:description&#34;</span><span class="o">]</span> <span class="p">)</span></code></pre></div>
<h2 id="open-graph">Open Graph</h2>

<p><a href="http://ogp.me">Open Graph meta data</a> is really about what your link looks like when someone shares it on Facebook.</p>
<div class="highlight"><pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="n">data</span><span class="o">.</span><span class="n">remember</span><span class="p">(</span> <span class="ss">:og_title</span><span class="p">,</span> <span class="n">meta</span><span class="o">[</span><span class="s2">&#34;og:title&#34;</span><span class="o">]</span> <span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">remember</span><span class="p">(</span> <span class="ss">:og_description</span><span class="p">,</span> <span class="n">meta</span><span class="o">[</span><span class="s2">&#34;og:description&#34;</span><span class="o">]</span> <span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">remember</span><span class="p">(</span> <span class="ss">:og_type</span><span class="p">,</span> <span class="n">meta</span><span class="o">[</span><span class="s2">&#34;og:type&#34;</span><span class="o">]</span> <span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">remember</span><span class="p">(</span> <span class="ss">:og_image</span><span class="p">,</span> <span class="n">meta</span><span class="o">[</span><span class="s2">&#34;og:image&#34;</span><span class="o">]</span> <span class="p">)</span></code></pre></div>
<h2 id="social-page-links">Social Page Links</h2>

<p>We search for social links:</p>

<table>
<thead>
<tr>
<th>Service</th>
<th>Regex</th>
</tr>
</thead>

<tbody>
<tr>
<td>Email</td>
<td><code>/mailto:(.*@.*\..*)/</code></td>
</tr>

<tr>
<td>Twitter</td>
<td><code>/twitter.com\/[^\/]*$/</code></td>
</tr>

<tr>
<td>LinkedIn</td>
<td><code>/linkedin.com/</code></td>
</tr>

<tr>
<td>Instagram</td>
<td><code>/instagram.com/</code></td>
</tr>

<tr>
<td>Facebook</td>
<td><code>/facebook.com\/[^\/]*$/</code></td>
</tr>

<tr>
<td>Google+</td>
<td><code>/plus.google.com\/[^\/]*$/</code></td>
</tr>

<tr>
<td>Github</td>
<td><code>/github.com\/[^\/]*$/</code></td>
</tr>
</tbody>
</table>

<p>For Twitter, Facebook, and Google+ we are only letting through links that have a simple query string, since for the most part this means that it&rsquo;s the user&rsquo;s ID.</p>

<h2 id="parsing-twitter-shares-and-intents">Parsing Twitter Shares and Intents</h2>

<p>We then look for Twitter Share links, and try and parse out the user names found in there.</p>
<div class="highlight"><pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="c1"># Look for twitter shared links</span>

<span class="n">twitter_shared</span> <span class="o">=</span> <span class="n">matching_links</span><span class="p">(</span> <span class="n">parsed</span><span class="p">,</span> <span class="sr">/twitter.com\/share/</span> <span class="p">)</span>

<span class="n">twitter_shared</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">l</span><span class="o">|</span>
  <span class="n">text</span> <span class="o">=</span> <span class="n">l</span><span class="o">[</span><span class="s1">&#39;data-text&#39;</span><span class="o">]</span>

  <span class="c1"># See if there&#39;s a &#34;by @user&#34; in the text</span>
  <span class="k">if</span> <span class="sr">/by\s*@([^\s]*)/</span><span class="o">.</span><span class="n">match</span> <span class="n">text</span>
    <span class="n">data</span><span class="o">.</span><span class="n">another</span><span class="p">(</span> <span class="ss">:twitter_ids</span><span class="p">,</span> <span class="vg">$1</span> <span class="p">)</span>
    <span class="n">data</span><span class="o">.</span><span class="n">remember</span><span class="p">(</span> <span class="ss">:twitter_by</span><span class="p">,</span> <span class="vg">$1</span> <span class="p">)</span>
  <span class="k">end</span>

  <span class="c1"># Look for all &#34;@usernames&#34; in the text</span>
  <span class="k">if</span> <span class="n">text</span>
    <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="o">.</span><span class="n">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="n">x</span> <span class="o">=~</span> <span class="sr">/@\s*/</span> <span class="p">}</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="nb">id</span><span class="o">|</span>
      <span class="n">data</span><span class="o">.</span><span class="n">another</span><span class="p">(</span> <span class="ss">:twitter_ids</span><span class="p">,</span> <span class="nb">id</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span><span class="mi">100</span> <span class="p">)</span> <span class="p">)</span> <span class="c1"># We don&#39;t want the @</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="c1"># See if there&#39;s a via link on the anchor tag</span>
  <span class="k">if</span> <span class="n">l</span><span class="o">[</span><span class="s1">&#39;data-via&#39;</span><span class="o">]</span>
    <span class="n">data</span><span class="o">.</span><span class="n">another</span><span class="p">(</span> <span class="ss">:twitter_ids</span><span class="p">,</span> <span class="n">l</span><span class="o">[</span><span class="s1">&#39;data-via&#39;</span><span class="o">]</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">possible_via</span> <span class="o">=</span> <span class="no">URI</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span> <span class="p">(</span><span class="no">URI</span><span class="p">(</span><span class="n">l</span><span class="o">[</span><span class="s1">&#39;href&#39;</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">query</span><span class="p">)</span> <span class="o">||</span> <span class="s2">&#34;&#34;</span> <span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span> <span class="sr">/&amp;amp;/</span> <span class="p">)</span><span class="o">.</span><span class="n">collect</span> <span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span> <span class="sr">/=/</span>  <span class="p">)</span> <span class="p">}</span><span class="o">.</span><span class="n">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="n">x</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">==</span> <span class="s1">&#39;via&#39;</span> <span class="p">}</span>
  <span class="k">if</span> <span class="n">possible_via</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="n">data</span><span class="o">.</span><span class="n">another</span><span class="p">(</span> <span class="ss">:twitter_ids</span><span class="p">,</span> <span class="n">possible_via</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">1</span><span class="o">]</span> <span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>
<p>There are also twitter intent links:</p>
<div class="highlight"><pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="n">twitter_intent</span> <span class="o">=</span> <span class="n">hrefs</span><span class="p">(</span> <span class="n">matching_links</span><span class="p">(</span> <span class="n">parsed</span><span class="p">,</span> <span class="sr">/twitter.com\/intent/</span> <span class="p">)</span> <span class="p">)</span>

<span class="n">twitter_intent</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
  <span class="no">URI</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span> <span class="no">URI</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span> <span class="sr">/ /</span><span class="p">,</span> <span class="s2">&#34;+&#34;</span> <span class="p">))</span><span class="o">.</span><span class="n">query</span> <span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span> <span class="sr">/&amp;/</span> <span class="p">)</span><span class="o">.</span><span class="n">select</span> <span class="k">do</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span>
    <span class="n">x</span> <span class="o">=~</span> <span class="sr">/via/</span>
  <span class="k">end</span><span class="o">.</span><span class="n">collect</span> <span class="k">do</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span>
    <span class="n">x</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span> <span class="sr">/via=/</span><span class="p">,</span> <span class="s2">&#34;&#34;</span> <span class="p">)</span>
  <span class="k">end</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">via</span><span class="o">|</span>
    <span class="n">data</span><span class="o">.</span><span class="n">another</span><span class="p">(</span> <span class="ss">:twitter_ids</span><span class="p">,</span> <span class="n">via</span> <span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>
<h2 id="technology-finger-prints">Technology Finger Prints</h2>

<p>The final thing we do is to load the <code>apps.json</code> file from <a href="https://github.com/ElbertF/Wappalyzer">Wappalyzer</a> which is a cross-platform utility that uncovers the technologies used on websites.  This has a list of regex for the header tags, meta tags, scripts and other parts of the html to make guesses about which technology is in place.  What is in place is very rudimentary, but it gives a general sense of what is used to made the site.</p>

<h2 id="installation">Installation</h2>

<p>The standalone code as <a href="https://gist.github.com/wschenk/7d333acb59b7768f2637">a gist</a>, and you can check out the complete <a href="https://github.com/sublimeguile/socialinvestigator">socialinvestigator code on github</a>.  To run this on your machine:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ gem install socialinvestigator
$ socialinvestigator net get_apps_json
$ socialinvestigator net page_info http://willschenk.com/bio</code></pre></div>
<p>It may take a while to get the responses.  If you want to see everything it&rsquo;s doing, use the <code>--debug</code> switch</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ socialinvestigator net page_info http://willschenk.com/bio --debug</code></pre></div>
<p>The reverse lookup can take a while, and if you want to turn that off:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ socialinvestigator net page_info http://willschenk.com/bio --noreverse</code></pre></div>
  </article>

  
</div>


  <div class="bg-light py-5">
    <div class="container">
      <h2 class="text-center">Read next</h2>

      <div class="row">
        <div class="col-md-6 text-center">
          
            Next Post:
            <a href="../../../articles/2014/embedding-3d-models-on-your-page/">Embedding 3d models on your page</a>
          
        </div>
        <div class="col-md-6 text-center">
          
            Previous Post:
            <a href="../../../articles/2014/bot-design-patterns/">Bot Design Patterns</a>
          
        </div>
      </div>
    </div>
  </div>




<div class="container mt-5">
  <h2 class="text-center">See also</h2>
  <div class="row">
  	
      <div class="col-md mb-3">
        <p class="lead mb-0"><a class="text-body" href="../../../articles/2014/making-a-command-line-utility-with-gems-and-thor/">Making a command line utility with gems and thor</a></p>

        
          <p class="lead font-italic mb-0">Any excuse to the use the phrase &ldquo;Hammer of the Gods&rdquo;</p>
        
        <div class="font-weight-light mt-3">
          
          
            <p>Some scripts work well because they are self contained and don&rsquo;t have a lot of dependancies, like the hosts on your network tracker.
Others scripts - have more code than fits into a single file - multiple options and switches - have an extensive set of dependancies
And on those cases, its better to make a gem and use thor
Hammer of the Gods Lets figure out how to make some command line tools and package them up so that they can be shared and used by other people.</p>
          
        </div>
        <a href="../../../articles/2014/making-a-command-line-utility-with-gems-and-thor/" class="btn btn-primary">Read more</a>
      </div>
    
      <div class="col-md mb-3">
        <p class="lead mb-0"><a class="text-body" href="../../../articles/2014/how-to-track-your-coworkers/">How to track your coworkers</a></p>

        
          <p class="lead font-italic mb-0">Simple passive network surveillance</p>
        
        <div class="font-weight-light mt-3">
          
          
            <p>How much information do you bleed?
Ever wonder who is else is using your network? Or,who has actually showed up at the office?
Networking primer The simplest thing we can do to make this work is to check to see which devices have registered themselves on the network. As devices come and go, they connect automatically, so we will have a pretty good idea if people are there or not.</p>
          
        </div>
        <a href="../../../articles/2014/how-to-track-your-coworkers/" class="btn btn-primary">Read more</a>
      </div>
    
  </div>
</div>


<footer class="footer bg-dark text-light mt-3">
  <div class="container">
    <h2 class="py-5 font-weight-light my-0">Made in Brooklyn, NY.</h2>
  </div>
</footer>
</body>
</html>
