<!DOCTYPE html>
<html><head>
  <title>Easy scraping with httpie and jq</title>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../../css/theme.css"/>
  <link rel="stylesheet" href="../../../css/syntax.css"/>

  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-56296045-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  <meta property="og:title" content="Easy scraping with httpie and jq" />
<meta property="og:description" content="I recently saw a tweet mentioning the combination of using HTTPie (a command line HTTP client), jq (a lightweight and flexible command-line JSON processor) and Gron (Make JSON greppable!) was &ldquo;all you needed to build a scraper.&rdquo; Lets see if that&rsquo;s true.
First install Linux:
sudo apt-get install httpie jq OSX
brew install httpie brew install jq Lets get some stars We can pull down the list of repositories people have starred on Github using the URL scheme https://api." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://willschenk.com/articles/2019/easy_scraping_with_httpie_and_jq/" />
<meta property="article:published_time" content="2019-04-18T00:00:00&#43;00:00"/>
<meta property="article:modified_time" content="2019-04-18T00:00:00&#43;00:00"/>

  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Easy scraping with httpie and jq"/>
<meta name="twitter:description" content="I recently saw a tweet mentioning the combination of using HTTPie (a command line HTTP client), jq (a lightweight and flexible command-line JSON processor) and Gron (Make JSON greppable!) was &ldquo;all you needed to build a scraper.&rdquo; Lets see if that&rsquo;s true.
First install Linux:
sudo apt-get install httpie jq OSX
brew install httpie brew install jq Lets get some stars We can pull down the list of repositories people have starred on Github using the URL scheme https://api."/>
<meta name="twitter:site" content="@wschenk"/>


  <style>
    .article p, .article ul, .article ol, .article table {
      max-width: 45em;
    }

    article.article p:first-child, .article blockquote {
      font-size: 1.25em;
      font-weight: 300;
      max-width: 36em;  
    }
  </style>
</head>
<body><nav class="container my-5">
  <h1 class="pt-md-5 display-3"><a class="text-dark" href="../../../">Will Schenk</a></h1>
  <p>
    
      <a class="text-dark h4 mr-3 font-weight-light" href="../../../articles/" title="">Articles</a>
    
      <a class="text-dark h4 mr-3 font-weight-light" href="../../../contact" title="">Contact</a>
    
      <a class="text-dark h4 mr-3 font-weight-light" href="../../../tags/" title="">Tags</a>
    
    <a href="../../../feed.xml" class="mr-3 h4 text-light"><img src="../../../img/rss.svg" alt="rss" height="20" width="20"/></a>
    
      <a href="https://twitter.com/@wschenk" class="mr-3 h4 text-light"><img src="../../../img/twitter.svg" alt="twitter" height="20" width="20"/></a>
    
    
      <a href="https://instagram.com/wschenk" class="mr-3 h4 text-light"><img src="../../../img/instagram.svg" alt="instagram" height="20" width="20"/></a>
    
    
      <a href="https://linkedin.com/in/will-schenk-420266" class="mr-3 h4 text-light"><img src="../../../img/linkedin.svg" alt="linkedin" height="20" width="20"/></a>
    
  </p>
</nav>

<div class="container">
  <h1 class="mt-5">Easy scraping with httpie and jq</h1>

  
    <h2 class="font-weight-light font-italic mb-3">Pulling my GitHub starred repositories into Hugo</h2>
  

  <p class="text-muted mt-3">
    <a class="text-muted" href="https://willschenk.com/articles/2019/easy_scraping_with_httpie_and_jq/">Published April 18, 2019</a>

    
      <a class="text-muted" href="../../../tags/howto">#howto</a>
    
      <a class="text-muted" href="../../../tags/hugo">#hugo</a>
    
      <a class="text-muted" href="../../../tags/scraper">#scraper</a>
    
      <a class="text-muted" href="../../../tags/jq">#jq</a>
    
  </p>

  

  <article class="article mt-5">
    

<p>I recently saw a tweet mentioning the combination of using <a href="https://httpie.org/">HTTPie</a> (a command line HTTP client), <a href="https://stedolan.github.io/jq/">jq</a> (a lightweight and flexible command-line JSON processor) and <a href="https://github.com/tomnomnom/gron">Gron</a> (Make JSON greppable!) was &ldquo;all you needed to build a scraper.&rdquo;  Lets see if that&rsquo;s true.</p>

<h2 id="first-install">First install</h2>

<p>Linux:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">sudo apt-get install httpie jq</code></pre></div>
<p>OSX</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">brew install httpie
brew install jq</code></pre></div>
<h2 id="lets-get-some-stars">Lets get some stars</h2>

<p>We can pull down the list of repositories people have starred on Github using the URL scheme <code>https://api.github.com/users/:username/starred</code>.  Try this:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">http https://api.github.com/users/wschenk/starred</code></pre></div>
<p>This returns a wall of data!  <code>HTTPie</code> does a nice job of formatting the JSON out and showing the response headers.</p>

<p>Let&rsquo;s use <code>jq</code> to print out the first response:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">http https://api.github.com/users/wschenk/starred <span class="p">|</span> jq <span class="s1">&#39;.[0]&#39;</span></code></pre></div>
<p>Weirdly, the Github API returns the items in the order starred, but doesn&rsquo;t include the date that we starred them.  There&rsquo;s an <a href="https://developer.github.com/v3/activity/starring/#alternative-response-with-star-creation-timestamps-1">alternative api call</a> that we can use to get the date that I pushed the Star button.  For this to work we need to pass in an Accept header of <code>application/vnd.github.v3.star+json</code> which is done like so:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"> http https://api.github.com/users/wschenk/starred Accept:application/vnd.github.v3.star+json<span class="p">|</span> jq <span class="s1">&#39;.[0]&#39;</span></code></pre></div>
<p><code>jq</code> lets us slice and dice the JSON.  Lets pull out the fields that we want.  We are using the <code>.[]</code> syntax and piping it to a json writer, which is pulling only the fields out that we want.  And we write the output to the data directory in our hugo app.</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">http https://api.github.com/users/wschenk/starred <span class="se">\
</span><span class="se"></span>  Accept:application/vnd.github.v3.star+json <span class="p">|</span> <span class="se">\
</span><span class="se"></span>  jq <span class="s1">&#39;[.[] | {name: .repo.name, full_name: .repo.full_name,
</span><span class="s1">  avatar_url: .repo.owner.avatar_url, login: .repo.owner.login,
</span><span class="s1">  description: .repo.description, starred_at: .starred_at,
</span><span class="s1">  html_url: .repo.html_url, language: .repo.language,
</span><span class="s1">  updated_at: .repo.updated_at}] &#39;</span> &gt; data/stars.json</code></pre></div>
<h2 id="using-the-hugo-data-directory">Using the hugo data directory</h2>

<p>Now that we have the data in a JSON format that Hugo can understand, lets build a page to render this glory.</p>

<p>Create a simple file in <code>content/stars.md</code> that we&rsquo;ll use to define a kind of <code>stars</code></p>
<div class="highlight"><pre class="chroma"><code class="language-md" data-lang="md">---
title: GitHub stars
type: stars
---

I like software.  Here is some of the stuff I&#39;ve found on GitHub that
I&#39;ve marked as interesting.</code></pre></div>
<p>Now we create a single page template that we&rsquo;ll use to render it in <code>layouts/stars/single.html</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-go-html-template" data-lang="go-html-template"><span class="cp">{{</span><span class="w"> </span><span class="nx">define</span><span class="w"> </span><span class="s">&#34;main&#34;</span><span class="w"> </span><span class="cp">}}</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;container&#34;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;display-4 text-center&#34;</span><span class="p">&gt;</span><span class="cp">{{</span><span class="na">.Title</span><span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>

  <span class="cp">{{</span><span class="w"> </span><span class="na">.Content</span><span class="w"> </span><span class="cp">}}</span>

  <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;list-unstyled&#34;</span><span class="p">&gt;</span>
  <span class="cp">{{</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="na">$.Site.Data.stars</span><span class="w"> </span><span class="cp">}}</span>
    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;media my-2&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">img</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;mr-3 img-fluid&#34;</span> <span class="na">width</span><span class="o">=</span><span class="s">&#34;64px&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;</span><span class="cp">{{</span><span class="w"> </span><span class="na">.avatar_url</span><span class="w"> </span><span class="cp">}}</span><span class="s">&#34;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&#34;</span><span class="cp">{{</span><span class="w"> </span><span class="na">.owner</span><span class="w"> </span><span class="cp">}}</span><span class="s"> avatar&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;media-body&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">h4</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;mt-0 mb-1&#34;</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;</span><span class="cp">{{</span><span class="na">.html_url</span><span class="cp">}}</span><span class="s">&#34;</span><span class="p">&gt;</span><span class="cp">{{</span><span class="w"> </span><span class="na">.name</span><span class="w"> </span><span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">small</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;ml-1 text-muted&#34;</span><span class="p">&gt;</span><span class="cp">{{</span><span class="w"> </span><span class="na">.language</span><span class="w"> </span><span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">small</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">h4</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;lead my-0&#34;</span><span class="p">&gt;</span><span class="cp">{{</span><span class="w"> </span><span class="na">.description</span><span class="w"> </span><span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;text-muted&#34;</span><span class="p">&gt;</span>
          Starred <span class="cp">{{</span><span class="w"> </span><span class="nx">dateFormat</span><span class="w"> </span><span class="s">&#34;Jan 2, 2006&#34;</span><span class="w"> </span><span class="na">.starred_at</span><span class="w"> </span><span class="cp">}}</span>,
          Updated <span class="cp">{{</span><span class="w"> </span><span class="nx">dateFormat</span><span class="w"> </span><span class="s">&#34;Jan 2, 2006&#34;</span><span class="w"> </span><span class="na">.updated_at</span><span class="w"> </span><span class="cp">}}</span>
        <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
  <span class="cp">{{</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="cp">}}</span>
  <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="cp">{{</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="cp">}}</span></code></pre></div>
<p>Now start up your server and go to <a href="http://localhost:1313/stars">http://localhost:1313/stars</a> !</p>

<h2 id="less-easy-scraping">Less easy scraping</h2>

<p>So it turns out that I&rsquo;ve been liking lots of things on GitHub and I have more than one page of results.  The GitHub api used the HTTP <code>Link</code> header to point to <code>next</code>, <code>prev</code>, <code>first</code>, and <code>last</code> last pages.  We&rsquo;ll write a little script that saves that and then parses it out.</p>

<ol>
<li>We create a small function that passes in <code>-dh</code> flags to <code>http</code>, redirecting stdout to our file <code>&gt;page1.json</code> and stderr to a file containing the headers <code>2&gt;headers</code>.</li>
<li>Then we&rsquo;ll parse the headers using grep, tr, and sed to pull out the url that&rsquo;s matched with <code>rel=&quot;next&quot;</code>.</li>
<li>If there is one we&rsquo;ll follow that and download <code>page2.json</code> etc.</li>
<li>Then we&rsquo;ll merge all of the files together using <code>jq --slurp '[.[][]]' *json</code> so the muliple files of JSON Arrays is one big JSON array.</li>
<li>And then copy over our existing <code>jq</code> parsing</li>
</ol>

<p>Here&rsquo;s <code>update_github_stars.sh</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="cp">#!/bin/bash
</span><span class="cp"></span>
<span class="c1"># Download a url</span>
<span class="k">function</span> scrape_page<span class="o">()</span> <span class="o">{</span>
  <span class="nb">echo</span> Downloading <span class="nv">$1</span> to <span class="nv">$2</span>
  http <span class="nv">$1</span> Accept:application/vnd.github.v3.star+json -dh &gt;<span class="nv">$2</span> <span class="m">2</span>&gt;<span class="nv">$3</span>
<span class="o">}</span>

<span class="k">function</span> next_link_from_header<span class="o">()</span> <span class="o">{</span>
  <span class="c1"># grep - Filter for the Link header</span>
  <span class="c1"># tr - slit each of the entries into it&#39;s own line</span>
  <span class="c1"># grep - look for the next link</span>
  <span class="c1"># sed - get rid of everything out side of the &lt; &gt;</span>
  cat <span class="nv">$1</span> <span class="p">|</span> grep ^Link <span class="p">|</span>tr <span class="s1">&#39;,&#39;</span> <span class="s1">&#39;\n&#39;</span><span class="p">|</span>grep <span class="se">\&#34;</span>next<span class="se">\&#34;</span> <span class="p">|</span> sed <span class="s1">&#39;s/.*&lt;\(.*\)&gt;.*/\1/&#39;</span>
<span class="o">}</span>

<span class="nv">OUTDIR</span><span class="o">=</span><span class="k">$(</span>mktemp -d<span class="k">)</span>
<span class="nv">PAGE</span><span class="o">=</span><span class="m">1</span>
<span class="nv">NEXTURL</span><span class="o">=</span>https://api.github.com/users/wschenk/starred

<span class="k">while</span> <span class="o">[</span> ! -z <span class="s2">&#34;</span><span class="si">${</span><span class="nv">NEXTURL</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">do</span>
  scrape_page <span class="nv">$NEXTURL</span>  <span class="nv">$OUTDIR</span>/page<span class="si">${</span><span class="nv">PAGE</span><span class="si">}</span>.json <span class="nv">$OUTDIR</span>/headers

  <span class="nv">NEXTURL</span><span class="o">=</span><span class="k">$(</span>next_link_from_header <span class="nv">$OUTDIR</span>/headers<span class="k">)</span>
  <span class="nv">PAGE</span><span class="o">=</span><span class="k">$((</span> <span class="nv">$PAGE</span> <span class="o">+</span> <span class="m">1</span> <span class="k">))</span>
<span class="k">done</span>

<span class="nb">echo</span> Finished scraping pages

<span class="c1"># Combine the files</span>
<span class="c1"># Parse them into data/stars.json</span>

jq -s <span class="s1">&#39;[.[][]]&#39;</span> <span class="nv">$OUTDIR</span>/*json <span class="p">|</span> <span class="se">\
</span><span class="se"></span>  jq <span class="s1">&#39;[.[] | {name: .repo.name, full_name: .repo.full_name,
</span><span class="s1">  avatar_url: .repo.owner.avatar_url, login: .repo.owner.login,
</span><span class="s1">  description: .repo.description, starred_at: .starred_at,
</span><span class="s1">  html_url: .repo.html_url, language: .repo.language,
</span><span class="s1">  updated_at: .repo.updated_at}] &#39;</span> &gt; data/stars.json</code></pre></div>
<h2 id="conclusion">Conclusion</h2>

<p>My <a href="../../../stars/">Star List</a> is a little unwieldy right now with 120 entries (<code>js '. | length' data/stars.json</code>) and not all of the descriptions are that informative, but this was all built with simple tools and minimal dependacies.  We didn&rsquo;t need any special libraries to script this, <code>Gemfile</code> or <code>package.json</code> installations, just a relatively simple bash script.</p>

  </article>
</div>


  <div class="bg-light py-5">
    <div class="container">
      <h2 class="text-center">Read next</h2>

      <div class="row">
        <div class="col-md-6 text-center">
          
        </div>
        <div class="col-md-6 text-center">
          
            Previous Post:
            <a href="../../../articles/2019/building_a_slimmer_go_docker_container/">Building a slimmer go Docker container</a>
          
        </div>
      </div>
    </div>
  </div>




<div class="container mt-5">
  <h2 class="text-center">See also</h2>
  <div class="row">
  	
      <div class="col-md mb-3">
        <p class="lead mb-0"><a class="text-body" href="../../../articles/2018/automating_hugo_with_circleci/">Automating hugo builds using CircleCI</a></p>

        
          <p class="lead font-italic mb-0">Let someone else run your build server</p>
        
        <div class="font-weight-light mt-3">
          
          
            <p><p class="lead">Here's a simple CircleCI configuration to pull down the latest version of your hugo site on GitHub commits, build it, and then push it to github pages.</p></p>
          
        </div>
        <a href="../../../articles/2018/automating_hugo_with_circleci/" class="btn btn-primary">Read more</a>
      </div>
    
      <div class="col-md mb-3">
        <p class="lead mb-0"><a class="text-body" href="../../../articles/2018/adding_a_cms_to_hugo/">Adding a CMS to hugo</a></p>

        
          <p class="lead font-italic mb-0">Static doesn&rsquo;t mean dead</p>
        
        <div class="font-weight-light mt-3">
          
          
            <p>Just because we have a static site doesn&rsquo;t mean that we can&rsquo;t have an admin tool to write and edit posts! Lets go through how we can add the NetlifyCMS to the site and host it wherever we want.
In my case I&rsquo;m storing the code on GitHub and also serving the pages from GitHub Pages. Netlify also seems like a really promising company with a number of other services that they offer, so I&rsquo;d encourage you to check it out.</p>
          
        </div>
        <a href="../../../articles/2018/adding_a_cms_to_hugo/" class="btn btn-primary">Read more</a>
      </div>
    
      <div class="col-md mb-3">
        <p class="lead mb-0"><a class="text-body" href="../../../articles/2018/building-a-hugo-site/">Building a hugo site and theme with Bootstrap</a></p>

        
          <p class="lead font-italic mb-0">hugo is blazing fast</p>
        
        <div class="font-weight-light mt-3">
          
          
            <p>Now that&rsquo;s its 2018 its time to retool the blog using hugo. Why not? Hugo is built in golang and is blazing fast and everything is cleaner than it was in the middleman years.
One of the reasons that I liked middleman &ndash; it&rsquo;s usage of the rails&rsquo; Sprockets library &ndash; is no longer a strength. The javascript and front-end world has moved over to WebPack and I&rsquo;ve personally moved over to create-react-app.</p>
          
        </div>
        <a href="../../../articles/2018/building-a-hugo-site/" class="btn btn-primary">Read more</a>
      </div>
    
  </div>
</div>


<footer class="footer bg-dark text-light mt-3">
  <div class="container">
    <h2 class="py-5 font-weight-light my-0">Made in Brooklyn, NY.</h2>
  </div>
</footer>
</body>
</html>
