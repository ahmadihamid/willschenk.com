<!DOCTYPE html>
<html class='no-js'>
  <head>
    <meta charset='utf-8'>
    <meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
    <title>Building a GUI for managing middleman blogs | Blank Page Tech</title>
    <meta name="site" content="Blank Page Tech" />
    <meta name="og:site_name" content="Blank Page Tech" />
    <meta name="title" content="Building a GUI for managing middleman blogs" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Building a GUI for managing middleman blogs" />
    <meta name="twitter:site" content="@wschenk" />
    <meta name="og:title" content="Building a GUI for managing middleman blogs" />
    <meta content='width=device-width' name='viewport'>
    <link href="../stylesheets/application-c2e1d785.css" rel="stylesheet" type="text/css" /><link href="../stylesheets/webicons-da5ecace.css" rel="stylesheet" type="text/css" /><link href="../stylesheets/googlecode-d3629bf4.css" rel="stylesheet" type="text/css" />
    <link href='//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.3/styles/default.min.css' rel='stylesheet'>
    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />
  </head>
  <body data-spy='scroll' data-target='.sidebar'>
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">
      <div class='visible-xs-block'>
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapsable">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a href="/" class="navbar-brand">
        Blank Page Tech
      </a>
        
      </div>
    </div>
    <div class='hidden-xs'>
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapsable">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a href="/" class="navbar-brand">
        Technology for the blank page
      </a>
        
      </div>
    </div>
    <div class="collapse navbar-collapse" id="navbar-collapsable">
      <ul class="nav navbar-nav navbar-right foo" id="menu">
      <li>
      <a href="/articles/">
        Articles
      </a>
    </li>
    <li class="dropdown">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown">Topics <b class="caret"></b></a>
      <ul class="dropdown-menu">
        <li>
      <a href="/tags/howto/">
        Howtos
      </a>
    </li>
    <li>
      <a href="/tags/overview/">
        Overviews
      </a>
    </li>
    <li>
      <a href="/tags/product/">
        Product
      </a>
    </li>
    <li>
      <a href="/tags/tools/">
        Tools
      </a>
    </li>
    <li>
      <a href="/tags/socialinvestigator/">
        Social Investigator
      </a>
    </li>
    <li>
      <a href="/tags/ruby/">
        Ruby & Rails
      </a>
    </li>
    
      </ul>
    </li>
    <li class="dropdown">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tags <b class="caret"></b></a>
      <ul class="dropdown-menu">
        <li>
      <a href="/bootstrap-advanced-grid-tricks/">
        bootstrap (1)
      </a>
    </li>
    <li>
      <a href="/tags/bots/">
        bots (2)
      </a>
    </li>
    <li>
      <a href="/using-rake-for-dataflow-programming-and-data-science/">
        data (1)
      </a>
    </li>
    <li>
      <a href="/osx-script-for-kiosk-mode/">
        gaze (1)
      </a>
    </li>
    <li>
      <a href="/using-seed-to-explore/">
        github (1)
      </a>
    </li>
    <li>
      <a href="/pulling-data-out-of-google-analytics/">
        googleanalytics (1)
      </a>
    </li>
    <li>
      <a href="/tags/happy_seed/">
        happy_seed (4)
      </a>
    </li>
    <li>
      <a href="/tags/howto/">
        howto (17)
      </a>
    </li>
    <li>
      <a href="/bower-with-rails/">
        javascript (1)
      </a>
    </li>
    <li>
      <a href="/tags/middleman/">
        middleman (6)
      </a>
    </li>
    <li>
      <a href="/setting-up-devise-with-twitter-and-facebook-and-other-omniauth-schemes-without-email-addresses/">
        oauth (1)
      </a>
    </li>
    <li>
      <a href="/tags/osx/">
        osx (2)
      </a>
    </li>
    <li>
      <a href="/tags/overview/">
        overview (4)
      </a>
    </li>
    <li>
      <a href="/tags/product/">
        product (2)
      </a>
    </li>
    <li>
      <a href="/tags/rails/">
        rails (5)
      </a>
    </li>
    <li>
      <a href="/tags/rake/">
        rake (2)
      </a>
    </li>
    <li class="active">
      <a href="/building-a-gui-for-managing-middleman-blogs/">
        react (1)
      </a>
    </li>
    <li>
      <a href="/how-to-track-your-coworkers/">
        redis (1)
      </a>
    </li>
    <li>
      <a href="/tags/ruby/">
        ruby (16)
      </a>
    </li>
    <li>
      <a href="/receiving-posted-json-with-sinatra/">
        sinatra (1)
      </a>
    </li>
    <li>
      <a href="/tags/socialinvestigator/">
        socialinvestigator (4)
      </a>
    </li>
    <li>
      <a href="/dateslice-writing-rails-extensions/">
        sql (1)
      </a>
    </li>
    <li>
      <a href="/field-of-dreams-is-25-years-old-and-hasn-t-aged-well/">
        startupmyths (1)
      </a>
    </li>
    <li>
      <a href="/tags/static_sites/">
        static_sites (2)
      </a>
    </li>
    <li>
      <a href="/setting-up-testing/">
        testing (1)
      </a>
    </li>
    <li>
      <a href="/making-a-command-line-utility-with-gems-and-thor/">
        thor (1)
      </a>
    </li>
    <li>
      <a href="/tags/tools/">
        tools (5)
      </a>
    </li>
    <li>
      <a href="/tags/toys/">
        toys (5)
      </a>
    </li>
    
      </ul>
    </li>
    <li class="dropdown">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown">Archives <b class="caret"></b></a>
      <ul class="dropdown-menu">
        <li>
      <a href="/inflight-internet/">
        Dec 2015 (1)
      </a>
    </li>
    <li>
      <a href="/using-seed-to-explore/">
        Sep 2015 (1)
      </a>
    </li>
    <li>
      <a href="/2015/07/">
        Jul 2015 (3)
      </a>
    </li>
    <li>
      <a href="/adding-search-to-a-middleman-blog/">
        Jun 2015 (1)
      </a>
    </li>
    <li>
      <a href="/2015/05/">
        May 2015 (2)
      </a>
    </li>
    <li>
      <a href="/why-engineers-build-crappy-products/">
        Feb 2015 (1)
      </a>
    </li>
    <li>
      <a href="/2015/01/">
        Jan 2015 (2)
      </a>
    </li>
    <li>
      <a href="/2014/12/">
        Dec 2014 (5)
      </a>
    </li>
    <li>
      <a href="/2014/11/">
        Nov 2014 (10)
      </a>
    </li>
    <li>
      <a href="/how-to-track-your-coworkers/">
        Oct 2014 (1)
      </a>
    </li>
    
      </ul>
    </li>
    
    </ul>
    <form class='navbar-form navbar-right' id='search' role='search'>
      <div class='form-group dropdown'>
        <div class='input-group'>
          <input autocomplete='off' class='form-control' id='search_box' placeholder='Search' type='text'>
          <span class='input-group-btn'>
            <button class='btn btn-default'>
              <span class='glyphicon glyphicon-search'></span>
            </button>
          </span>
        </div>
        <ul class='dropdown-menu dropdown-menu-left results'>
          <a href="/url">Title</a>
        </ul>
      </div>
    </form>
    
    </div>
    
    </div>
    </nav>
    <div class='banner'>
      <img class="fadeInDown animated" src="../images/calig-742eb1c6.jpg" />
    </div>
    <div class='article-header lighter '>
      <h1>Building a GUI for managing middleman blogs</h1>
      <h2>the site will still be fast, really fast</h2>
      <div class='tags'>
        <div class='tag'><a class="btn btn-primary" href="/tags/middleman/">middleman</a></div>
        <div class='tag'><a class="btn btn-primary" href="/tags/react/">react</a></div>
        <div class='tag'><a class="btn btn-primary" href="/tags/static_sites/">static_sites</a></div>
      </div>
      <a href='#comment_shower' id='comment_shower_scroll'>
        <span class='disqus-comment-count' data-disqus-identifier='2015-07-30-building-a-gui-for-managing-middleman-blogs.html'></span>
      </a>
    </div>
    <div class='content'>
      <div class='row'>
        <div class='sidebar'>
          <ul class='nav toc' data-offset-top='400' data-spy='affix'>
            <li><a href="#top">Building a GUI for managing middleman blogs</a></li>
            <li><a href="#tldr">TLDR</a></li>
            <li><a href="#why-do-this">Why do this</a></li>
            <li><a href="#the-basic-idea">The basic idea</a></li>
            <li><a href="#static-middleman-site">Static Middleman Site</a></li>
            <li><a href="#the-sinatra-app">The Sinatra App</a></li>
            <li><a href="#the-javascript-app">The Javascript App</a></li>
            <li><a href="#putting-it-all-together">Putting it all together</a></li>
            <li><a href="#next-steps">Next steps</a></li>
          </ul>
        </div>
        <div class='article' id='top'>
          <p>Can we make static site generators work like a normal site? Lets take a look at how we&#39;d start to implement <a href="/slow-data-and-fast-sites/">Slow Data and Fast Sites</a> using the example of building an admin UI for a Middleman blog.</p>
          
          <h2 id="tldr">TLDR</h2>
          
          <p>Given a middleman app with <code>middleman-blog</code> and <code>middleman-blog-drafts</code> configured:</p>
          
          <ol>
          <li>Add <code>middleman-blog-ui</code> in your <code>Gemfile</code>.  <em>This document describes how <code>middleman-blog-ui</code> works.</em></li>
          <li>Add <code>activate :blog_ui</code> in <code>config.rb</code></li>
          <li>Start <code>middleman server</code></li>
          <li>Visit <a href="http://localhost:4567/admin">http://localhost:4567/admin</a>.</li>
          </ol>
          
          <p>And now you are living in the fabulous world where you can, from your browser:</p>
          
          <ul>
          <li>Edit existing drafts and posts</li>
          <li>Create new drafts</li>
          <li>Publish drafts into posts</li>
          <li>Run some basic <code>git</code> commands.</li>
          <li>Run <code>middleman build</code></li>
          <li>Run <code>middleman deploy</code></li>
          </ul>
          
          <h2 id="why-do-this">Why do this</h2>
          
          <p>This is explained in more detail in the  <a href="/slow-data-and-fast-sites/">Slow Data and Fast Sites</a> post, but basically what we&#39;re trying to do it seperate out runtime tooling with development time tooling.  <em>Future work will be around differentiating when components are rendered and from which data source.</em></p>
          
          <p>Static sites have a huge runtime benefit, but actually setting them up and running them can <a href="http://veekaybee.github.io/static-sites-suck/">really suck unless you already know how to do it</a>.  This is a proof of concept of how to add a CMS to a static site so that it&#39;s easier to manage.  This doesn&#39;t address the &quot;pain in the ass to setup&quot; part, but it helps with the usability.</p>
          
          <p>Lets walk through what we&#39;re doing if we were to implement this in your own app directly.  The gem packages this up with a slightly different directory scheme, but the code below is the same but slightly easier to understand.</p>
          
          <h2 id="the-basic-idea">The basic idea</h2>
          
          <p>We&#39;re going to add a static JavaScript application in the <code>source/admin</code> directory which will interact with the local filesystem and middleman install.  This application will consume data from your middleman app on the local system, in the &quot;development&quot; environment, such as the lists of published and draft articles, and will interact with a API server that will be mounted as part of the middleman preview server.  This will allow the Javascript app to change the filesystem, which will in turn be monitored and rendered by the middleman application.  </p>
          
          <p>Examples of the commands that can be triggered are:</p>
          
          <ul>
          <li>create new draft</li>
          <li>publish draft into article</li>
          <li><code>git status</code></li>
          <li><code>bundle exec middleman build</code></li>
          </ul>
          
          <p><svg width="255pt" height="260pt" viewBox="0.00 0.00 255.34 260.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 256)"><title>G</title><polygon fill="white" stroke="none" points="-4,4 -4,-256 251.341,-256 251.341,4 -4,4"/>&lt;!-- app --&gt;<g id="node1" class="node"><title>app</title><polygon fill="none" stroke="black" points="142.136,-252 0.722016,-252 0.722016,-216 142.136,-216 142.136,-252"/><text text-anchor="middle" x="71.4292" y="-229.8" font-family="Times,serif" font-size="14.00">Static Middleman Site</text></g>&lt;!-- admin --&gt;<g id="node2" class="node"><title>admin</title><polygon fill="none" stroke="black" points="154.788,-36 0.0707361,-36 0.0707361,-0 154.788,-0 154.788,-36"/><text text-anchor="middle" x="77.4292" y="-13.8" font-family="Times,serif" font-size="14.00">Admin JS FrontEnd App</text></g>&lt;!-- admin&#45;&gt;app --&gt;<g id="edge5" class="edge"><title>admin&#45;&gt;app</title><path fill="none" stroke="black" d="M66.8041,-36.444C61.3313,-46.4566 55.2313,-59.4912 52.4292,-72 42.0373,-118.39 53.6295,-173.651 62.7198,-205.883"/><polygon fill="black" stroke="black" points="59.4841,-207.285 65.6713,-215.885 66.1979,-205.303 59.4841,-207.285"/></g>&lt;!-- api --&gt;<g id="node3" class="node"><title>api</title><polygon fill="none" stroke="black" points="181.916,-108 60.9429,-108 60.9429,-72 181.916,-72 181.916,-108"/><text text-anchor="middle" x="121.429" y="-85.8" font-family="Times,serif" font-size="14.00">Sinatra API Server</text></g>&lt;!-- admin&#45;&gt;api --&gt;<g id="edge4" class="edge"><title>admin&#45;&gt;api</title><path fill="none" stroke="black" d="M88.3056,-36.3034C93.4208,-44.4411 99.6247,-54.311 105.274,-63.2987"/><polygon fill="black" stroke="black" points="102.393,-65.2919 110.678,-71.8957 108.319,-61.5667 102.393,-65.2919"/></g>&lt;!-- api&#45;&gt;app --&gt;<g id="edge3" class="edge"><title>api&#45;&gt;app</title><path fill="none" stroke="black" d="M109.321,-108.433C102.869,-118.442 95.2835,-131.477 90.4292,-144 82.6849,-163.979 77.8136,-187.768 74.9446,-205.723"/><polygon fill="black" stroke="black" points="71.4545,-205.398 73.4447,-215.804 78.3783,-206.428 71.4545,-205.398"/></g>&lt;!-- cmds --&gt;<g id="node4" class="node"><title>cmds</title><polygon fill="none" stroke="black" points="247.254,-180 99.6049,-180 99.6049,-144 247.254,-144 247.254,-180"/><text text-anchor="middle" x="173.429" y="-157.8" font-family="Times,serif" font-size="14.00">Middleman Commands</text></g>&lt;!-- api&#45;&gt;cmds --&gt;<g id="edge2" class="edge"><title>api&#45;&gt;cmds</title><path fill="none" stroke="black" d="M134.283,-108.303C140.454,-116.611 147.966,-126.723 154.753,-135.859"/><polygon fill="black" stroke="black" points="151.95,-137.955 160.723,-143.896 157.569,-133.781 151.95,-137.955"/></g>&lt;!-- cmds&#45;&gt;app --&gt;<g id="edge1" class="edge"><title>cmds&#45;&gt;app</title><path fill="none" stroke="black" d="M148.477,-180.124C135.388,-189.107 119.169,-200.237 104.993,-209.966"/><polygon fill="black" stroke="black" points="102.742,-207.266 96.4771,-215.81 106.703,-213.038 102.742,-207.266"/></g></g></svg></p>
          
          <p>Let go through each of the components as if we were building them in our app directly.  The <code>gem</code> does a lot of this for you, but it&#39;s always nice to see how it works.</p>
          
          <h2 id="static-middleman-site">Static Middleman Site</h2>
          
          <p>We&#39;re going to add our files in <code>source/admin</code>, and <code>source/javascript/admin</code> and <code>source/stylesheets/admin.scss</code>.  All of these files will be rendered in development mode, so when the server is running locally and you load up <a href="http://localhost:4567/admin">http://localhost:4567/admin</a> we can use the middleman build process to load up our UI.  This, in turn, will use AJAX to pull in data from the running middleman instance.</p>
          
          <p>Inside of <code>config.rb</code>, we tell middleman about our pages, and we tell the build process to ignore these files as part of the build process since we don&#39;t want to release them into production:</p>
          
          <pre><code class="rb">page &quot;/admin/*html&quot;, layout: &quot;admin/layout&quot;&#x000A;&#x000A;# Build-specific configuration&#x000A;configure :build do&#x000A;  ignore &#39;/admin/*&#39;&#x000A;  ignore &#39;/stylesheets/admin/*&#39;&#x000A;  ignore &#39;/javascripts/admin/*&#39;&#x000A;end&#x000A;</code></pre>
          
          <p>If they were not ignored, then you would be deploying a read-only version of the admin tools, since the production build would include the javascript application but not the API which is needed to make changes.</p>
          
          <p>This will allow us to create files like <code>/source/admin/drafts.json.erb</code>:</p>
          
          <pre><code class="erb">&lt;% d = drafts.collect do |d|&#x000A;    { path: d.path, title: d.title }&#x000A;  end&#x000A;%&gt;&lt;%= &#x000A;  {drafts: d }.to_json&#x000A;%&gt;&#x000A;</code></pre>
          
          <p>That we can load from our JS app like:</p>
          
          <pre><code class="js">$.get( &#39;/admin/drafts.json&#39; ).then( function( data ) { console.log( data ) } );&#x000A;</code></pre>
          
          <p>Note that when we do <code>middleman build</code> these files <em>will not</em> be generated, since we&#39;ve specified them as <code>ignore</code>.  These files only are in the <code>:development</code> environment.</p>
          
          <h2 id="the-sinatra-app">The Sinatra App</h2>
          
          <p>That&#39;s fine for static data, or data that can be exposed using normal middleman ways of doing things, but we&#39;ll also want to be able to interact with the filesystem and run commands.  It&#39;s also going to be useful to interact with the middleman <em>Sitemap</em> as it understands it, so we can build a simple sinatra app that acts as a bridge.  The current version of the code I&#39;m using for this blog can be found <a href="https://github.com/HappyFunCorp/middleman-blog-ui/blob/master/lib/middleman/blog/ui/api_server.rb">on github</a>.</p>
          
          <p>First we need to <code>require</code> and <code>mount</code> our app on <code>config.rb</code>.  This is done like so:</p>
          
          <pre><code class="rb">require &#39;lib/apiserver.rb&#39;&#x000A;&#x000A;map &quot;/api&quot; do&#x000A;  run ApiServer&#x000A;end&#x000A;</code></pre>
          
          <p>The commands we want to support are:</p>
          
          <ul>
          <li><code>get /api/post</code> - load a specific post and metadata</li>
          <li><code>post /api/post</code> - save a post and update metadata</li>
          <li><code>post /api/images</code> - upload an image (for drag and drop) (not implemented)</li>
          <li><code>post /api/draft</code> - create a new draft post</li>
          <li><code>post /api/publish</code> - change a draft into an article</li>
          <li><code>post /api/update</code> - run <code>git pull origin master 2&gt;&amp;1</code></li>
          <li><code>post /api/diff</code> - run <code>git diff 2&gt;$1</code></li>
          <li><code>post /api/status</code> - run <code>git status 2&gt;&amp;1</code></li>
          <li><code>post /api/build</code> - run <code>bundle exec middleman build 2&gt;&amp;1</code></li>
          <li><code>post /api/deploy</code> - run <code>bundle exec middleman deploy 2&gt;&amp;1</code></li>
          </ul>
          
          <p>To reiterate right now the code is in more of a proof of concept, butso please feel free to make suggestions. Lets take a look at a few of these methods in <code>lib/api_server.rb</code>:</p>
          
          <pre><code class="rb">require &#39;sinatra/base&#39;&#x000A;require &#39;sinatra/json&#39;&#x000A;&#x000A;class ApiServer &lt; Sinatra::Base&#x000A;  get &#39;/&#39; do&#x000A;    &quot;This is the api server&quot;&#x000A;  end&#x000A;&#x000A;  get &#39;/post&#39; do&#x000A;    app = load_app&#x000A;&#x000A;    logger.info &quot;Looking up #{params[:path]}&quot;&#x000A;&#x000A;    file = app.sitemap.find_resource_by_path params[:path] if params[:path]&#x000A;&#x000A;    if !file&#x000A;      status 404&#x000A;      json error: &quot;Unknown path #{params[:path]}&quot;&#x000A;    else&#x000A;      raw = File.read file.source_file&#x000A;      body = raw.gsub( /^---\n.*?---\n*/m, &quot;&quot; ) # Remove the preyaml&#x000A;&#x000A;      json meta: file.data, content: body&#x000A;    end&#x000A;  end&#x000A;&#x000A;  private&#x000A;  def load_app&#x000A;    opts = {}&#x000A;&#x000A;    app = ::Middleman::Application.server.inst do&#x000A;      set :environment, opts[:environment].to_sym if opts[:environment]&#x000A;&#x000A;      logger&#x000A;    end&#x000A;&#x000A;    app&#x000A;  end&#x000A;&#x000A;  def logger&#x000A;    ::Middleman::Logger.singleton( 1 )&#x000A;  end&#x000A;end&#x000A;</code></pre>
          
          <h2 id="the-javascript-app">The Javascript App</h2>
          
          <p>I also wanted to see how to build this in <a href="http://facebook.github.io/react/index.html">React</a> and <a href="https://github.com/reflux/refluxjs">Reflux</a> to start exploring how we can start to add build-type rendering into the equation.  While this doesn&#39;t do any server side rendering, its still good to explore how a React app actually works.</p>
          
          <p>The main html file simple calls <code>React.render( React.createElement(App, null), document.getElementById(&#39;content&#39;) );</code> to setup the page.  The <a href="https://github.com/HappyFunCorp/middleman-blog-ui/blob/master/source/javascripts/admin/components/app.js.coffee">App</a> component works off of the <a href="https://github.com/HappyFunCorp/middleman-blog-ui/blob/master/source/javascripts/admin/stores/article.coffee">pathStore</a> component, which keeps track of what page the user is currently editing.  Lets take a quick look at how the <a href="https://github.com/HappyFunCorp/middleman-blog-ui/blob/master/source/javascripts/admin/components/dashboard_draft_list.js.coffee">DashboardDraftList</a> component works:</p>
          
          <pre><code class="coffeescript">@DashboardDraftList = React.createClass&#x000A;  mixins: [Reflux.connect(draftStore)],&#x000A;&#x000A;  getInitialState: -&gt;&#x000A;    drafts: []&#x000A;&#x000A;  componentDidMount: -&gt; updateDraftList()&#x000A;&#x000A;  render: -&gt;&#x000A;    drafts = @state.drafts.map (item) -&gt;&#x000A;      &lt;li key={item.path}&gt;&lt;a onClick={viewPath.bind(this, item.path)}&gt;{item.title}&lt;/a&gt;&lt;/li&gt;&#x000A;&#x000A;    &lt;div className=&quot;maincontent&quot;&gt;&#x000A;      &lt;h1&gt;Drafts&lt;/h1&gt;&#x000A;&#x000A;      &lt;ul className=&quot;nav nav-pills nav-stacked&quot;&gt;&#x000A;        {drafts}&#x000A;      &lt;/ul&gt;&#x000A;    &lt;/div&gt;&#x000A;</code></pre>
          
          <p>The first thing that this does is wire itself up to the <code>draftStore</code> store which manages the communication to the server and the state received from the server.  When this changes, <code>draftStore</code> will trigger a state change and all components that have been connected will receive a <code>setState</code> message, which will then call the <code>render</code> method of the component keeping the UI up to date.   As part of the React component life cycle <code>componentDidMount</code>, we call the <code>updateDraftList()</code> action when the component is first loaded on the page.  This is defined in <a href="https://github.com/HappyFunCorp/middleman-blog-ui/blob/master/source/javascripts/admin/stores/drafts.coffee">drafts store</a>:</p>
          
          <pre><code class="coffeescript">@updateDraftList = Reflux.createAction&#x000A;  asyncResult: true&#x000A;&#x000A;@draftStore = Reflux.createStore&#x000A;  init: -&gt;&#x000A;    @drafts = []&#x000A;    @listenTo( updateDraftList, @onUpdateDrafts )&#x000A;&#x000A;  onUpdateDrafts: -&gt;&#x000A;    request.get &quot;/admin/drafts.json&quot;, (err, response) =&gt;&#x000A;      if response.ok&#x000A;        updateDraftList.completed( response.body )&#x000A;        @drafts = response.body&#x000A;        @trigger @drafts&#x000A;      else&#x000A;        updateDraftList.failed(response.error)&#x000A;</code></pre>
          
          <p>The first thing we do is to define and export a <code>Reflux</code> action called <code>updateDraftList</code>.  This action is what the <code>componentDidMount</code> function triggeres.  Inside of the <code>draftStore</code> we listen for that action, and when it get it, call <code>onUpdateDrafts</code>.  This uses request.get to load up the json from <code>/admin/drafts.json</code> and then pushes it out to all of the components that have subscribed to it.</p>
          
          <p>The other components are <a href="https://github.com/HappyFunCorp/middleman-blog-ui/tree/master/source/javascripts/admin/components">defined here</a> and the different stores can be <a href="https://github.com/HappyFunCorp/middleman-blog-ui/tree/master/source/javascripts/admin/stores">found here</a>.  This is my first real React app so I&#39;m sure there&#39;s cleaner/better ways of doing things...</p>
          
          <h2 id="putting-it-all-together">Putting it all together</h2>
          
          <p>When I was working on this I did it out of the source directory of this blog, but I wanted to package it up into a gem so that other folks could use it.  I pulled the relavent code out from <code>willschenk.com/source</code> into <code>middleman-blog-ui/source</code> and then created a middleman extension to put the various templates in the sitemap, tell sprockets where to find the javascript files, and setup coffee script.</p>
          
          <p>The <a href="https://github.com/HappyFunCorp/middleman-blog-ui/blob/master/lib/middleman/blog/ui/extension.rb">full code</a> is found on github, but to explain how it works:</p>
          
          <ol>
          <li>Define <code>SOURCE_DIR</code></li>
          <li>Map the sinatra app <code>ApiServer</code> in the extentions <code>initialize</code> method, using <code>app.map</code>.</li>
          <li>Register the CoffeeScript processing using <code>::Sprockets.register_preprocessor &#39;application/javascript&#39;, ::Sprockets::CoffeeReact</code></li>
          <li>Use <code>after_configuration</code> to register the application templates, by creating <code>Middleman::Sitemap::Resource</code> objects mapping the sitemap urls with the filesytem paths.</li>
          <li>Adding each of the javascript and stylesheet files to <code>app.sprockets</code>.</li>
          </ol>
          
          <h2 id="next-steps">Next steps</h2>
          
          <p>This is mainly a proof of concept, but I&#39;m using it right now to write this post.  The app itself needs</p>
          
          <ol>
          <li>A decent UI</li>
          <li>Support for other static generators other than middleman</li>
          <li>A concept of users</li>
          <li>Shared drafts</li>
          <li>Better error handling</li>
          </ol>
          
          <p>If you are at all interested in this, please let me know!</p>
        </div>
        <div class='navigation' data-offset-top='400' data-spy='affix'>
          <div class='next'>
            <p>
              Next in
              <a href="/articles/">Chronological</a>
            </p>
            <p class='title'><a href="/using-seed-to-explore/">Using seed to explore APIs</a></p>
          </div>
          <div class='prev'>
            <p>
              Previously in
              <a href="/articles/">Chronological</a>
            </p>
            <p class='title'><a href="/receiving-posted-json-with-sinatra/">Receiving posted JSON with Sinatra</a></p>
            <p>
              Previously in
              <a href="/tags/middleman/">Middleman</a>
            </p>
            <p class='title'><a href="/adding-search-to-a-middleman-blog/">Adding search to a middleman blog</a></p>
            <p>
              Previously in
              <a href="/tags/static_sites/">Static_sites</a>
            </p>
            <p class='title'><a href="/slow-data-and-fast-sites/">Slow data and Fast Sites</a></p>
          </div>
        </div>
      </div>
      <div class="row article_footer">
        <div class="comments">
            <a href="#" id="comment_shower">
              <p class="disqus-comment-count" data-disqus-identifier="2015-07-30-building-a-gui-for-managing-middleman-blogs.html">Be the first to comment.</p>
            </a>
        </div>
        <div class="sharing">
          <a href="http://www.twitter.com/share?url=http://willschenk.com/building-a-gui-for-managing-middleman-blogs/&amp;text=Building a GUI for managing middleman blogs by @wschenk" title="Share this post on Twitter" data-lang="en" onclick="return !window.open(this.href, 'Twitter', 'width=640,height=300')" class="webicon twitter"></a>
      
          <a target="_blank" onclick="return !window.open(this.href, 'Facebook', 'width=640,height=300')" href="http://www.facebook.com/sharer/sharer.php?u=http://willschenk.com/building-a-gui-for-managing-middleman-blogs/" title="Share this post on Facebook" class="webicon facebook"></a>
      
          <a href="http://plus.google.com/share?url=http://willschenk.com/building-a-gui-for-managing-middleman-blogs/" target="_blank" onclick="return !window.open(this.href, 'Google +', 'width=640,height=300')" title="Share this post on Google +" class="webicon google"></a>
        </div>
      </div>
        <div class="comment_row">
          <div class="comment_universe">
            <div id="disqus_thread" class="col-sm-10 col-sm-offset-1"></div>
          </div>
        </div>
    </div>
    <footer class='codex'>
      <div class='container'>
        <div class='row'>
          <div class='logo'>
            <a href='http://codex.happyfuncorp.com/'>
              <img src="../images/ted-16edc59a.png" />
              <img src="../images/codex_logo-02a37740.png" />
            </a>
          </div>
        </div>
        <div class='row'>
          <div class='body'>
            <h3>
              If you find this blog helpful, check out
              <a href='http://codex.happyfuncorp.com/'>
                codex
              </a>
            </h3>
            <p>Product, development, design and a whole slew of other things you need to know.</p>
            <p>
              From the fancy folks at
              <a href="http://happyfuncorp.com">HappyFunCorp</a>
            </p>
          </div>
        </div>
      </div>
    </footer>
    <footer class='footer lighter '>
      <div class='container'>
        <div class='row'>
          <div class='social'>
            <span>
              <a class='webicon twitter' href='http://twitter.com/wschenk'></a>
            </span>
            <span>
              <a class='webicon tumblr' href='http://sublimeguile.com/'></a>
            </span>
            <span>
              <a class='webicon instagram' href='http://instagram.com/wschenk'></a>
            </span>
            <span>
              <a class='webicon linkedin' href='http://www.linkedin.com/pub/will-schenk/0/266/420/'></a>
            </span>
            <span>
              <a class='webicon github' href='https://github.com/wschenk'></a>
            </span>
            <span>
              <a class='webicon rss' href='http://willschenk.com/feed.xml'></a>
            </span>
            <span>
              <a class='webicon mail' href='mailto:will@happyfuncorp.com'></a>
            </span>
          </div>
          <div class='made_in_bk'>
            <h3>Made in Brooklyn, NY</h3>
          </div>
        </div>
      </div>
    </footer>
    <script src="../javascripts/application-b5017286.js" type="text/javascript"></script><script src="../javascripts/modernizr-84a49412.js" type="text/javascript"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.3/highlight.min.js"></script>
    <script type="text/javascript">
      var _gaq=[['_setAccount','UA-56296045-1'],['_trackPageview']];
      (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
      g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
      s.parentNode.insertBefore(g,s)}(document,'script'));
    </script>
    
    <script type="text/javascript">
      hljs.initHighlightingOnLoad();
      $(".article img").addClass( "img-responsive");
      $("iframe").map( function(e) {
        $(this).css( "max-width", $(this).width() );
        $(this).width( "100%" );
      });
      var _gaq=[['_setAccount','UA-56296045-1'],['_trackPageview']];
      (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
      g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
      s.parentNode.insertBefore(g,s)}(document,'script'));
      var disqus_shortname = 'willschenk';
      var disqus_url = 'http://willschenk.com/building-a-gui-for-managing-middleman-blogs/';
        var disqus_identifier = '2015-07-30-building-a-gui-for-managing-middleman-blogs.html';
            
      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
      (function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
    </script>
  </body>
</html>
