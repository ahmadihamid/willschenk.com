<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Blank Page Tech</title>
  <subtitle>Lets build things</subtitle>
  <id>http://willschenk.com/</id>
  <link href="http://willschenk.com/"/>
  <link href="http://willschenk.com/feed.xml" rel="self"/>
  <updated>2015-07-25T12:15:16-04:00</updated>
  <author>
    <name>Will Schenk</name>
  </author>
  <entry>
    <title>Bower with Rails</title>
    <link rel="alternate" href="http://willschenk.com/bower-with-rails/"/>
    <id>http://willschenk.com/bower-with-rails/</id>
    <published>2015-07-24T22:01:00-04:00</published>
    <updated>2015-07-24T22:01:00-04:00</updated>
    <author>
      <name>Will Schenk</name>
    </author>
    <content type="html">&lt;p&gt;Let&amp;#39;s look at how we can integrate bower with rails and Sprockets. &lt;a href="http://bower.io"&gt;Bower&lt;/a&gt; is one of the two major javascript package managers, the other being the Node Package Manager, or &lt;a href="https://www.npmjs.com"&gt;npm&lt;/a&gt;.  The biggest difference between the two is how the javascript is packaged up.  Bower is the more straightforward of the two, and it mainly a way to distribute javascript and keep things up to date.&lt;/p&gt;

&lt;h2 id="install-bower"&gt;Install Bower&lt;/h2&gt;

&lt;p&gt;The first step is to install bower.  Ironically, we need to use npm to do that!  On OSX, the easiest way is to use the &lt;a href="http://brew.sh"&gt;Homebrew&lt;/a&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class="sh"&gt;$ brew install node
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Then let&amp;#39;s install bower in your local command path so you can run it.&lt;/p&gt;

&lt;pre&gt;&lt;code class="sh"&gt;$ npm install -g bower
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id="setup-bower"&gt;Setup Bower&lt;/h2&gt;

&lt;p&gt;Now let&amp;#39;s setup rails to work with bower.  This section assumes that you already have a rails application.&lt;/p&gt;

&lt;pre&gt;&lt;code class="sh"&gt;cd rails_application
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Create a &lt;code&gt;.bowerrc&lt;/code&gt; file. This is going to tell bower where to install the packages it needs, and we&amp;#39;re going to say put it in &lt;code&gt;vendor/assets/bower_components&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class="json"&gt;{
  &amp;quot;directory&amp;quot;: &amp;quot;vendor/assets/bower_components&amp;quot;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Now run &lt;code&gt;bower init&lt;/code&gt; to create a &lt;code&gt;bower.json&lt;/code&gt; file.  This file is similar to a &lt;code&gt;Gemfile&lt;/code&gt;, in that it lists out the dependancies, and when you run bower again, it will download the specific versions from the intertubes.&lt;/p&gt;

&lt;h2 id="tell-rails-where-to-look"&gt;Tell rails where to look&lt;/h2&gt;

&lt;p&gt;Inside of &lt;code&gt;config/application.rb&lt;/code&gt; we&amp;#39;re going to tell spockets and additional directory to look for javascript components.&lt;/p&gt;

&lt;pre&gt;&lt;code class="rb"&gt;config.assets.paths &amp;lt;&amp;lt; Rails.root.join(&amp;#39;vendor&amp;#39;, &amp;#39;assets&amp;#39;, &amp;#39;bower_components&amp;#39;)
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id="small-walk-through"&gt;Small walk through&lt;/h2&gt;

&lt;p&gt;Let&amp;#39;s say you want to use Google Maps with Angular.  &lt;a href="http://angular-ui.github.io/angular-google-maps/#!/"&gt;angular-google-maps&lt;/a&gt; is a package that does a lot of the heavy lifting for you, so lets install that.  We&amp;#39;re going to tell bower to keep track of the packages we want inside of our &lt;code&gt;bower.json&lt;/code&gt; file by passing in the &lt;code&gt;--save&lt;/code&gt; option:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ bower install --save angular-google-maps
[...]
angular-google-maps#2.1.5 vendor/assets/bower_components/angular-google-maps
├── angular#1.4.3
└── lodash#3.10.0

lodash#3.10.0 vendor/assets/bower_components/lodash

angular#1.4.3 vendor/assets/bower_components/angular
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;I&amp;#39;ve cleaned up some of the output, but you can see that bower installed angular-google-maps and it&amp;#39;s dependancies, angular itself and lodash.  Lets go to our &lt;code&gt;application.js&lt;/code&gt; file now to tell Sprockets that we want to use this awesome stuff:&lt;/p&gt;

&lt;pre&gt;&lt;code class="js"&gt;//= require lodash
//= require angular
//= require angular-google-maps
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Since we&amp;#39;ve added &lt;code&gt;vendor/assets/bower_components&lt;/code&gt; in Sprockets load path, it should be able to find all of these files.  Notice that you don&amp;#39;t need to know where to get all of the dependancies from, but you do need to make sure that you specify them in your &lt;code&gt;application.js&lt;/code&gt; in the right order.  We&amp;#39;ll be talking about &lt;code&gt;browersify&lt;/code&gt; in future posts that assuages this issue.&lt;/p&gt;

&lt;h2 id="to-check-in-or-not-to-check-in"&gt;To check in or not to check in&lt;/h2&gt;

&lt;p&gt;I prefer to check in the dependancies inside of my source control.  This isn&amp;#39;t necessary and in some ways is a waste of disk space, but I think it&amp;#39;s easier to figure out what&amp;#39;s going on if there&amp;#39;s less magic.  This can be confusion if you start to make local tweaks of the javascript, which you should never do.&lt;/p&gt;

&lt;p&gt;However, it&amp;#39;s not necessary to check things in if you expand your build process a bit.  If you look inside of your &lt;code&gt;bower.json&lt;/code&gt; file, you&amp;#39;ll see that it specifies the specific version of the bower package that you installed.&lt;/p&gt;

&lt;pre&gt;&lt;code class="js"&gt;{
  &amp;quot;name&amp;quot;: &amp;quot;rails_app&amp;quot;,
  &amp;quot;version&amp;quot;: &amp;quot;0.0.0&amp;quot;,
  &amp;quot;authors&amp;quot;: [
    &amp;quot;Will Schenk &amp;lt;wschenk@gmail.com&amp;gt;&amp;quot;
  ],
  &amp;quot;license&amp;quot;: &amp;quot;MIT&amp;quot;,
  &amp;quot;ignore&amp;quot;: [
    &amp;quot;**/.*&amp;quot;,
    &amp;quot;node_modules&amp;quot;,
    &amp;quot;bower_components&amp;quot;,
    &amp;quot;test&amp;quot;,
    &amp;quot;tests&amp;quot;
  ],
  &amp;quot;dependencies&amp;quot;: {
    &amp;quot;angular-google-maps&amp;quot;: &amp;quot;~2.1.5&amp;quot;
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;This should contain all the information needed so that when you run &lt;code&gt;bower install&lt;/code&gt; again, all of the correct versions of the files will be downloaded.  You could make it part of your build process, much like how running &lt;code&gt;bundle install&lt;/code&gt; is part of the standard rails build pack.  Bundler looks through &lt;code&gt;Gemfile.lock&lt;/code&gt; and installs those specific packages.  The version is always specified inside of &lt;code&gt;bower.json&lt;/code&gt; so there doesn&amp;#39;t need to be two files.&lt;/p&gt;
</content>
  </entry>
  <entry>
    <title>Adding search to a middleman blog</title>
    <link rel="alternate" href="http://willschenk.com/adding-search-to-a-middleman-blog/"/>
    <id>http://willschenk.com/adding-search-to-a-middleman-blog/</id>
    <published>2015-06-07T10:09:00-04:00</published>
    <updated>2015-06-07T10:09:00-04:00</updated>
    <author>
      <name>Will Schenk</name>
    </author>
    <content type="html">&lt;p&gt;We&amp;#39;re going to build a simple, niave search for middleman blogs.  We&amp;#39;re going to build a &lt;em&gt;search index&lt;/em&gt; at build time, and then use that index to perform the search itself on the client side.&lt;/p&gt;

&lt;h2 id="building-the-index"&gt;Building the index&lt;/h2&gt;

&lt;p&gt;When you typed in something in google, it doesn&amp;#39;t then go and hit every page on the internet to check to see if there&amp;#39;s a match.  It doesn&amp;#39;t even look at every page that it has squirreled away somewhere in the googleplex.  What it consults is an &lt;em&gt;index&lt;/em&gt; of the documents out there, and the index points to the page information.  (We all know that it&amp;#39;s a lot more complicated than that really, but run with it.)&lt;/p&gt;

&lt;p&gt;First thing we&amp;#39;re going to do is create a very simple version of this index for your site.  This is going to be in a file called &lt;code&gt;source/article.index.json.erb&lt;/code&gt;.&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;Go through all of the articles.&lt;/li&gt;
&lt;li&gt;Add meta data for the article into the master map.&lt;/li&gt;
&lt;li&gt;Find all of the words in the article, by stripping out all of the html tags, making things lowercase, and breaking it apart by white space.&lt;/li&gt;
&lt;li&gt;Insert all of those words into our index.&lt;/li&gt;
&lt;li&gt;Convert the whole sucker to JSON.&lt;/li&gt;
&lt;/ol&gt;

&lt;pre&gt;&lt;code class="erb"&gt;&amp;lt;%
  map = {articles:{}}
  index = {}
  blog.articles.each do |article|
    map[:articles][article.url] = {
      title: article.title, 
      date: article.date, 
      tags: article.tags 
    }

    words = &amp;quot;#{article.title} #{article.body}&amp;quot;
    words = words
      .downcase              # make lowercase
      .gsub( /&amp;lt;.*?&amp;gt;/, &amp;quot;&amp;quot; )   # get rid of tags
      .gsub( /[^\w ]/, &amp;quot;&amp;quot; )  # get rid of not letters
      .split( /\s+/ )        # split by words
      .sort.uniq

    words.each do |w|
      index[w] ||= []
      index[w] &amp;lt;&amp;lt; article.url
    end
  end
  map[:index] = index
%&amp;gt;
&amp;lt;%= map.to_json %&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id="now-lets-add-some-markup-to-the-blog"&gt;Now lets add some markup to the blog&lt;/h2&gt;

&lt;p&gt;I&amp;#39;m sticking this in the header, as you see above:&lt;/p&gt;

&lt;pre&gt;&lt;code class="haml"&gt;%form.navbar-form.navbar-right#search{ role: &amp;quot;search&amp;quot; }
  .form-group.dropdown
    .input-group
      %input.form-control#search_box{ type: &amp;quot;text&amp;quot;, placeholder: &amp;quot;Search&amp;quot;, autocomplete: &amp;quot;off&amp;quot; }
      %span.input-group-btn
        %button.btn.btn-default
          %span.glyphicon.glyphicon-search
    %ul.dropdown-menu.dropdown-menu-left.results
      = link_to &amp;quot;Title&amp;quot;, &amp;quot;/url&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id="loading-and-querying-the-index"&gt;Loading and Querying the index&lt;/h2&gt;

&lt;p&gt;Ok, lets build this from the ground up.  All this goes into &lt;code&gt;application.js&lt;/code&gt;.First we&amp;#39;re create a method that loads up the index if we need it.  We&amp;#39;re going to use a promise here, so if multiple request come in at the same time only one will go to the server:&lt;/p&gt;

&lt;pre&gt;&lt;code class="js"&gt;var article_index = function() {
  if( window.article_promise === undefined ) {
    console.log( &amp;quot;Loading article index&amp;quot; );
    window.article_promise = $.Deferred();

    $.get( &amp;quot;/articles.index.json&amp;quot; ).done( function(data) {
      console.log( &amp;quot;Loaded article index&amp;quot; );
      window.article_promise.resolve( data );
    } );
  }

  return window.article_promise;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;This is called like &lt;code&gt;article_index().done( function( index ) { console.log( index )})&lt;/code&gt;  The second time it calls, it returns the first promise again so everything is nice and fast.&lt;/p&gt;

&lt;p&gt;To query the index itself we need to look through all of the words and return a list of urls that match:&lt;/p&gt;

&lt;pre&gt;&lt;code class="js"&gt;var match_index = function( word, index ) {
  var result = [];
  var matcher = new RegExp( word );

  $.each( index.index, function( i ) {
    if( matcher.exec( i ) ) {
      $.each( index.index[i], function( idx, url ) {
        if( result.indexOf( url ) &amp;lt; 0 ) {
          result.push( url );
        }
      } );
    }
  });

  return result;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Now lets build a simple search.  This is a little complicated, since we need to compute the intersection of the results if the user types in multiple words.  Here&amp;#39;s what&amp;#39;s happening:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;We create a promise, since we may need wait for the index to load.&lt;/li&gt;
&lt;li&gt;We split the search term into multiple words.&lt;/li&gt;
&lt;li&gt;Collect the results of the &lt;code&gt;match_index&lt;/code&gt; function.&lt;/li&gt;
&lt;li&gt;Compute the intersections of all the results&lt;/li&gt;
&lt;li&gt;Look up the meta data based on the url.&lt;/li&gt;
&lt;li&gt;Resolve the promise with the results.&lt;/li&gt;
&lt;/ol&gt;

&lt;pre&gt;&lt;code class="js"&gt;var find_article = function( search ) {
  var search_results = $.Deferred();

  article_index().done( function( index ) {
    // Split the search by widespace
    var words = search.toLowerCase().replace(/\s+$/, &amp;#39;&amp;#39;).split( /\s+/ );

    // Lookup the matches for each word
    // Note using $.map seems to flatten the result.
    var full_results = [];
    $.each( words, function( i, word ) {
      full_results.push( match_index( word, index ) );
    } );

    var urls = full_results[0];

    // If there are multiple words, compute the intersection
    if( full_results.length &amp;gt; 1 ) {
      var url_counts = {}
      $.each( full_results, function( i, set ) {
        $.each( set, function( i, url ) {
          url_counts[url] = (url_counts[url]||0)+1;
        } )
      } );

      urls = [];
      $.each( url_counts, function( url, count ) {
        if( count == full_results.length ) {
          urls.push( url );
        }
      } );
    }

    // Pull in the metadata
    var results = {};
    $.each( urls, function( i, url ) {
      results[url] = index.articles[url];
    } );

    search_results.resolve( results );
  });

  return search_results;
};
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id="wiring-it-up"&gt;Wiring it up&lt;/h2&gt;

&lt;p&gt;First we need to call our code when the user inputs something in the text area:&lt;/p&gt;

&lt;pre&gt;&lt;code class="js"&gt;$(function() {
  $( &amp;quot;#search_box&amp;quot; ).on( &amp;#39;input&amp;#39;, search_typing );
});
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Then we wire everything together:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;If the field is empty, hide the dropdown.&lt;/li&gt;
&lt;li&gt;Otherwise show the dropdown and a loading message&lt;/li&gt;
&lt;li&gt;Call &lt;code&gt;find_article&lt;/code&gt; and when it returns&lt;/li&gt;
&lt;li&gt;Put the results in the result dropdown.&lt;/li&gt;
&lt;/ol&gt;

&lt;pre&gt;&lt;code class="js"&gt;var search_typing = function() {
  var val = $(this).val();

  if( val == &amp;quot;&amp;quot; ) {
    $(&amp;quot;#search .dropdown&amp;quot;).removeClass( &amp;quot;open&amp;quot; );
  } else {
    $(&amp;quot;#search .dropdown&amp;quot;).addClass( &amp;quot;open&amp;quot; );
    $(&amp;quot;#search .dropdown-menu&amp;quot;).html(&amp;quot;&amp;lt;li class=&amp;#39;disabled&amp;#39;&amp;gt;&amp;lt;a href=&amp;#39;#&amp;#39;&amp;gt;Loading &amp;quot; + val +&amp;quot;&amp;lt;/a&amp;gt;&amp;lt;/li&amp;gt;&amp;quot;)
    find_article( val ).done( function(results) {
      var menu = $(&amp;quot;#search .dropdown-menu&amp;quot;).html(&amp;quot;&amp;quot;);
      if( $.isEmptyObject( results ) ) {
        $(&amp;quot;#search .dropdown-menu&amp;quot;).html(&amp;quot;&amp;lt;li class=&amp;#39;disabled&amp;#39;&amp;gt;&amp;lt;a href=&amp;#39;#&amp;#39;&amp;gt;No results for: &amp;quot; + val +&amp;quot;&amp;lt;/a&amp;gt;&amp;lt;/li&amp;gt;&amp;quot;)
      }
      $.each( results, function( url, info ) {
        menu.append( &amp;quot;&amp;lt;li&amp;gt;&amp;lt;a href=\&amp;quot;&amp;quot; + url + &amp;quot;\&amp;quot;&amp;gt;&amp;quot; + info.title + &amp;quot;&amp;lt;/a&amp;gt;&amp;lt;/li&amp;gt;&amp;quot;);
      });
    });
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id="next-steps"&gt;Next steps&lt;/h2&gt;

&lt;ol&gt;
&lt;li&gt;Language stemming&lt;/li&gt;
&lt;li&gt;Logical operations&lt;/li&gt;
&lt;li&gt;Showing more metadata in the search results.&lt;/li&gt;
&lt;/ol&gt;
</content>
  </entry>
  <entry>
    <title>OSX Script for Kiosk Mode</title>
    <link rel="alternate" href="http://willschenk.com/osx-script-for-kiosk-mode/"/>
    <id>http://willschenk.com/osx-script-for-kiosk-mode/</id>
    <published>2015-05-20T10:21:00-04:00</published>
    <updated>2015-05-20T10:21:00-04:00</updated>
    <author>
      <name>Will Schenk</name>
    </author>
    <content type="html">&lt;p&gt;In the office, we run &lt;a href="http://jenkins-ci.org"&gt;Jenkins&lt;/a&gt; on the same machine that we run &lt;a href="http://gaze.happyfuncorp.com"&gt;Benevolent Gaze&lt;/a&gt;.  During iOS builds, the iOS simulator will take over the screen for the build, and then leave the beautiful screen on the desktop, hiding our smiling faces.  We want to return to Safari in this case, but we also want to make sure that if someone is actually in front of the machine it will let them do their thing.&lt;/p&gt;

&lt;p&gt;Here&amp;#39;s a little script that check if the user hasn&amp;#39;t touched the keyboard or mouse in a while, and if so it will pull Safari to the front.&lt;/p&gt;

&lt;pre&gt;&lt;code class="bash"&gt;#!/bin/bash
while true
do
  IDLE=$(ioreg -c IOHIDSystem |awk &amp;#39;/HIDIdle/ {print int($(NF)/1000000000 + 0.5)}&amp;#39;| sort -n |head -1)
  echo Idle $IDLE seconds

  if [ $IDLE -gt 30 ]
  then
    cat &amp;lt;&amp;lt;- EOF | osascript
      tell application &amp;quot;Safari&amp;quot;
        activate
      end tell
    EOF
  fi
  sleep 1
done
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The first thing that this does is to call the &lt;code&gt;ioreg&lt;/code&gt; command to pull data from the &lt;code&gt;IOHIDSystem&lt;/code&gt;.  This is what OSX uses to track &lt;em&gt;inactivity&lt;/em&gt;, which is used to start powering things down to conserve battery life.  The units of this measurement are &lt;em&gt;small&lt;/em&gt;, so we divide by &lt;code&gt;1000000000&lt;/code&gt; to get them into seconds.  We round that number to the nearest integer by adding &lt;code&gt;0.5&lt;/code&gt; and lopping off the right of the decimal place with &lt;code&gt;int&lt;/code&gt;.  Then we get the shortest number in the list using &lt;code&gt;sort | head&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;This script waits &lt;code&gt;30&lt;/code&gt; seconds (&lt;code&gt;if [ $IDLE -gt 30 ]&lt;/code&gt;) and then will run &lt;code&gt;osascript&lt;/code&gt; to activate Safari.  The here-doc between &lt;code&gt;EOF&lt;/code&gt; is AppleScript which will activate &lt;em&gt;Safari&lt;/em&gt; and bring it to the front.  Replace that with &lt;em&gt;Google Chrome&lt;/em&gt; if that&amp;#39;s your preferred browser.&lt;/p&gt;
</content>
  </entry>
  <entry>
    <title>Slow data and Fast Sites</title>
    <link rel="alternate" href="http://willschenk.com/slow-data-and-fast-sites/"/>
    <id>http://willschenk.com/slow-data-and-fast-sites/</id>
    <published>2015-05-07T20:00:00-04:00</published>
    <updated>2015-05-07T20:00:00-04:00</updated>
    <author>
      <name>Will Schenk</name>
    </author>
    <content type="html">&lt;p&gt;This article walks through the motivations driving and benefits of using a the Seed Architecture for building performant websites using Middleman, React, and a seperate API server such as Parse.  The benefits are:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;You get full SEO with a heavy client JavaScript site without having to do crazy things with PhantomJS or meta fragments.&lt;/li&gt;
&lt;li&gt;Hosting and operations become both cheap and doesn&amp;#39;t require a support team.&lt;/li&gt;
&lt;li&gt;Scaling out the system is mainly a bandwidth problem, and secondarily a API scaling problem for a subset of behavior.&lt;/li&gt;
&lt;li&gt;The system breaks gracefully. If you overwhelm the API server the site is still available for browsing.  Assuming that most usage of the sites are reads, this means that if you try to &lt;em&gt;break the internet&lt;/em&gt; with &lt;a href="http://www.papermag.com/2014/11/kim_kardashian.php"&gt;Kim Kardashian&amp;#39;s ass&lt;/a&gt; maybe user login will slow down, but everything else is still available.&lt;/li&gt;
&lt;li&gt;You are able to build your front end using modern and clean fancy JavaScript technologies and don&amp;#39;t need to mess around with back-end coding.&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id="motivation"&gt;Motivation&lt;/h2&gt;

&lt;p&gt;Sometimes I feel bad for what we make servers do.  I will occasionally get a cringing feeling because we&amp;#39;re just not being very nice to the fancy machines around us.  It&amp;#39;s similar to being in the car with someone who is learning how to drive a standard transmission and they grind the gears lurching the car into a stall.  Ahhh!&lt;/p&gt;

&lt;p&gt;I especially get this feeling when trying to make poorly built websites scale, e.g.  wordpress sites that jam up the server when the slightest breeze of traffic wafts in, or Rails sites that are slamming the database with N+1 unindexed queries of largely static data.  I really enjoyed the &lt;a href="https://medium.com/message/how-paper-magazines-web-engineers-scaled-kim-kardashians-back-end-sfw-6367f8d37688"&gt;backstory to the back-end&lt;/a&gt;, but surely there has to be a better way to do this.&lt;/p&gt;

&lt;p&gt;The reality is the computer is mostly doing the same exact thing, over and over again.  For a lot of sites, there are only a few parts of the page that change based upon who is looking or when they are looking at it, and the bulk of what everyone seems is the same same same.  The computer doesn&amp;#39;t complain about it but silently and stoically gets crushed under the load.  But we can fix it.  If we can break down the data on the page into different categories based upon its rate of change the bulk of the processing can happen at &amp;quot;compile&amp;quot; or &amp;quot;build&amp;quot; time, while only a small part of it needs to happen at run-time.  And when a wave of people come in the servers are fully prepared to serve them up what they need.&lt;/p&gt;

&lt;p&gt;There is so much computer power available both in desktop browsers and mobile browsers, and we should use it.  If we can find a way to precompute the repetitive stuff and push the computing of the dynamic stuff out to the edges, we vastly lower the load on the servers which simplifies operations and scaling.  There are some challenges with doing this; how to deal with SEO, increasing the &amp;quot;build&amp;quot; frequency to handle the &amp;quot;slow data&amp;quot; updates, and how to make it easy to do front-end development.  We&amp;#39;ll go through a strategy below to address those challenges.&lt;/p&gt;

&lt;p&gt;At the end of this meandering article we are going to have a way to build super scalable sites that give you SEO and full client side interactivity without having any servers (or at least only a small cheap one) which will nevertheless be able to scale to huge amounts of traffic cheaply.&lt;/p&gt;

&lt;h2 id="the-outline"&gt;The Outline&lt;/h2&gt;

&lt;p&gt;Let&amp;#39;s take a step back from how we normally build websites, and see what we can we do better based upon the challenges and current reality of operating sites:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;The first insight is that once your site is built and running, things change at a different rate than they do in development.  The difference between tooling and run-time evaluation becomes more pronounced, and usage patterns of the data become clearly statified.  Even though we dump everything into the database, there are distinct classes of data that have different change patterns.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;The second insight is websites are about sitemaps, not about URLs.  SEO thinks in terms of Sitemaps, and webapps thinks in terms of Routes, but if we could get the best of both worlds if we had a static build process that can pull data from a datastore and understands the concepts of a Sitemap and a Router.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;The third insight is that we need a templating language that can run equally well on the server and the client in order to keep developers sane and effective.  The bulk of the application needs to be written using the same tooling.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;The fourth insight is that web services don&amp;#39;t need to be hidden behind the server, and with rich client apps we can consume them directly from the client.&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;I&amp;#39;ll walk through these in turn, deconstructing what they mean, and outline a way of building a prerendered website that will let you add all the fancy front-end features and full SEO support - all of the benefits of so-called database backed web-sites with content management systems and complex logic - that will be able to scale up quickly without any ops support, and be able to degrade gracefully under spikes.&lt;/p&gt;

&lt;h2 id="data-changes-at-different-rates"&gt;Data changes at different rates&lt;/h2&gt;

&lt;p&gt;Lets take 4 classes of sites that we all build regularly:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Marketing Sites&lt;/strong&gt;, which after they launch rarely change, but may have a form that&amp;#39;s the beginning of a sales or conversion funnel.  &lt;em&gt;e.g. Mobile App landing pages, like &lt;a href="http://getpyne.com"&gt;getpyne.com&lt;/a&gt;&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Publishing Sites&lt;/strong&gt;, which change when new content is created, comments get posted, or with changes in a list of most emailed or most read articles.  Blogs, magazines and newspapers fit in here, though they have different user types and publishing schedules. &lt;em&gt;e.g. Newspapers, like &lt;a href="http://nytimes.com"&gt;nytimes.com&lt;/a&gt;&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Ecommerce Sites&lt;/strong&gt;, which change when the product catalog gets updated, orders are placed, inventory changes, cross and up sells are calculated, and people add things to their cart. &lt;em&gt;e.g. &lt;a href="http://teepublic.com"&gt;teepublic.com&lt;/a&gt;&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Social Sites&lt;/strong&gt;, which you only can access as a user, who your connections are, what gets added by other users, how you interact with that content, and any real time messaging between them. &lt;em&gt;e.g. &lt;a href="http://instagram.com"&gt;instagram.com&lt;/a&gt;&lt;/em&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;em&gt;If the word social bothers you, just replace it with &amp;quot;all views are customized to the user and you need to log in to see anything&amp;quot;.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Let&amp;#39;s look at the rate of change of the different types of data on these sites:&lt;/p&gt;

&lt;p&gt;&lt;svg width="538pt" height="476pt" viewBox="0.00 0.00 537.54 476.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"&gt;&lt;g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 472)"&gt;&lt;title&gt;Dataflow&lt;/title&gt;&lt;polygon fill="white" stroke="none" points="-4,4 -4,-472 533.538,-472 533.538,4 -4,4"/&gt;&amp;lt;!-- Header --&amp;gt;&lt;g id="node1" class="node"&gt;&lt;title&gt;Header&lt;/title&gt;&lt;text text-anchor="middle" x="65.5415" y="-445.8" font-family="Times,serif" font-size="14.00"&gt;Timeline&lt;/text&gt;&lt;/g&gt;&amp;lt;!-- Release --&amp;gt;&lt;g id="node2" class="node"&gt;&lt;title&gt;Release&lt;/title&gt;&lt;text text-anchor="middle" x="65.5415" y="-373.8" font-family="Times,serif" font-size="14.00"&gt;Release&lt;/text&gt;&lt;/g&gt;&amp;lt;!-- Header&amp;#45;&amp;gt;Release --&amp;gt;&amp;lt;!-- Slow Data --&amp;gt;&lt;g id="node3" class="node"&gt;&lt;title&gt;Slow Data&lt;/title&gt;&lt;text text-anchor="middle" x="65.5415" y="-301.8" font-family="Times,serif" font-size="14.00"&gt;Slow Data&lt;/text&gt;&lt;/g&gt;&amp;lt;!-- Release&amp;#45;&amp;gt;Slow Data --&amp;gt;&lt;g id="edge1" class="edge"&gt;&lt;title&gt;Release&amp;#45;&amp;gt;Slow Data&lt;/title&gt;&lt;path fill="none" stroke="black" d="M65.5415,-359.697C65.5415,-351.983 65.5415,-342.712 65.5415,-334.112"/&gt;&lt;polygon fill="black" stroke="black" points="69.0416,-334.104 65.5415,-324.104 62.0416,-334.104 69.0416,-334.104"/&gt;&lt;/g&gt;&amp;lt;!-- Medium Speed Data --&amp;gt;&lt;g id="node4" class="node"&gt;&lt;title&gt;Medium Speed Data&lt;/title&gt;&lt;text text-anchor="middle" x="65.5415" y="-229.8" font-family="Times,serif" font-size="14.00"&gt;Medium Speed Data&lt;/text&gt;&lt;/g&gt;&amp;lt;!-- Slow Data&amp;#45;&amp;gt;Medium Speed Data --&amp;gt;&lt;g id="edge2" class="edge"&gt;&lt;title&gt;Slow Data&amp;#45;&amp;gt;Medium Speed Data&lt;/title&gt;&lt;path fill="none" stroke="black" d="M65.5415,-287.697C65.5415,-279.983 65.5415,-270.712 65.5415,-262.112"/&gt;&lt;polygon fill="black" stroke="black" points="69.0416,-262.104 65.5415,-252.104 62.0416,-262.104 69.0416,-262.104"/&gt;&lt;/g&gt;&amp;lt;!-- Fast Data --&amp;gt;&lt;g id="node5" class="node"&gt;&lt;title&gt;Fast Data&lt;/title&gt;&lt;text text-anchor="middle" x="65.5415" y="-157.8" font-family="Times,serif" font-size="14.00"&gt;Fast Data&lt;/text&gt;&lt;/g&gt;&amp;lt;!-- Medium Speed Data&amp;#45;&amp;gt;Fast Data --&amp;gt;&lt;g id="edge3" class="edge"&gt;&lt;title&gt;Medium Speed Data&amp;#45;&amp;gt;Fast Data&lt;/title&gt;&lt;path fill="none" stroke="black" d="M65.5415,-215.697C65.5415,-207.983 65.5415,-198.712 65.5415,-190.112"/&gt;&lt;polygon fill="black" stroke="black" points="69.0416,-190.104 65.5415,-180.104 62.0416,-190.104 69.0416,-190.104"/&gt;&lt;/g&gt;&amp;lt;!-- Ephemera --&amp;gt;&lt;g id="node6" class="node"&gt;&lt;title&gt;Ephemera&lt;/title&gt;&lt;text text-anchor="middle" x="65.5415" y="-85.8" font-family="Times,serif" font-size="14.00"&gt;Ephemera&lt;/text&gt;&lt;/g&gt;&amp;lt;!-- Fast Data&amp;#45;&amp;gt;Ephemera --&amp;gt;&lt;g id="edge4" class="edge"&gt;&lt;title&gt;Fast Data&amp;#45;&amp;gt;Ephemera&lt;/title&gt;&lt;path fill="none" stroke="black" d="M65.5415,-143.697C65.5415,-135.983 65.5415,-126.712 65.5415,-118.112"/&gt;&lt;polygon fill="black" stroke="black" points="69.0416,-118.104 65.5415,-108.104 62.0416,-118.104 69.0416,-118.104"/&gt;&lt;/g&gt;&amp;lt;!-- Session Data --&amp;gt;&lt;g id="node7" class="node"&gt;&lt;title&gt;Session Data&lt;/title&gt;&lt;text text-anchor="middle" x="65.5415" y="-13.8" font-family="Times,serif" font-size="14.00"&gt;Session Data&lt;/text&gt;&lt;/g&gt;&amp;lt;!-- Ephemera&amp;#45;&amp;gt;Session Data --&amp;gt;&lt;g id="edge5" class="edge"&gt;&lt;title&gt;Ephemera&amp;#45;&amp;gt;Session Data&lt;/title&gt;&lt;path fill="none" stroke="black" d="M65.5415,-71.6966C65.5415,-63.9827 65.5415,-54.7125 65.5415,-46.1124"/&gt;&lt;polygon fill="black" stroke="black" points="69.0416,-46.1043 65.5415,-36.1043 62.0416,-46.1044 69.0416,-46.1043"/&gt;&lt;/g&gt;&amp;lt;!-- MHeader --&amp;gt;&lt;g id="node8" class="node"&gt;&lt;title&gt;MHeader&lt;/title&gt;&lt;text text-anchor="middle" x="159.542" y="-445.8" font-family="Times,serif" font-size="14.00"&gt;Marketing&lt;/text&gt;&lt;/g&gt;&amp;lt;!-- MData --&amp;gt;&lt;g id="node12" class="node"&gt;&lt;title&gt;MData&lt;/title&gt;&lt;polygon fill="lightgrey" stroke="black" points="201.022,-396 118.061,-396 118.061,-360 201.022,-360 201.022,-396"/&gt;&lt;text text-anchor="middle" x="159.542" y="-373.8" font-family="Times,serif" font-size="14.00"&gt;Data Model&lt;/text&gt;&lt;/g&gt;&amp;lt;!-- MHeader&amp;#45;&amp;gt;MData --&amp;gt;&amp;lt;!-- PHeader --&amp;gt;&lt;g id="node9" class="node"&gt;&lt;title&gt;PHeader&lt;/title&gt;&lt;text text-anchor="middle" x="259.542" y="-445.8" font-family="Times,serif" font-size="14.00"&gt;Publishing&lt;/text&gt;&lt;/g&gt;&amp;lt;!-- PData --&amp;gt;&lt;g id="node13" class="node"&gt;&lt;title&gt;PData&lt;/title&gt;&lt;polygon fill="lightgrey" stroke="black" points="301.022,-396 218.061,-396 218.061,-360 301.022,-360 301.022,-396"/&gt;&lt;text text-anchor="middle" x="259.542" y="-373.8" font-family="Times,serif" font-size="14.00"&gt;Data Model&lt;/text&gt;&lt;/g&gt;&amp;lt;!-- PHeader&amp;#45;&amp;gt;PData --&amp;gt;&amp;lt;!-- EHeader --&amp;gt;&lt;g id="node10" class="node"&gt;&lt;title&gt;EHeader&lt;/title&gt;&lt;text text-anchor="middle" x="375.542" y="-445.8" font-family="Times,serif" font-size="14.00"&gt;Commerce&lt;/text&gt;&lt;/g&gt;&amp;lt;!-- EData --&amp;gt;&lt;g id="node14" class="node"&gt;&lt;title&gt;EData&lt;/title&gt;&lt;polygon fill="lightgrey" stroke="black" points="417.022,-396 334.061,-396 334.061,-360 417.022,-360 417.022,-396"/&gt;&lt;text text-anchor="middle" x="375.542" y="-373.8" font-family="Times,serif" font-size="14.00"&gt;Data Model&lt;/text&gt;&lt;/g&gt;&amp;lt;!-- EHeader&amp;#45;&amp;gt;EData --&amp;gt;&amp;lt;!-- SHeader --&amp;gt;&lt;g id="node11" class="node"&gt;&lt;title&gt;SHeader&lt;/title&gt;&lt;text text-anchor="middle" x="486.542" y="-445.8" font-family="Times,serif" font-size="14.00"&gt;Social&lt;/text&gt;&lt;/g&gt;&amp;lt;!-- SData --&amp;gt;&lt;g id="node15" class="node"&gt;&lt;title&gt;SData&lt;/title&gt;&lt;polygon fill="lightgrey" stroke="black" points="528.022,-396 445.061,-396 445.061,-360 528.022,-360 528.022,-396"/&gt;&lt;text text-anchor="middle" x="486.542" y="-373.8" font-family="Times,serif" font-size="14.00"&gt;Data Model&lt;/text&gt;&lt;/g&gt;&amp;lt;!-- SHeader&amp;#45;&amp;gt;SData --&amp;gt;&amp;lt;!-- MPages --&amp;gt;&lt;g id="node16" class="node"&gt;&lt;title&gt;MPages&lt;/title&gt;&lt;polygon fill="lightgrey" stroke="black" points="186.542,-324 132.542,-324 132.542,-288 186.542,-288 186.542,-324"/&gt;&lt;text text-anchor="middle" x="159.542" y="-301.8" font-family="Times,serif" font-size="14.00"&gt;Pages&lt;/text&gt;&lt;/g&gt;&amp;lt;!-- MData&amp;#45;&amp;gt;MPages --&amp;gt;&lt;g id="edge11" class="edge"&gt;&lt;title&gt;MData&amp;#45;&amp;gt;MPages&lt;/title&gt;&lt;path fill="none" stroke="black" d="M159.542,-359.697C159.542,-351.983 159.542,-342.712 159.542,-334.112"/&gt;&lt;polygon fill="black" stroke="black" points="163.042,-334.104 159.542,-324.104 156.042,-334.104 163.042,-334.104"/&gt;&lt;/g&gt;&amp;lt;!-- PArticles --&amp;gt;&lt;g id="node17" class="node"&gt;&lt;title&gt;PArticles&lt;/title&gt;&lt;polygon fill="lightgrey" stroke="black" points="289.86,-324 229.223,-324 229.223,-288 289.86,-288 289.86,-324"/&gt;&lt;text text-anchor="middle" x="259.542" y="-301.8" font-family="Times,serif" font-size="14.00"&gt;Articles&lt;/text&gt;&lt;/g&gt;&amp;lt;!-- PData&amp;#45;&amp;gt;PArticles --&amp;gt;&lt;g id="edge13" class="edge"&gt;&lt;title&gt;PData&amp;#45;&amp;gt;PArticles&lt;/title&gt;&lt;path fill="none" stroke="black" d="M259.542,-359.697C259.542,-351.983 259.542,-342.712 259.542,-334.112"/&gt;&lt;polygon fill="black" stroke="black" points="263.042,-334.104 259.542,-324.104 256.042,-334.104 263.042,-334.104"/&gt;&lt;/g&gt;&amp;lt;!-- ECatalog --&amp;gt;&lt;g id="node18" class="node"&gt;&lt;title&gt;ECatalog&lt;/title&gt;&lt;polygon fill="lightgrey" stroke="black" points="428.639,-324 322.444,-324 322.444,-288 428.639,-288 428.639,-324"/&gt;&lt;text text-anchor="middle" x="375.542" y="-301.8" font-family="Times,serif" font-size="14.00"&gt;Product Catalog&lt;/text&gt;&lt;/g&gt;&amp;lt;!-- EData&amp;#45;&amp;gt;ECatalog --&amp;gt;&lt;g id="edge17" class="edge"&gt;&lt;title&gt;EData&amp;#45;&amp;gt;ECatalog&lt;/title&gt;&lt;path fill="none" stroke="black" d="M375.542,-359.697C375.542,-351.983 375.542,-342.712 375.542,-334.112"/&gt;&lt;polygon fill="black" stroke="black" points="379.042,-334.104 375.542,-324.104 372.042,-334.104 379.042,-334.104"/&gt;&lt;/g&gt;&amp;lt;!-- SUsers --&amp;gt;&lt;g id="node19" class="node"&gt;&lt;title&gt;SUsers&lt;/title&gt;&lt;polygon fill="none" stroke="black" points="513.542,-324 459.542,-324 459.542,-288 513.542,-288 513.542,-324"/&gt;&lt;text text-anchor="middle" x="486.542" y="-301.8" font-family="Times,serif" font-size="14.00"&gt;Users&lt;/text&gt;&lt;/g&gt;&amp;lt;!-- SData&amp;#45;&amp;gt;SUsers --&amp;gt;&lt;g id="edge22" class="edge"&gt;&lt;title&gt;SData&amp;#45;&amp;gt;SUsers&lt;/title&gt;&lt;path fill="none" stroke="black" d="M486.542,-359.697C486.542,-351.983 486.542,-342.712 486.542,-334.112"/&gt;&lt;polygon fill="black" stroke="black" points="490.042,-334.104 486.542,-324.104 483.042,-334.104 490.042,-334.104"/&gt;&lt;/g&gt;&amp;lt;!-- MEmail --&amp;gt;&lt;g id="node29" class="node"&gt;&lt;title&gt;MEmail&lt;/title&gt;&lt;polygon fill="none" stroke="black" points="186.924,-108 132.159,-108 132.159,-72 186.924,-72 186.924,-108"/&gt;&lt;text text-anchor="middle" x="159.542" y="-85.8" font-family="Times,serif" font-size="14.00"&gt;Emails&lt;/text&gt;&lt;/g&gt;&amp;lt;!-- MPages&amp;#45;&amp;gt;MEmail --&amp;gt;&lt;g id="edge12" class="edge"&gt;&lt;title&gt;MPages&amp;#45;&amp;gt;MEmail&lt;/title&gt;&lt;path fill="none" stroke="black" d="M159.542,-287.849C159.542,-250.832 159.542,-163.181 159.542,-118.386"/&gt;&lt;polygon fill="black" stroke="black" points="163.042,-118.232 159.542,-108.232 156.042,-118.232 163.042,-118.232"/&gt;&lt;/g&gt;&amp;lt;!-- PUsers --&amp;gt;&lt;g id="node20" class="node"&gt;&lt;title&gt;PUsers&lt;/title&gt;&lt;polygon fill="none" stroke="black" points="293.918,-252 225.165,-252 225.165,-216 293.918,-216 293.918,-252"/&gt;&lt;text text-anchor="middle" x="259.542" y="-229.8" font-family="Times,serif" font-size="14.00"&gt;Accounts&lt;/text&gt;&lt;/g&gt;&amp;lt;!-- PArticles&amp;#45;&amp;gt;PUsers --&amp;gt;&lt;g id="edge14" class="edge"&gt;&lt;title&gt;PArticles&amp;#45;&amp;gt;PUsers&lt;/title&gt;&lt;path fill="none" stroke="black" d="M259.542,-287.697C259.542,-279.983 259.542,-270.712 259.542,-262.112"/&gt;&lt;polygon fill="black" stroke="black" points="263.042,-262.104 259.542,-252.104 256.042,-262.104 263.042,-262.104"/&gt;&lt;/g&gt;&amp;lt;!-- EUsers --&amp;gt;&lt;g id="node21" class="node"&gt;&lt;title&gt;EUsers&lt;/title&gt;&lt;polygon fill="none" stroke="black" points="409.918,-252 341.165,-252 341.165,-216 409.918,-216 409.918,-252"/&gt;&lt;text text-anchor="middle" x="375.542" y="-229.8" font-family="Times,serif" font-size="14.00"&gt;Accounts&lt;/text&gt;&lt;/g&gt;&amp;lt;!-- ECatalog&amp;#45;&amp;gt;EUsers --&amp;gt;&lt;g id="edge18" class="edge"&gt;&lt;title&gt;ECatalog&amp;#45;&amp;gt;EUsers&lt;/title&gt;&lt;path fill="none" stroke="black" d="M375.542,-287.697C375.542,-279.983 375.542,-270.712 375.542,-262.112"/&gt;&lt;polygon fill="black" stroke="black" points="379.042,-262.104 375.542,-252.104 372.042,-262.104 379.042,-262.104"/&gt;&lt;/g&gt;&amp;lt;!-- SConnections --&amp;gt;&lt;g id="node22" class="node"&gt;&lt;title&gt;SConnections&lt;/title&gt;&lt;polygon fill="none" stroke="black" points="529.535,-252 443.548,-252 443.548,-216 529.535,-216 529.535,-252"/&gt;&lt;text text-anchor="middle" x="486.542" y="-229.8" font-family="Times,serif" font-size="14.00"&gt;Connections&lt;/text&gt;&lt;/g&gt;&amp;lt;!-- SUsers&amp;#45;&amp;gt;SConnections --&amp;gt;&lt;g id="edge23" class="edge"&gt;&lt;title&gt;SUsers&amp;#45;&amp;gt;SConnections&lt;/title&gt;&lt;path fill="none" stroke="black" d="M486.542,-287.697C486.542,-279.983 486.542,-270.712 486.542,-262.112"/&gt;&lt;polygon fill="black" stroke="black" points="490.042,-262.104 486.542,-252.104 483.042,-262.104 490.042,-262.104"/&gt;&lt;/g&gt;&amp;lt;!-- PComments --&amp;gt;&lt;g id="node23" class="node"&gt;&lt;title&gt;PComments&lt;/title&gt;&lt;polygon fill="none" stroke="black" points="297.711,-180 221.372,-180 221.372,-144 297.711,-144 297.711,-180"/&gt;&lt;text text-anchor="middle" x="259.542" y="-157.8" font-family="Times,serif" font-size="14.00"&gt;Comments&lt;/text&gt;&lt;/g&gt;&amp;lt;!-- PUsers&amp;#45;&amp;gt;PComments --&amp;gt;&lt;g id="edge15" class="edge"&gt;&lt;title&gt;PUsers&amp;#45;&amp;gt;PComments&lt;/title&gt;&lt;path fill="none" stroke="black" d="M259.542,-215.697C259.542,-207.983 259.542,-198.712 259.542,-190.112"/&gt;&lt;polygon fill="black" stroke="black" points="263.042,-190.104 259.542,-180.104 256.042,-190.104 263.042,-190.104"/&gt;&lt;/g&gt;&amp;lt;!-- EOrders --&amp;gt;&lt;g id="node24" class="node"&gt;&lt;title&gt;EOrders&lt;/title&gt;&lt;polygon fill="none" stroke="black" points="402.638,-180 348.445,-180 348.445,-144 402.638,-144 402.638,-180"/&gt;&lt;text text-anchor="middle" x="375.542" y="-157.8" font-family="Times,serif" font-size="14.00"&gt;Orders&lt;/text&gt;&lt;/g&gt;&amp;lt;!-- EUsers&amp;#45;&amp;gt;EOrders --&amp;gt;&lt;g id="edge19" class="edge"&gt;&lt;title&gt;EUsers&amp;#45;&amp;gt;EOrders&lt;/title&gt;&lt;path fill="none" stroke="black" d="M375.542,-215.697C375.542,-207.983 375.542,-198.712 375.542,-190.112"/&gt;&lt;polygon fill="black" stroke="black" points="379.042,-190.104 375.542,-180.104 372.042,-190.104 379.042,-190.104"/&gt;&lt;/g&gt;&amp;lt;!-- SContent --&amp;gt;&lt;g id="node25" class="node"&gt;&lt;title&gt;SContent&lt;/title&gt;&lt;polygon fill="lightgrey" stroke="black" points="516.873,-180 456.21,-180 456.21,-144 516.873,-144 516.873,-180"/&gt;&lt;text text-anchor="middle" x="486.542" y="-157.8" font-family="Times,serif" font-size="14.00"&gt;Content&lt;/text&gt;&lt;/g&gt;&amp;lt;!-- SConnections&amp;#45;&amp;gt;SContent --&amp;gt;&lt;g id="edge24" class="edge"&gt;&lt;title&gt;SConnections&amp;#45;&amp;gt;SContent&lt;/title&gt;&lt;path fill="none" stroke="black" d="M486.542,-215.697C486.542,-207.983 486.542,-198.712 486.542,-190.112"/&gt;&lt;polygon fill="black" stroke="black" points="490.042,-190.104 486.542,-180.104 483.042,-190.104 490.042,-190.104"/&gt;&lt;/g&gt;&amp;lt;!-- PShared --&amp;gt;&lt;g id="node26" class="node"&gt;&lt;title&gt;PShared&lt;/title&gt;&lt;polygon fill="none" stroke="black" points="303.204,-108 215.879,-108 215.879,-72 303.204,-72 303.204,-108"/&gt;&lt;text text-anchor="middle" x="259.542" y="-85.8" font-family="Times,serif" font-size="14.00"&gt;Most Shared&lt;/text&gt;&lt;/g&gt;&amp;lt;!-- PComments&amp;#45;&amp;gt;PShared --&amp;gt;&lt;g id="edge16" class="edge"&gt;&lt;title&gt;PComments&amp;#45;&amp;gt;PShared&lt;/title&gt;&lt;path fill="none" stroke="black" d="M259.542,-143.697C259.542,-135.983 259.542,-126.712 259.542,-118.112"/&gt;&lt;polygon fill="black" stroke="black" points="263.042,-118.104 259.542,-108.104 256.042,-118.104 263.042,-118.104"/&gt;&lt;/g&gt;&amp;lt;!-- ECross --&amp;gt;&lt;g id="node27" class="node"&gt;&lt;title&gt;ECross&lt;/title&gt;&lt;polygon fill="none" stroke="black" points="429.983,-108 321.1,-108 321.1,-72 429.983,-72 429.983,-108"/&gt;&lt;text text-anchor="middle" x="375.542" y="-85.8" font-family="Times,serif" font-size="14.00"&gt;Product Clusters&lt;/text&gt;&lt;/g&gt;&amp;lt;!-- EOrders&amp;#45;&amp;gt;ECross --&amp;gt;&lt;g id="edge20" class="edge"&gt;&lt;title&gt;EOrders&amp;#45;&amp;gt;ECross&lt;/title&gt;&lt;path fill="none" stroke="black" d="M375.542,-143.697C375.542,-135.983 375.542,-126.712 375.542,-118.112"/&gt;&lt;polygon fill="black" stroke="black" points="379.042,-118.104 375.542,-108.104 372.042,-118.104 379.042,-118.104"/&gt;&lt;/g&gt;&amp;lt;!-- SComments --&amp;gt;&lt;g id="node28" class="node"&gt;&lt;title&gt;SComments&lt;/title&gt;&lt;polygon fill="none" stroke="black" points="524.711,-108 448.372,-108 448.372,-72 524.711,-72 524.711,-108"/&gt;&lt;text text-anchor="middle" x="486.542" y="-85.8" font-family="Times,serif" font-size="14.00"&gt;Comments&lt;/text&gt;&lt;/g&gt;&amp;lt;!-- SContent&amp;#45;&amp;gt;SComments --&amp;gt;&lt;g id="edge25" class="edge"&gt;&lt;title&gt;SContent&amp;#45;&amp;gt;SComments&lt;/title&gt;&lt;path fill="none" stroke="black" d="M486.542,-143.697C486.542,-135.983 486.542,-126.712 486.542,-118.112"/&gt;&lt;polygon fill="black" stroke="black" points="490.042,-118.104 486.542,-108.104 483.042,-118.104 490.042,-118.104"/&gt;&lt;/g&gt;&amp;lt;!-- ECart --&amp;gt;&lt;g id="node30" class="node"&gt;&lt;title&gt;ECart&lt;/title&gt;&lt;polygon fill="none" stroke="black" points="402.542,-36 348.542,-36 348.542,-0 402.542,-0 402.542,-36"/&gt;&lt;text text-anchor="middle" x="375.542" y="-13.8" font-family="Times,serif" font-size="14.00"&gt;Cart&lt;/text&gt;&lt;/g&gt;&amp;lt;!-- ECross&amp;#45;&amp;gt;ECart --&amp;gt;&lt;g id="edge21" class="edge"&gt;&lt;title&gt;ECross&amp;#45;&amp;gt;ECart&lt;/title&gt;&lt;path fill="none" stroke="black" d="M375.542,-71.6966C375.542,-63.9827 375.542,-54.7125 375.542,-46.1124"/&gt;&lt;polygon fill="black" stroke="black" points="379.042,-46.1043 375.542,-36.1043 372.042,-46.1044 379.042,-46.1043"/&gt;&lt;/g&gt;&amp;lt;!-- SChat --&amp;gt;&lt;g id="node31" class="node"&gt;&lt;title&gt;SChat&lt;/title&gt;&lt;polygon fill="none" stroke="black" points="513.542,-36 459.542,-36 459.542,-0 513.542,-0 513.542,-36"/&gt;&lt;text text-anchor="middle" x="486.542" y="-13.8" font-family="Times,serif" font-size="14.00"&gt;Chat&lt;/text&gt;&lt;/g&gt;&amp;lt;!-- SComments&amp;#45;&amp;gt;SChat --&amp;gt;&lt;g id="edge26" class="edge"&gt;&lt;title&gt;SComments&amp;#45;&amp;gt;SChat&lt;/title&gt;&lt;path fill="none" stroke="black" d="M486.542,-71.6966C486.542,-63.9827 486.542,-54.7125 486.542,-46.1124"/&gt;&lt;polygon fill="black" stroke="black" points="490.042,-46.1043 486.542,-36.1043 483.042,-46.1044 490.042,-46.1043"/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/p&gt;

&lt;p&gt;Lets walk through this.  A &lt;em&gt;data model&lt;/em&gt; is the structure that all of the site data fits into.  This represents the heart of what your database model, object model, and product design are all orbiting around.  In the beginning of development this rapidly changes, but once the site is released changes are incremental and relatively rare. It&amp;#39;s easy to add functionality that doesn&amp;#39;t change the data model, but when you start making drastic changes, the nature of what you are building changes.  Wordpress sites have pages, posts, categories and users, and if you try and jam in a product catalog then it becomes something different than a standard blog.&lt;/p&gt;

&lt;p&gt;The next level is the bulk of the data on the site.  &lt;em&gt;Marketing&lt;/em&gt; sites have pages that change rarely.  &lt;em&gt;Publishing&lt;/em&gt; sites keep adding more articles, but these really don&amp;#39;t change that much and the bulk of the access pattern is read only.  &lt;em&gt;Commerce&lt;/em&gt; sites have product catalogs, and while merchandizers add and remove things from time to time, you largely expect to have things on there forever.  Again this is mostly, though not completely, read-only.&lt;/p&gt;

&lt;p&gt;For SEO to work correctly, the data in the gray boxes really should be rendered on the server.  The &lt;em&gt;Social Site&lt;/em&gt; is a bit of an outlier here, in that the root object is actually the user and the user&amp;#39;s content.  &lt;/p&gt;

&lt;p&gt;Let&amp;#39;s compare &lt;a href="https://medium.com"&gt;medium.com&lt;/a&gt; with &lt;a href="http://facebook.com"&gt;facebook.com&lt;/a&gt;.  Since the bulk of the content of Medium is accessable to anyone once it&amp;#39;s published.  For this discussion its considered to be a publishing site rather than a social site.  Bits and elements of the page change based upon who is accessing the site, but for the most part, everyone sees the same stuff.  Facebook on the other hand looks different for each of the users.  Individual items may be public, but the main consumption is through the feed and that&amp;#39;s based upon your friends &lt;em&gt;and magic&lt;/em&gt;, so scaling has a whole different set of challenges.  Probably involving something very esoteric.&lt;/p&gt;

&lt;h2 id="towards-a-more-nerdy-taxonomy-of-data"&gt;Towards a more nerdy taxonomy of data&lt;/h2&gt;

&lt;p&gt;We can look at each of the elements on a website and break down the type of data source it came from:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Static Data&lt;/strong&gt;: Templates, Images, Fonts, Assets&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Structural Data&lt;/strong&gt;: Pages, Articles, Product Catalog, Categories, &amp;quot;Content&amp;quot;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Dynamic Data&lt;/strong&gt;: Inventory, Comments&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Session Data&lt;/strong&gt;: User names, Items in cart, Likes, etc.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;As we go down the list, the rate in which these things change increases.  &lt;em&gt;Static data&lt;/em&gt;, as the name implies, rarely changes.  Most of these are artifacts that come out of the development process or development tooling.  Templates, for example, are created during the site development process and once the site is deployed they change only in response to bug fixes or feature requests.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Structural Data&lt;/em&gt; changes during the operations of the business, but not very frequently, and generally in response to things that are outside of the site &lt;em&gt;per se&lt;/em&gt;.  These include things like marketing material, product pages (less inventory information), categories, articles, and really the bulk of the content on a site.  There are many reasons why you want to generate these pages using some sort of CMS, but rarely does this data change at &lt;em&gt;run-time&lt;/em&gt;.  This stuff doesn&amp;#39;t really need to be in a run-time database as such, but it&amp;#39;s convient to stick this stuff there if you have one laying around.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Dynamic Data&lt;/em&gt; is &lt;em&gt;run-time&lt;/em&gt; data, that is to say, things that change as part of site operations, things like newsletter signups, orders and credit card transactions.  Most &lt;em&gt;User Generated Content&lt;/em&gt; falls in the this category, and depending upon your feature set, that could be the majority of the pages.  Unlike &lt;em&gt;Structural Data&lt;/em&gt;, where it&amp;#39;s merely a good idea to use a database, this is &lt;em&gt;neccessarily&lt;/em&gt; stored in some sort of database.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Session Data&lt;/em&gt; is &lt;em&gt;specific to the user&lt;/em&gt; and renders the page differently based upon their session, such as their name, whether they&amp;#39;ve added an item into the cart or not, etc.  One of the things that makes straight &lt;em&gt;page caching&lt;/em&gt; useless in practice is that the header is different on most sites based on if you are logged in or not, or if there are items in the cart.  This gets persisted from page to page, but generally can get thrown away if the user wanders off.&lt;/p&gt;

&lt;h2 id="what-do-we-need-to-assemble-a-website"&gt;What do we need to assemble a website&lt;/h2&gt;

&lt;p&gt;A website is a series of interconnected webpages.  These pages are referenced by URLs, and the world of linking and SEO demands that these URLs return self-contained data so that you can deep link and get yourself found on the search engines.  From the outside, it looks like:&lt;/p&gt;

&lt;p&gt;&lt;svg width="314pt" height="188pt" viewBox="0.00 0.00 313.55 188.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"&gt;&lt;g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 184)"&gt;&lt;title&gt;Sitemaps&lt;/title&gt;&lt;polygon fill="white" stroke="none" points="-4,4 -4,-184 309.553,-184 309.553,4 -4,4"/&gt;&amp;lt;!-- a --&amp;gt;&lt;g id="node1" class="node"&gt;&lt;title&gt;a&lt;/title&gt;&lt;ellipse fill="none" stroke="black" cx="165.909" cy="-162" rx="42.0717" ry="18"/&gt;&lt;text text-anchor="middle" x="165.909" y="-157.8" font-family="Times,serif" font-size="14.00"&gt;Site Map&lt;/text&gt;&lt;/g&gt;&amp;lt;!-- b --&amp;gt;&lt;g id="node5" class="node"&gt;&lt;title&gt;b&lt;/title&gt;&lt;ellipse fill="none" stroke="black" cx="92.9093" cy="-90" rx="27.0958" ry="18"/&gt;&lt;text text-anchor="middle" x="92.9093" y="-85.8" font-family="Times,serif" font-size="14.00"&gt;Page&lt;/text&gt;&lt;/g&gt;&amp;lt;!-- a&amp;#45;&amp;gt;b --&amp;gt;&lt;g id="edge1" class="edge"&gt;&lt;title&gt;a&amp;#45;&amp;gt;b&lt;/title&gt;&lt;path fill="none" stroke="black" d="M149.344,-145.116C139.227,-135.415 126.163,-122.887 115.152,-112.329"/&gt;&lt;polygon fill="black" stroke="black" points="117.559,-109.788 107.919,-105.393 112.714,-114.84 117.559,-109.788"/&gt;&lt;/g&gt;&amp;lt;!-- c --&amp;gt;&lt;g id="node6" class="node"&gt;&lt;title&gt;c&lt;/title&gt;&lt;ellipse fill="none" stroke="black" cx="165.909" cy="-90" rx="27.0958" ry="18"/&gt;&lt;text text-anchor="middle" x="165.909" y="-85.8" font-family="Times,serif" font-size="14.00"&gt;Page&lt;/text&gt;&lt;/g&gt;&amp;lt;!-- a&amp;#45;&amp;gt;c --&amp;gt;&lt;g id="edge2" class="edge"&gt;&lt;title&gt;a&amp;#45;&amp;gt;c&lt;/title&gt;&lt;path fill="none" stroke="black" d="M165.909,-143.697C165.909,-135.983 165.909,-126.712 165.909,-118.112"/&gt;&lt;polygon fill="black" stroke="black" points="169.409,-118.104 165.909,-108.104 162.409,-118.104 169.409,-118.104"/&gt;&lt;/g&gt;&amp;lt;!-- d --&amp;gt;&lt;g id="node7" class="node"&gt;&lt;title&gt;d&lt;/title&gt;&lt;ellipse fill="none" stroke="black" cx="238.909" cy="-90" rx="27.0958" ry="18"/&gt;&lt;text text-anchor="middle" x="238.909" y="-85.8" font-family="Times,serif" font-size="14.00"&gt;Page&lt;/text&gt;&lt;/g&gt;&amp;lt;!-- a&amp;#45;&amp;gt;d --&amp;gt;&lt;g id="edge3" class="edge"&gt;&lt;title&gt;a&amp;#45;&amp;gt;d&lt;/title&gt;&lt;path fill="none" stroke="black" d="M182.474,-145.116C192.591,-135.415 205.656,-122.887 216.666,-112.329"/&gt;&lt;polygon fill="black" stroke="black" points="219.104,-114.84 223.9,-105.393 214.259,-109.788 219.104,-114.84"/&gt;&lt;/g&gt;&amp;lt;!-- e --&amp;gt;&lt;g id="node2" class="node"&gt;&lt;title&gt;e&lt;/title&gt;&lt;ellipse fill="none" stroke="black" cx="48.9093" cy="-18" rx="48.8187" ry="18"/&gt;&lt;text text-anchor="middle" x="48.9093" y="-13.8" font-family="Times,serif" font-size="14.00"&gt;Javascripts&lt;/text&gt;&lt;/g&gt;&amp;lt;!-- f --&amp;gt;&lt;g id="node3" class="node"&gt;&lt;title&gt;f&lt;/title&gt;&lt;ellipse fill="none" stroke="black" cx="165.909" cy="-18" rx="49.7964" ry="18"/&gt;&lt;text text-anchor="middle" x="165.909" y="-13.8" font-family="Times,serif" font-size="14.00"&gt;Stylesheets&lt;/text&gt;&lt;/g&gt;&amp;lt;!-- g --&amp;gt;&lt;g id="node4" class="node"&gt;&lt;title&gt;g&lt;/title&gt;&lt;ellipse fill="none" stroke="black" cx="269.909" cy="-18" rx="35.7887" ry="18"/&gt;&lt;text text-anchor="middle" x="269.909" y="-13.8" font-family="Times,serif" font-size="14.00"&gt;Images&lt;/text&gt;&lt;/g&gt;&amp;lt;!-- b&amp;#45;&amp;gt;e --&amp;gt;&lt;g id="edge4" class="edge"&gt;&lt;title&gt;b&amp;#45;&amp;gt;e&lt;/title&gt;&lt;path fill="none" stroke="black" d="M82.925,-73.1159C77.6218,-64.679 70.9749,-54.1044 64.9671,-44.5465"/&gt;&lt;polygon fill="black" stroke="black" points="67.7526,-42.4011 59.4676,-35.7973 61.8261,-46.1263 67.7526,-42.4011"/&gt;&lt;/g&gt;&amp;lt;!-- b&amp;#45;&amp;gt;f --&amp;gt;&lt;g id="edge7" class="edge"&gt;&lt;title&gt;b&amp;#45;&amp;gt;f&lt;/title&gt;&lt;path fill="none" stroke="black" d="M107.682,-74.8345C117.431,-65.4862 130.431,-53.0203 141.674,-42.2391"/&gt;&lt;polygon fill="black" stroke="black" points="144.32,-44.5508 149.116,-35.1033 139.475,-39.4983 144.32,-44.5508"/&gt;&lt;/g&gt;&amp;lt;!-- b&amp;#45;&amp;gt;g --&amp;gt;&lt;g id="edge10" class="edge"&gt;&lt;title&gt;b&amp;#45;&amp;gt;g&lt;/title&gt;&lt;path fill="none" stroke="black" d="M114.712,-78.6811C119.679,-76.4146 124.953,-74.0738 129.909,-72 132.434,-70.9436 192.282,-48.3186 232.902,-32.9744"/&gt;&lt;polygon fill="black" stroke="black" points="234.144,-36.2471 242.262,-29.4393 231.67,-29.6986 234.144,-36.2471"/&gt;&lt;/g&gt;&amp;lt;!-- c&amp;#45;&amp;gt;e --&amp;gt;&lt;g id="edge5" class="edge"&gt;&lt;title&gt;c&amp;#45;&amp;gt;e&lt;/title&gt;&lt;path fill="none" stroke="black" d="M146.326,-77.2836C128.873,-66.8413 102.961,-51.3386 82.2481,-38.9463"/&gt;&lt;polygon fill="black" stroke="black" points="83.8169,-35.8063 73.4385,-33.6756 80.2229,-41.8133 83.8169,-35.8063"/&gt;&lt;/g&gt;&amp;lt;!-- c&amp;#45;&amp;gt;f --&amp;gt;&lt;g id="edge8" class="edge"&gt;&lt;title&gt;c&amp;#45;&amp;gt;f&lt;/title&gt;&lt;path fill="none" stroke="black" d="M165.909,-71.6966C165.909,-63.9827 165.909,-54.7125 165.909,-46.1124"/&gt;&lt;polygon fill="black" stroke="black" points="169.409,-46.1043 165.909,-36.1043 162.409,-46.1044 169.409,-46.1043"/&gt;&lt;/g&gt;&amp;lt;!-- c&amp;#45;&amp;gt;g --&amp;gt;&lt;g id="edge11" class="edge"&gt;&lt;title&gt;c&amp;#45;&amp;gt;g&lt;/title&gt;&lt;path fill="none" stroke="black" d="M184.502,-76.4854C200.168,-65.9413 222.848,-50.6758 240.9,-38.5255"/&gt;&lt;polygon fill="black" stroke="black" points="242.997,-41.3328 249.339,-32.8454 239.089,-35.5257 242.997,-41.3328"/&gt;&lt;/g&gt;&amp;lt;!-- d&amp;#45;&amp;gt;e --&amp;gt;&lt;g id="edge6" class="edge"&gt;&lt;title&gt;d&amp;#45;&amp;gt;e&lt;/title&gt;&lt;path fill="none" stroke="black" d="M217.541,-78.7547C212.459,-76.4372 207.026,-74.0559 201.909,-72 166.251,-57.6716 125.047,-43.5325 94.3876,-33.4665"/&gt;&lt;polygon fill="black" stroke="black" points="95.4168,-30.1208 84.8243,-30.3463 93.2455,-36.7755 95.4168,-30.1208"/&gt;&lt;/g&gt;&amp;lt;!-- d&amp;#45;&amp;gt;f --&amp;gt;&lt;g id="edge9" class="edge"&gt;&lt;title&gt;d&amp;#45;&amp;gt;f&lt;/title&gt;&lt;path fill="none" stroke="black" d="M224.137,-74.8345C214.388,-65.4862 201.388,-53.0203 190.144,-42.2391"/&gt;&lt;polygon fill="black" stroke="black" points="192.343,-39.4983 182.703,-35.1033 187.498,-44.5508 192.343,-39.4983"/&gt;&lt;/g&gt;&amp;lt;!-- d&amp;#45;&amp;gt;g --&amp;gt;&lt;g id="edge12" class="edge"&gt;&lt;title&gt;d&amp;#45;&amp;gt;g&lt;/title&gt;&lt;path fill="none" stroke="black" d="M246.256,-72.411C249.832,-64.3352 254.218,-54.4312 258.238,-45.3547"/&gt;&lt;polygon fill="black" stroke="black" points="261.551,-46.517 262.4,-35.9562 255.151,-43.6825 261.551,-46.517"/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/p&gt;

&lt;p&gt;The main entry point is the &lt;em&gt;Sitemap&lt;/em&gt;.  Conceptually, this is the overview of what can be found on the site.  In a specific, SEO sense, a sitemap is a way of communicating to search engines the structure of your site so the search results can be better organized.  But in a more general sense, the sitemap is a collection of all of the pages that make up the site.&lt;/p&gt;

&lt;p&gt;The conceptual sitemap is a list of URLs that makes up your site.  If you have a completely static &lt;em&gt;Marketing&lt;/em&gt; site, then the sitemaps is just the collection of the static HTML files that is on the webserver filesystem.  If you have a &lt;em&gt;Publishing&lt;/em&gt; or &lt;em&gt;Commerce&lt;/em&gt; site, the list of page urls depend upon the templates and the data in the database: even if they use the same template, every individual post has it&amp;#39;s own permalink or &lt;em&gt;canonical URL&lt;/em&gt;, every product in the catalog has it&amp;#39;s own product detail page.&lt;/p&gt;

&lt;h2 id="how-urls-are-made-on-the-inside"&gt;How urls are made on the inside&lt;/h2&gt;

&lt;p&gt;Lets take an example of a &lt;em&gt;Commerce&lt;/em&gt; site, and how those URLs are generated.  I don&amp;#39;t know the actual details, but lets look at how &lt;code&gt;http://www.thinkgeek.com/product/1dbd/&lt;/code&gt; could be generated.&lt;/p&gt;

&lt;p&gt;From the inside of a website, it looks a little more like this:&lt;/p&gt;

&lt;p&gt;&lt;svg width="408pt" height="152pt" viewBox="0.00 0.00 408.03 152.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"&gt;&lt;g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 148)"&gt;&lt;title&gt;Routing&lt;/title&gt;&lt;polygon fill="white" stroke="none" points="-4,4 -4,-148 404.027,-148 404.027,4 -4,4"/&gt;&amp;lt;!-- b --&amp;gt;&lt;g id="node1" class="node"&gt;&lt;title&gt;b&lt;/title&gt;&lt;ellipse fill="none" stroke="black" cx="31.2223" cy="-99" rx="31.4462" ry="18"/&gt;&lt;text text-anchor="middle" x="31.2223" y="-94.8" font-family="Times,serif" font-size="14.00"&gt;router&lt;/text&gt;&lt;/g&gt;&amp;lt;!-- c --&amp;gt;&lt;g id="node2" class="node"&gt;&lt;title&gt;c&lt;/title&gt;&lt;ellipse fill="none" stroke="black" cx="142.928" cy="-126" rx="44.4664" ry="18"/&gt;&lt;text text-anchor="middle" x="142.928" y="-121.8" font-family="Times,serif" font-size="14.00"&gt;controller&lt;/text&gt;&lt;/g&gt;&amp;lt;!-- b&amp;#45;&amp;gt;c --&amp;gt;&lt;g id="edge1" class="edge"&gt;&lt;title&gt;b&amp;#45;&amp;gt;c&lt;/title&gt;&lt;path fill="none" stroke="black" d="M60.1895,-105.883C70.7038,-108.471 82.969,-111.489 94.7521,-114.389"/&gt;&lt;polygon fill="black" stroke="black" points="93.9407,-117.794 104.487,-116.785 95.6137,-110.997 93.9407,-117.794"/&gt;&lt;/g&gt;&amp;lt;!-- g --&amp;gt;&lt;g id="node3" class="node"&gt;&lt;title&gt;g&lt;/title&gt;&lt;ellipse fill="none" stroke="black" cx="142.928" cy="-72" rx="44.4664" ry="18"/&gt;&lt;text text-anchor="middle" x="142.928" y="-67.8" font-family="Times,serif" font-size="14.00"&gt;controller&lt;/text&gt;&lt;/g&gt;&amp;lt;!-- b&amp;#45;&amp;gt;g --&amp;gt;&lt;g id="edge5" class="edge"&gt;&lt;title&gt;b&amp;#45;&amp;gt;g&lt;/title&gt;&lt;path fill="none" stroke="black" d="M60.1895,-92.1169C70.7038,-89.5292 82.969,-86.5106 94.7521,-83.6106"/&gt;&lt;polygon fill="black" stroke="black" points="95.6137,-87.0031 104.487,-81.2146 93.9407,-80.2059 95.6137,-87.0031"/&gt;&lt;/g&gt;&amp;lt;!-- e --&amp;gt;&lt;g id="node4" class="node"&gt;&lt;title&gt;e&lt;/title&gt;&lt;ellipse fill="none" stroke="black" cx="142.928" cy="-18" rx="42.0524" ry="18"/&gt;&lt;text text-anchor="middle" x="142.928" y="-13.8" font-family="Times,serif" font-size="14.00"&gt;datastore&lt;/text&gt;&lt;/g&gt;&amp;lt;!-- c&amp;#45;&amp;gt;e --&amp;gt;&lt;g id="edge2" class="edge"&gt;&lt;title&gt;c&amp;#45;&amp;gt;e&lt;/title&gt;&lt;path fill="none" stroke="black" d="M108.577,-114.263C97.6138,-108.704 86.7092,-100.839 80.4446,-90 72.4384,-76.1472 72.4384,-67.8528 80.4446,-54 85.1832,-45.801 92.5766,-39.3043 100.642,-34.2196"/&gt;&lt;polygon fill="black" stroke="black" points="102.536,-37.1709 109.564,-29.2427 99.126,-31.0577 102.536,-37.1709"/&gt;&lt;/g&gt;&amp;lt;!-- d --&amp;gt;&lt;g id="node5" class="node"&gt;&lt;title&gt;d&lt;/title&gt;&lt;ellipse fill="none" stroke="black" cx="263.965" cy="-126" rx="40.6075" ry="18"/&gt;&lt;text text-anchor="middle" x="263.965" y="-121.8" font-family="Times,serif" font-size="14.00"&gt;template&lt;/text&gt;&lt;/g&gt;&amp;lt;!-- c&amp;#45;&amp;gt;d --&amp;gt;&lt;g id="edge3" class="edge"&gt;&lt;title&gt;c&amp;#45;&amp;gt;d&lt;/title&gt;&lt;path fill="none" stroke="black" d="M187.577,-126C195.879,-126 204.626,-126 213.105,-126"/&gt;&lt;polygon fill="black" stroke="black" points="213.265,-129.5 223.265,-126 213.265,-122.5 213.265,-129.5"/&gt;&lt;/g&gt;&amp;lt;!-- g&amp;#45;&amp;gt;e --&amp;gt;&lt;g id="edge6" class="edge"&gt;&lt;title&gt;g&amp;#45;&amp;gt;e&lt;/title&gt;&lt;path fill="none" stroke="black" d="M142.928,-53.7902C142.928,-51.3082 142.928,-48.8262 142.928,-46.3443"/&gt;&lt;polygon fill="black" stroke="black" points="146.428,-46.1406 142.928,-36.1406 139.428,-46.1407 146.428,-46.1406"/&gt;&lt;/g&gt;&amp;lt;!-- h --&amp;gt;&lt;g id="node6" class="node"&gt;&lt;title&gt;h&lt;/title&gt;&lt;ellipse fill="none" stroke="black" cx="263.965" cy="-72" rx="40.6075" ry="18"/&gt;&lt;text text-anchor="middle" x="263.965" y="-67.8" font-family="Times,serif" font-size="14.00"&gt;template&lt;/text&gt;&lt;/g&gt;&amp;lt;!-- g&amp;#45;&amp;gt;h --&amp;gt;&lt;g id="edge7" class="edge"&gt;&lt;title&gt;g&amp;#45;&amp;gt;h&lt;/title&gt;&lt;path fill="none" stroke="black" d="M187.577,-72C195.879,-72 204.626,-72 213.105,-72"/&gt;&lt;polygon fill="black" stroke="black" points="213.265,-75.5001 223.265,-72 213.265,-68.5001 213.265,-75.5001"/&gt;&lt;/g&gt;&amp;lt;!-- i --&amp;gt;&lt;g id="node7" class="node"&gt;&lt;title&gt;i&lt;/title&gt;&lt;ellipse fill="none" stroke="black" cx="370.273" cy="-99" rx="29.5104" ry="18"/&gt;&lt;text text-anchor="middle" x="370.273" y="-94.8" font-family="Times,serif" font-size="14.00"&gt;result&lt;/text&gt;&lt;/g&gt;&amp;lt;!-- d&amp;#45;&amp;gt;i --&amp;gt;&lt;g id="edge4" class="edge"&gt;&lt;title&gt;d&amp;#45;&amp;gt;i&lt;/title&gt;&lt;path fill="none" stroke="black" d="M299.408,-117.084C310.021,-114.337 321.744,-111.303 332.507,-108.517"/&gt;&lt;polygon fill="black" stroke="black" points="333.66,-111.834 342.464,-105.939 331.906,-105.057 333.66,-111.834"/&gt;&lt;/g&gt;&amp;lt;!-- h&amp;#45;&amp;gt;i --&amp;gt;&lt;g id="edge8" class="edge"&gt;&lt;title&gt;h&amp;#45;&amp;gt;i&lt;/title&gt;&lt;path fill="none" stroke="black" d="M299.408,-80.9156C310.021,-83.6627 321.744,-86.6972 332.507,-89.4832"/&gt;&lt;polygon fill="black" stroke="black" points="331.906,-92.9429 342.464,-92.0605 333.66,-86.1662 331.906,-92.9429"/&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/p&gt;

&lt;p&gt;A request comes into the server and the &lt;code&gt;router&lt;/code&gt; determines what the user is asking for.  In our example, since the path of the url is &lt;code&gt;/product/1dbd/&lt;/code&gt;, the router looks at that and says &amp;quot;this is a product page&amp;quot; so let&amp;#39;s hand the request off to the &lt;code&gt;product&lt;/code&gt; controller, which is the part of the code that knows about product stuff.&lt;/p&gt;

&lt;p&gt;The controller would load up the product with the id &lt;code&gt;1dbd&lt;/code&gt; from the product catalog in the database, in this case &lt;em&gt;Flux Capacitor USB Car Charger&lt;/em&gt;, which we can all agree is a necessary car accessory, and then use those details to fill out the product template.&lt;/p&gt;

&lt;p&gt;The developers of this site didn&amp;#39;t code up each of these product pages, they coded up one &lt;code&gt;template&lt;/code&gt; that represents all of the possible product pages that could be served up, they coded up a &lt;code&gt;controller&lt;/code&gt; which knows how to pull the data from the database, and they wired up the whole thing using a &lt;code&gt;router&lt;/code&gt;.&lt;/p&gt;

&lt;h2 id="sitemaps-in-static-site-generators"&gt;Sitemaps in static site generators&lt;/h2&gt;

&lt;p&gt;Our conceptual sitemap then is composed then of the set routes and database ids.  The pages themselves are a cross product of the templates and the data for each of the pages:&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Data x Templates = Pages&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;One of the things that&amp;#39;s exciting about &lt;a href="https://middlemanapp.com"&gt;Middleman&lt;/a&gt; is that it has a &lt;a href="/building-middleman-extensions/#manipulating-the-sitemap"&gt;manipulatable concept of a sitemap&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The main thing that middleman does it to give front-end developers tooling to build sites, so you get the benefits of layouts and partials and SASS and helper methods and javascript minification all the other front-end tooling that you get with rails, but without needing to run a server.  This lets you build fancy sites using the &amp;quot;normal&amp;quot; tools and you can still host them on github pages or divshot or a cheap server.&lt;/p&gt;

&lt;p&gt;I&amp;#39;ve written about Middleman before:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href="/building-sites-with-middleman/"&gt;Building Sites with Middleman&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="/middleman-tricks-and-hacks/"&gt;Middleman Tricks and Hacks&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="/building-middleman-extensions/"&gt;Building Middleman Extensions&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;If we want to pre-render the pages on the server at build time we&amp;#39;ll need both the routes as well as the &amp;quot;database IDs&amp;quot;.  That gives us the list of files, and to generate the files themselves we&amp;#39;ll need the data for each specific page.  In a basic way, this can be done using &lt;a href="/advanced/dynamic_pages/"&gt;page proxies&lt;/a&gt;, excerpt from the Middleman docs:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[&amp;quot;tom&amp;quot;, &amp;quot;dick&amp;quot;, &amp;quot;harry&amp;quot;].each do |name|
  proxy &amp;quot;/about/#{name}.html&amp;quot;, &amp;quot;/about/template.html&amp;quot;, :locals =&amp;gt; { :person_name =&amp;gt; name }, :ignore =&amp;gt; true
end
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;If you put that code in your &lt;code&gt;config.rb&lt;/code&gt; it will create 3 pages in the middleman sitemap. (Found on &lt;code&gt;http://localhost:4567/__middleman/sitemap/&lt;/code&gt; if you have a local build running.) These files will be named &lt;code&gt;/about/tom.html&lt;/code&gt;, &lt;code&gt;/about/dick.html&lt;/code&gt;, and &lt;code&gt;/about/tom.html&lt;/code&gt;, all generated from the &lt;code&gt;/about/template.html&lt;/code&gt; template.&lt;/p&gt;

&lt;p&gt;You could imagine instead passing in a complex object instead of a string.  I touched on this in a basic way before in the &lt;a href="/middleman-tricks-and-hacks/#site-data-as-database"&gt;Using Site Data as a Database&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;In the simpliest form, you could dump your data in the &lt;code&gt;data/&lt;/code&gt; directory as &lt;code&gt;books.json&lt;/code&gt;, and then put this in your &lt;code&gt;config.rb&lt;/code&gt; to generate a product catalog:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;data.books.each do |book|
  proxy &amp;quot;/book/#{book.slug}.html&amp;quot;, &amp;quot;/book.html&amp;quot;, locals: { book: book }, ignore: true
end
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;As a proof of concept this works, but for a real system there would at least need to be a mechanism to sync the json from the database.  For a more robust mechanism, remember that Middleman exposes a &lt;a href="/building-middleman-extensions/#manipulating-the-sitemap"&gt;manipulatable concept of a sitemap&lt;/a&gt; to extensions.&lt;/p&gt;

&lt;h2 id="making-front-end-development-easy"&gt;Making front-end development easy&lt;/h2&gt;

&lt;p&gt;The story thus far is that we can split out data into static, dynamic, and session data, and we can use Middleman&amp;#39;s sitemap concept to generate static pages that can be served straight from S3 for all we care and it will all be indexable by Google.  Sweet!!!&lt;/p&gt;

&lt;p&gt;Now lets talk about how we can actually implement some of these templates.&lt;/p&gt;

&lt;p&gt;We&amp;#39;ve broken down pages and split out when different parts will be rendered based upon our &lt;a href="#towards-a-more-nerdy-taxonomy-of-data"&gt;taxonomy of data&lt;/a&gt;.  We&amp;#39;ve figured out a basic structure of how to render the &lt;em&gt;Structural Data&lt;/em&gt; into the page, and now we need to figure out a good way to render the &lt;em&gt;Dynamic&lt;/em&gt; and &lt;em&gt;Session&lt;/em&gt; data in there too. And we also want to make this friendly for front-end developers.  It&amp;#39;s not practical to have different templating engines and coding styles for bits of data that, during the development process, may turn out to be &lt;em&gt;Site&lt;/em&gt; or &lt;em&gt;Dynamic&lt;/em&gt; data.&lt;/p&gt;

&lt;p&gt;This is different than using Varnish, CloudFront or Rails Page Level caching.  In those scenarios, there&amp;#39;s no easy way to distinguish between elements on the page that everyone can see, vs elements that only specific people can see.  It&amp;#39;s all or nothing.&lt;/p&gt;

&lt;p&gt;For example, when Admins are logged into wordpress sites, they have a toolbar that regular browsers don&amp;#39;t see, so the page caching mechanisms need to have a way to subvert the caching process for logged in users.  In this mechanism, we are going to send the same basic page data to all of the users, and then use client side javascript templating to change the DOM for the user based upon API calls that we make on their request.&lt;/p&gt;

&lt;h2 id="enter-react"&gt;Enter React&lt;/h2&gt;

&lt;p&gt;&lt;a href="https://facebook.github.io/react/"&gt;React&lt;/a&gt; is a javascript view framework from Facebook that focuses solely on the view layer.  (We&amp;#39;re only going to be talking about the React part, and you can use &lt;a href="https://facebook.github.io/flux/"&gt;flux&lt;/a&gt; or not, up to you.)&lt;/p&gt;

&lt;p&gt;React works by enforcing a specific dataflow model on how components are rendered into the DOM.  React lets you build heirachies of components that know how to render themselves and deal with different user actions.  Much of what we&amp;#39;ve been talking about above thinking about page generation from a dataflow perspective, splitting the data up into different sources based upon their rate of change, and breaking up the page based upon how the data flows into it.With the goal of trying to prerender all of the stuff that&amp;#39;s the same for everyone.&lt;/p&gt;

&lt;p&gt;React has a more focused dataflow model, working by passing in a component, data, and a DOM element, and it render out the HTML in that element.  Components can be nested and have complex logic, and when you change the state of a particular component, all of the subcomponents will be refreshed as needed.&lt;/p&gt;

&lt;p&gt;React has two concepts of data, one is called &lt;em&gt;properties&lt;/em&gt; which is inherited from above and considered to be immutable.  The other is called &lt;em&gt;state&lt;/em&gt;, which is owned by a component and can be changed and passed to any children components.  In React, this is about data ownership and to keep the page updates efficient.&lt;/p&gt;

&lt;h2 id="rendering-react-on-the-server-side"&gt;Rendering React on the server side&lt;/h2&gt;

&lt;p&gt;One of the most interesting things about React is that you can render the HTML on the server side as well as the client side.  Rendering on the server will include data attributes on the DOM so that the client Javascript can pick it up from there.  In other words, if the data is available, you can render a template on the server or the client and it will &lt;em&gt;work the exact same way&lt;/em&gt;.  This is the one templating system that will be easy to move from &lt;em&gt;Structural Data on the server&lt;/em&gt; to &lt;em&gt;Dynamic Data on the client&lt;/em&gt;!&lt;/p&gt;

&lt;p&gt;Obviously you need to have the data available on the server at render time, and you&amp;#39;ll pass it to the precompiler in a different way than you would on the client (one is passed to the JavaScript engine and the other is probably a result of a JSON AJAX call but all of the interaction and user logic remains the same), but outside of the wiring the business and interaction logic completely shared.&lt;/p&gt;

&lt;p&gt;If you are using &lt;a href="https://github.com/reactjs/react-rails"&gt;&lt;code&gt;react-rails&lt;/code&gt;&lt;/a&gt; this looks like:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;lt;%= react_component(&amp;#39;HelloMessage&amp;#39;, {name: &amp;#39;John&amp;#39;}, {prerender: true}) %&amp;gt;
&amp;lt;!-- becomes: --&amp;gt;
&amp;lt;div data-react-class=&amp;quot;HelloMessage&amp;quot; data-react-props=&amp;quot;{&amp;amp;quot;name&amp;amp;quot;:&amp;amp;quot;John&amp;amp;quot;}&amp;quot;&amp;gt;
  &amp;lt;h1&amp;gt;Hello, John!&amp;lt;/h1&amp;gt;
&amp;lt;/div&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;When you instantiate the javascript environment in the client, it will look for the &lt;code&gt;data-react-*&lt;/code&gt; attributes and plug in your components there.&lt;/p&gt;

&lt;p&gt;I&amp;#39;ve ported this functionality over to HappyFunCorp&amp;#39;s fork of the &lt;a href="https://github.com/HappyFunCorp/middleman-react"&gt;middleman-react gem&lt;/a&gt; that you can use in middleman.&lt;/p&gt;

&lt;h2 id="javascript-and-web-services-sitting-in-a-tree"&gt;Javascript and web services sitting in a tree&lt;/h2&gt;

&lt;p&gt;The trick is that React can also be rendered on the server, and then the javascript that&amp;#39;s run on the client side can pick it up from there.  At this point in the process all of the &lt;em&gt;Structural Data&lt;/em&gt; is available both in rendered HTML and also in the React components themselves, passed in as &lt;em&gt;properties&lt;/em&gt; or &lt;em&gt;state&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;Our components are ready to go!  They&amp;#39;ve either rendered &lt;em&gt;Site Data&lt;/em&gt; from the server, or they can pull in &lt;em&gt;Dynamic and Session Data&lt;/em&gt; in from an API, and use that to render the page.  These components are written in the same way, using the same technology, so you don&amp;#39;t need to have a different style of building or constructing the front end, other than breaking down where the components get data from.  Which ones get rendered on the server?  Do they have enough data to render what they need?  Do they need to have additional data that can be loaded in at client-run-time?  Or is it all straight from an API?&lt;/p&gt;

&lt;h2 id="enter-parse"&gt;Enter Parse&lt;/h2&gt;

&lt;p&gt;One of the benefits of this is that there are API-as-services out there, like &lt;a href="https://parse.com"&gt;Parse&lt;/a&gt; or &lt;a href="https://www.firebase.com"&gt;Firebase&lt;/a&gt;.  All of your data could live in these systems, and you can pull certain stuff out during the build process, and other data out at Runtime, and they handle both security, user accounts, and, more importantly, operational scaling support.  From an ops perspective, you don&amp;#39;t need to do anything other than build the site and pay the hosting builds, and all of the tricky scaling stuff handled is by a third party.&lt;/p&gt;

&lt;p&gt;&lt;img class="img-responsive" src="images/seed_sequence-19612778.png" /&gt;&lt;/p&gt;

&lt;h2 id="bringing-back-a-build-server"&gt;Bringing back a build server&lt;/h2&gt;

&lt;div class="diagram_right"&gt;
&lt;svg width="228pt" height="302pt" viewBox="0.00 0.00 228.08 302.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"&gt;&lt;g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 298)"&gt;&lt;title&gt;deployment&lt;/title&gt;&lt;polygon fill="white" stroke="none" points="-4,4 -4,-298 224.078,-298 224.078,4 -4,4"/&gt;&lt;!-- Build Server --&gt;&lt;g id="node1" class="node"&gt;&lt;title&gt;Build Server&lt;/title&gt;&lt;ellipse fill="none" stroke="black" cx="113.656" cy="-276" rx="55.1079" ry="18"/&gt;&lt;text text-anchor="middle" x="113.656" y="-271.8" font-family="Times,serif" font-size="14.00"&gt;Build Server&lt;/text&gt;&lt;/g&gt;&lt;!-- Static Files --&gt;&lt;g id="node2" class="node"&gt;&lt;title&gt;Static Files&lt;/title&gt;&lt;ellipse fill="none" stroke="black" cx="49.6563" cy="-190" rx="49.8131" ry="18"/&gt;&lt;text text-anchor="middle" x="49.6563" y="-185.8" font-family="Times,serif" font-size="14.00"&gt;Static Files&lt;/text&gt;&lt;/g&gt;&lt;!-- Build Server&amp;#45;&amp;gt;Static Files --&gt;&lt;g id="edge1" class="edge"&gt;&lt;title&gt;Build Server&amp;#45;&amp;gt;Static Files&lt;/title&gt;&lt;path fill="none" stroke="black" d="M96.1299,-258.625C90.5065,-252.977 84.4446,-246.444 79.4424,-240 73.8261,-232.765 68.3996,-224.402 63.7518,-216.656"/&gt;&lt;polygon fill="black" stroke="black" points="66.7419,-214.835 58.6888,-207.951 60.6909,-218.355 66.7419,-214.835"/&gt;&lt;text text-anchor="middle" x="100.263" y="-228.8" font-family="Times,serif" font-size="14.00"&gt;Deploy&lt;/text&gt;&lt;/g&gt;&lt;!-- Client --&gt;&lt;g id="node3" class="node"&gt;&lt;title&gt;Client&lt;/title&gt;&lt;ellipse fill="none" stroke="black" cx="44.6563" cy="-104" rx="31.948" ry="18"/&gt;&lt;text text-anchor="middle" x="44.6563" y="-99.8" font-family="Times,serif" font-size="14.00"&gt;Client&lt;/text&gt;&lt;/g&gt;&lt;!-- Static Files&amp;#45;&amp;gt;Client --&gt;&lt;g id="edge2" class="edge"&gt;&lt;title&gt;Static Files&amp;#45;&amp;gt;Client&lt;/title&gt;&lt;path fill="none" stroke="black" d="M46.2496,-171.98C45.265,-166.289 44.3253,-159.893 43.8389,-154 43.2694,-147.1 43.1445,-139.636 43.2392,-132.663"/&gt;&lt;polygon fill="black" stroke="black" points="46.7492,-132.358 43.5362,-122.262 39.7521,-132.158 46.7492,-132.358"/&gt;&lt;text text-anchor="middle" x="79.065" y="-142.8" font-family="Times,serif" font-size="14.00"&gt;User Access&lt;/text&gt;&lt;/g&gt;&lt;!-- Parse --&gt;&lt;g id="node4" class="node"&gt;&lt;title&gt;Parse&lt;/title&gt;&lt;ellipse fill="none" stroke="black" cx="90.6563" cy="-18" rx="29.0257" ry="18"/&gt;&lt;text text-anchor="middle" x="90.6563" y="-13.8" font-family="Times,serif" font-size="14.00"&gt;Parse&lt;/text&gt;&lt;/g&gt;&lt;!-- Client&amp;#45;&amp;gt;Parse --&gt;&lt;g id="edge3" class="edge"&gt;&lt;title&gt;Client&amp;#45;&amp;gt;Parse&lt;/title&gt;&lt;path fill="none" stroke="black" d="M43.6422,-85.7706C43.7746,-75.9442 45.1857,-63.6942 50.3008,-54 53.425,-48.079 57.9961,-42.7142 62.9497,-38.0628"/&gt;&lt;polygon fill="black" stroke="black" points="65.5066,-40.485 70.8957,-31.3632 60.9944,-35.1333 65.5066,-40.485"/&gt;&lt;text text-anchor="middle" x="85.834" y="-56.8" font-family="Times,serif" font-size="14.00"&gt;Update Data&lt;/text&gt;&lt;/g&gt;&lt;!-- Parse&amp;#45;&amp;gt;Build Server --&gt;&lt;g id="edge4" class="edge"&gt;&lt;title&gt;Parse&amp;#45;&amp;gt;Build Server&lt;/title&gt;&lt;path fill="none" stroke="black" d="M106.772,-33.1082C112.276,-38.9538 117.769,-46.1938 120.656,-54 145.151,-120.214 130.838,-205.352 120.835,-248.049"/&gt;&lt;polygon fill="black" stroke="black" points="117.389,-247.408 118.411,-257.953 124.188,-249.072 117.389,-247.408"/&gt;&lt;text text-anchor="middle" x="177.367" y="-142.8" font-family="Times,serif" font-size="14.00"&gt;Trigger Update&lt;/text&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;&lt;/div&gt;

&lt;p&gt;There still needs to be a way to get new versions of &lt;em&gt;Structural Data&lt;/em&gt; onto the site.  For this, we need to host middleman somewhere on a build server, and everytime &lt;em&gt;Structural Data&lt;/em&gt; changes we need to trigger another build that pushes up the static content.  Parse has &lt;a href="https://parse.com/docs/js/guide#cloud-code-aftersave-triggers"&gt;afterSave triggers&lt;/a&gt; that could, for example, ping your build server to first pull down the data changes, and then push the code out.&lt;/p&gt;

&lt;p&gt;Remember, this would only be for &lt;em&gt;Structural Data&lt;/em&gt; updates, for example if an Admin user updated a product description.  If a customer added an item to their cart or placed an order, this would all be dynamic data inside of the data store and managed on the client site.  It would only update Parse, not the site that everyone would access.&lt;/p&gt;

&lt;h2 id="advantages"&gt;Advantages&lt;/h2&gt;

&lt;p&gt;The advantages of this way of building things are:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;You get full SEO with a heavy client JavaScript site without having to do crazy things with PhantomJS or meta fragments.&lt;/li&gt;
&lt;li&gt;Hosting and operations become both cheap and doesn&amp;#39;t require a support team.&lt;/li&gt;
&lt;li&gt;Scaling out the system is mainly a bandwidth problem, and secondarily a API scaling problem for a subset of behavior.&lt;/li&gt;
&lt;li&gt;The system breaks gracefully. If you overwhelm the API server the site is still available for browsing.  Assuming that most usage of the sites are reads, this means that if you try to &lt;em&gt;break the internet&lt;/em&gt; with &lt;a href="http://www.papermag.com/2014/11/kim_kardashian.php"&gt;Kim Kardashian&amp;#39;s ass&lt;/a&gt; maybe user login will slow down, but everything else is still available.&lt;/li&gt;
&lt;li&gt;You are able to build your front end using modern and clean fancy JavaScript technologies and don&amp;#39;t need to mess around with back-end coding.&lt;/li&gt;
&lt;/ol&gt;
</content>
  </entry>
  <entry>
    <title>Why Engineers build crappy products</title>
    <link rel="alternate" href="http://willschenk.com/why-engineers-build-crappy-products/"/>
    <id>http://willschenk.com/why-engineers-build-crappy-products/</id>
    <published>2015-02-20T19:00:00-05:00</published>
    <updated>2015-02-20T19:00:00-05:00</updated>
    <author>
      <name>Will Schenk</name>
    </author>
    <content type="html">&lt;p&gt;There&amp;#39;s a certain user interface that, when you first see it, screams out of you that it was designed by an engineer. &lt;/p&gt;

&lt;p&gt;&lt;img alt="designed by an engineer" src="http://www.pspad.com/img/screen/mainfull.png" /&gt;&lt;/p&gt;

&lt;p&gt;(&lt;em&gt;via &lt;a href="http://daringfireball.net"&gt;Daring Fireball&lt;/a&gt; &lt;a href="https://www.google.com/search?client=safari&amp;amp;rls=en&amp;amp;q=daring+fireball+user+interface+of+the+week&amp;amp;ie=UTF-8&amp;amp;oe=UTF-8"&gt;User Interface of the Week&lt;/a&gt;&lt;/em&gt;)&lt;/p&gt;

&lt;p&gt;Why does that happen? What is it in the nature of engineering or software development process that leads to user interfaces that are impossible for the users to actually use?&lt;/p&gt;

&lt;h2 id="perfect-storm-of-user-discontent"&gt;Perfect Storm of User Discontent&lt;/h2&gt;

&lt;p&gt;The short version:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;The most interesting part of engineer&amp;#39;s jobs is the obsession with the possibilities in the solution space - all the cool shit you can make computers do.&lt;/li&gt;
&lt;li&gt;Engineers don&amp;#39;t want to make choices that limit power and flexibly.&lt;/li&gt;
&lt;li&gt;Engineers value adding potential functionality higher than removing unneeded complexity.&lt;/li&gt;
&lt;li&gt;Engineers want to engineer their way out of design problems.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id="being-a-people-person"&gt;Being a people person&lt;/h2&gt;

&lt;iframe width="560" height="315" src="https://www.youtube.com/embed/RAY27NU1Jog" frameborder="0" allowfullscreen&gt;&lt;/iframe&gt;

&lt;p&gt;The process of thinking about a new product begins with an attempt to understand what it is that the software supposed to do, that is, it starts with specifying a solution to a problem. This is assuming that the problem itself is correctly framed, which it often isn&amp;#39;t.  These specifications generally take form in things like user stories and wireframes which are ways of specifying both what the user is trying to do and the specific interface that the user will use to achieve those goals.&lt;/p&gt;

&lt;p&gt;Implicit in this is the understanding of what technology is able to do. Sometimes, especially for a product with a novel technical solution, what technology is able to do it isn&amp;#39;t completely understood. And regardless of whether or not the solution is in a known problem space, there will always be different challenges that will come up when building something.  Building software is actually very difficult.&lt;/p&gt;

&lt;p&gt;Given that fact, engineering will look at design, start thinking about what the general shape of the solution looks like, and should structure their development efforts around the parts of the product that seem the most risky -- the parts that will be technically the most challenging. If we can prove that those parts will work, with a prototype or make it functional with a sort of mock interface, then and only then does it make sense to flush out the rest of the product.&lt;/p&gt;

&lt;h2 id="the-fractal-nature-of-engineering"&gt;The fractal nature of engineering&lt;/h2&gt;

&lt;p&gt;This is the fun part. Every engineer loves greenfield development because it allows them to explore the terrain without having to deal with the trade-offs, constraints, and messiness of existing code. The process is one of exploration, of being able to explore a technical space of possibilities and potentialities. This is really awesome, and a large part of what makes engineering interesting.&lt;/p&gt;

&lt;p&gt;The experience is of building little things, putting them together in novel ways, and build things which are increasingly powerful.  This leads engineers to put knobs and buttons and gizmos on different functionality to make it easier to explore all of what it can do.  It&amp;#39;s socially rewarding to show off all this cool stuff, not just what it does not, but also what it&amp;#39;s capable of doing.  Focusing on the technology aspect of it leads people to optimize the functionality in both breath and power.&lt;/p&gt;

&lt;h2 id="interface-ecstasy"&gt;Interface ecstasy&lt;/h2&gt;

&lt;p&gt;&lt;img src="images/product/nosql_query-89043e77.png" /&gt;
&lt;em&gt;Engineers Keeping it Real: Go Fuck Yourself&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;The problem is products aren&amp;#39;t about technology. Technology is necessary but not sufficient to build products. Technology is just the plumbing, the thing which makes it possible, but not actually the thing that people care about.&lt;/p&gt;

&lt;p&gt;The ecstasy of possibility is in conflict with producing elegant products, because products are fundamentally about making choices and creating clarity around something which is very complicated. This is more than missing the forest for the trees; the ideals and aspirations of both efforts are directly contradictory.&lt;/p&gt;

&lt;h2 id="example:-me-doing-yet-another-dumb-thing"&gt;Example: Me doing Yet Another Dumb Thing&lt;/h2&gt;

&lt;p&gt;We were recently &lt;a href="http://shoutouts.happyfuncorp.com/"&gt;building a product&lt;/a&gt; that would use email as an interface touch point.  Specifications, being what they are, didn&amp;#39;t really explain what should happen when a user attempted to interact with another user who had only partially setup their account.  We were just playing around with some stuff, so it&amp;#39;s not even fair to blame the specifications on being vague; as it often goes when building something, we ended up way deeper in the weeds than anyone intended.&lt;/p&gt;

&lt;p&gt;Looking at this from the edge case perspective, that is, while focusing on the engineering implementation and building in robustness of response based upon stuff that could happen, my instinct was to start building out code that would deal with this.  It also uses slack as an endpoint, and in that set of scenarios it does something clever, so naturally email should do something clever as well.&lt;/p&gt;

&lt;p&gt;I started down the path of being able to store partial requests that would get queued up and in the user interface to resolve in the future.  I started going down the path of creating a whole bunch of functionality because I was thinking about things in terms of the technology, the other interfaces had something &amp;quot;elegant&amp;quot;, and I wanted to build something complete.  Madness was creeping into the interface, because I was in the mind set of searching for a technology solution.&lt;/p&gt;

&lt;p&gt;This is not something that&amp;#39;s core to the product.  No one actually cares. In the situation like this, the answer really isn&amp;#39;t to be a lot of technology solution. I thought that there isn&amp;#39;t a problem, but that a technology solution is not the most effective way to solve the problem.  It&amp;#39;s actually a design problem.&lt;/p&gt;

&lt;h2 id="technology-is-the-easy-part"&gt;Technology is the easy part&lt;/h2&gt;

&lt;p&gt;If the teams aren&amp;#39;t integrated, if the design team &amp;quot;finishes&amp;quot; their work and then lobs it over the fence to the engineering team, this conversation will take the form of engineering requesting designs for something that &amp;quot;was missed and we need to solve&amp;quot;.  It may have been missed, but it doesn&amp;#39;t need to be solved.  The solution, in this case, is not to &amp;quot;solve it&amp;quot; at all, but to reframe the problem.  And this reframing puts it into a place that engineers don&amp;#39;t like to be.  It was not to build out a whole partially-completed-request queuing system that the user could resolve, be alerted of outstanding tasks or whatever, it was instead to simply keep the email interface simple and redirect them to the main flow on the website.&lt;/p&gt;

&lt;p&gt;In short, the reason why engineers tend to be crappy product designers is that &lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;The most interesting part of engineer&amp;#39;s jobs is the obsession with the possibilities in the solution space - all the cool shit you can make computers do.&lt;/li&gt;
&lt;li&gt;Engineers don&amp;#39;t want to make choices that limit power and flexibly.&lt;/li&gt;
&lt;li&gt;Engineers value adding potential functionality higher than removing unneeded complexity.&lt;/li&gt;
&lt;li&gt;Engineers want to engineer their way out of design problems.&lt;/li&gt;
&lt;/ul&gt;
</content>
  </entry>
  <entry>
    <title>Setting up Rails testing with rspec, devise, and the gang</title>
    <link rel="alternate" href="http://willschenk.com/setting-up-testing/"/>
    <id>http://willschenk.com/setting-up-testing/</id>
    <published>2015-01-22T19:00:00-05:00</published>
    <updated>2015-01-22T19:00:00-05:00</updated>
    <author>
      <name>Will Schenk</name>
    </author>
    <content type="html">&lt;p&gt;The goal is to get features out fast, and interate on them quickly.  Does anyone care about it?  What do they care about?  How do we make it better?&lt;/p&gt;

&lt;p&gt;As projects get bigger, both in terms of people using the site as well as people &lt;em&gt;working&lt;/em&gt; on the site, testing and quality become relatively more important.  Adding tests introduces drag, and the theory is that you invest now for payoffs later.  What&amp;#39;s the least amount of drag we can add to the process to get us in a good place for when it will start to pay off?&lt;/p&gt;

&lt;p&gt;RSpec feature specs lets developers create testing click paths through the application, looking at the flow though the app.  It doesn&amp;#39;t focus enough on the design details, and going through a test driving development process with this way will end up with sites &amp;#39;working&amp;#39; using only an engineer&amp;#39;s defination, so as a MVP implementor you&amp;#39;ll need to find a way to resist the temptation, no matter how nifty the backend flow state is.&lt;/p&gt;

&lt;p&gt;This article will go through how the testing environment is set up on &lt;a href="http://seed.happyfuncorp.com"&gt;HappySeed&lt;/a&gt; where we focus mainly on RSpec feature specs.  Seed does this all automatically, but its nice to have it written down in a one place so we all know what&amp;#39;s going on.  Let&amp;#39;s get into it.&lt;/p&gt;

&lt;h2 id="install-rspec,-factorygirl,-capybara,-and-guard"&gt;Install RSpec, FactoryGirl, Capybara, and Guard&lt;/h2&gt;

&lt;p&gt;Lets fire up a new rails app, and pass the &lt;code&gt;-T&lt;/code&gt; option to not include TestUnit.&lt;/p&gt;

&lt;pre&gt;&lt;code class="sh"&gt;$ rails new test_app -T
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Now add some gems to the &lt;code&gt;Gemfile&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class="rb"&gt;group :development, :test do
  gem &amp;#39;rspec-rails&amp;#39;
  gem &amp;#39;factory_girl_rails&amp;#39;
  gem &amp;#39;capybara&amp;#39;
  gem &amp;#39;guard-rspec&amp;#39;
  gem &amp;#39;spring-commands-rspec&amp;#39;
  gem &amp;#39;vcr&amp;#39;
end

group :test do
  gem &amp;#39;webmock&amp;#39;
end
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Lets go through this:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href="http://rspec.info"&gt;&lt;code&gt;rpsec&lt;/code&gt;&lt;/a&gt; (implied as a dependancy) is the testing framework that we are going to use&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/thoughtbot/factory_girl"&gt;&lt;code&gt;factory_girl&lt;/code&gt;&lt;/a&gt; (implied) lets us code smart database fixtures in ruby, in things called &lt;em&gt;factories&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/jnicklas/capybara"&gt;&lt;code&gt;capybara&lt;/code&gt;&lt;/a&gt; lets helps you test web applications by simulating how a real user would interact with your app. &lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/guard/guard"&gt;&lt;code&gt;guard&lt;/code&gt;&lt;/a&gt; (implied) makes rerunning tests a snap, by watching the filesystem for when you save files and triggering events automatically&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/bblimke/webmock"&gt;&lt;code&gt;webmock&lt;/code&gt;&lt;/a&gt; locks down your test environment from talking to the internet&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/vcr/vcr"&gt;&lt;code&gt;vcr&lt;/code&gt;&lt;/a&gt; record your test suite&amp;#39;s HTTP interactions and replay them during future test runs for fast, deterministic, accurate tests&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/rspec/rspec-rails"&gt;&lt;code&gt;rspec-rails&lt;/code&gt;&lt;/a&gt; is the rails integration with rspec, which depends upon rspec itself.&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/thoughtbot/factory_girl_rails"&gt;&lt;code&gt;factory_girl_rails&lt;/code&gt;&lt;/a&gt; is the rails integration with factory_girl.&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/guard/guard-rspec"&gt;&lt;code&gt;guard-rspec&lt;/code&gt;&lt;/a&gt; is rspec integration with guard&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/jonleighton/spring-commands-rspec"&gt;&lt;code&gt;spring-commands-rspec&lt;/code&gt;&lt;/a&gt; lets you integrate rspec with spring, which means that your tests will run much faster.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;If you are interested in using cucumber, see below for steps to integrate it.&lt;/p&gt;

&lt;h2 id="base-configuration-of-rspec-and-guard"&gt;Base configuration of rspec and guard&lt;/h2&gt;

&lt;p&gt;Lets make sure that spring knows about rspec:&lt;/p&gt;

&lt;pre&gt;&lt;code class="sh"&gt;$ bundle install
$ spring binstub --all
* bin/rake: spring already present
* bin/rspec: generated with spring
* bin/rails: spring already present
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;This creates a &lt;code&gt;bin/rspec&lt;/code&gt; command that lets us run our tests.  Lets create a Guardfile and then tell guard to use this command:&lt;/p&gt;

&lt;pre&gt;&lt;code class="sh"&gt;$ guard init
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Then edit the newly generated &lt;code&gt;Guardfile&lt;/code&gt; to use the spring version of the rspec runner.  I also like to run all of the tests when I start up guard, because the more the merrier.  In &lt;code&gt;Guardfile&lt;/code&gt;, change the &lt;code&gt;guard :rspec&lt;/code&gt; line to:&lt;/p&gt;

&lt;pre&gt;&lt;code class="rb"&gt;guard :rspec, cmd: &amp;quot;bin/rspec&amp;quot;, all_on_start: true do
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Now we install the rspec files:&lt;/p&gt;

&lt;pre&gt;&lt;code class="sh"&gt;$ rails g rspec:install
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;This creates 3 files:&lt;/p&gt;

&lt;pre&gt;&lt;code class="sh"&gt;create  .rspec
create  spec
create  spec/spec_helper.rb
create  spec/rails_helper.rb
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;I like to have the output in documentation format by default, so we can edit the &lt;code&gt;.rspec&lt;/code&gt; file to be:&lt;/p&gt;

&lt;pre&gt;&lt;code class="rb"&gt;--color
--require spec_helper
--format documentation
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id="add-login-support-and-factory-girl-to-spec_helper"&gt;Add login support and factory girl to spec_helper&lt;/h2&gt;

&lt;p&gt;Getting feature and controller specs to work with authentication is a bit tricky.  We&amp;#39;re going to assume that you use &lt;a href="/setting-up-devise-with-twitter-and-facebook-and-other-omniauth-schemes-without-email-addresses/"&gt;devise for authentication&lt;/a&gt;, but this should support anything that uses &lt;a href="https://github.com/hassox/warden"&gt;warden&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;Add devise to &lt;code&gt;Gemfile&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class="rb"&gt;gem &amp;#39;devise&amp;#39;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Create &lt;code&gt;spec/support/controller_helpers.rb&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class="rb"&gt;module ControllerHelpers
  def login_with(user = double(&amp;#39;user&amp;#39;), scope = :user)
    current_user = &amp;quot;current_#{scope}&amp;quot;.to_sym
    if user.nil?
      allow(request.env[&amp;#39;warden&amp;#39;]).to receive(:authenticate!).and_throw(:warden, {:scope =&amp;gt; scope})
      allow(controller).to receive(current_user).and_return(nil)
    else
      allow(request.env[&amp;#39;warden&amp;#39;]).to receive(:authenticate!).and_return(user)
      allow(controller).to receive(current_user).and_return(user)
    end
  end
end
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;At the top of &lt;code&gt;spec_helper.rb&lt;/code&gt; add:&lt;/p&gt;

&lt;pre&gt;&lt;code class="rb"&gt;require_relative &amp;#39;support/controller_helpers&amp;#39;
require &amp;#39;devise&amp;#39;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;and in the config block add:&lt;/p&gt;

&lt;pre&gt;&lt;code class="rb"&gt;  config.include ControllerHelpers, type: :controller
  Warden.test_mode!

  config.after do
    Warden.test_reset!
  end
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Then edit &lt;code&gt;rails_helper.rb&lt;/code&gt; and put the following in the config block:&lt;/p&gt;

&lt;pre&gt;&lt;code class="rb"&gt;  config.include FactoryGirl::Syntax::Methods
  config.include Devise::TestHelpers, type: :controller
  config.include Warden::Test::Helpers
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;If you are getting uncaught throw :warden errors then make sure you have the right includes in the right config files!&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;This gives you a few things:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;FactoryGirl&lt;/code&gt; syntax methods, which let you use things like &lt;code&gt;create( :user )&lt;/code&gt; in your tests, which uses &lt;code&gt;FactoryGirl&lt;/code&gt; to generate a database object.&lt;/li&gt;
&lt;li&gt;helper methods to &lt;code&gt;sign_in&lt;/code&gt; a user for a specific scope.  This could be used as &lt;code&gt;sign_in create( :user )&lt;/code&gt; at the beginning of your controller test methods, and &lt;code&gt;sign_in nil&lt;/code&gt; to simulate an anonymous user.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id="example-controller-spec"&gt;Example controller spec&lt;/h2&gt;

&lt;p&gt;This example assumes that you&amp;#39;ve already setup devise.  If not, you can get something up and running doing:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ rails g devise:install &amp;amp;&amp;amp; rails g devise User &amp;amp;&amp;amp; rake db:migrate
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;(I go into slightly more detail in setting up &lt;a href="/setting-up-devise-with-twitter-and-facebook-and-other-omniauth-schemes-without-email-addresses/"&gt;devise for authentication&lt;/a&gt;.)&lt;/p&gt;

&lt;p&gt;Assuming that you&amp;#39;ve already setup devise, lets look at how to implement a controller spec.  First lets create a simple scaffold for a post:&lt;/p&gt;

&lt;pre&gt;&lt;code class="sh"&gt;$ rails g scaffold post name:string
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;And lets make it require authentication in &lt;code&gt;posts_controller.rb&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class="rb"&gt;class PostsController &amp;lt; ApplicationController
  before_action :authenticate_user!
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;And replace &lt;code&gt;posts_controller_spec.rb&lt;/code&gt; with:&lt;/p&gt;

&lt;pre&gt;&lt;code class="rb"&gt;require &amp;#39;rails_helper&amp;#39;

RSpec.describe PostsController, :type =&amp;gt; :controller do
  describe &amp;quot;anonymous user&amp;quot; do
    before :each do
      # This simulates an anonymous user
      login_with nil
    end

    it &amp;quot;should be redirected to signin&amp;quot; do
      get :index
      expect( response ).to redirect_to( new_user_session_path )
    end
  end
end
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;When we run &lt;code&gt;guard&lt;/code&gt;, a few of the scaffold generate things will fail, since we are now forcing signin to check out this page.  Our spec will correctly redirect the user to sign in.&lt;/p&gt;

&lt;p&gt;Lets now simulate a logged in user:&lt;/p&gt;

&lt;pre&gt;&lt;code class="rb"&gt;  it &amp;quot;should let a user see all the posts&amp;quot; do
    login_with create( :user )
    get :index
    expect( response ).to render_template( :index )
  end
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Guard should try and run this tests but fail because we can&amp;#39;t configured a user factory.&lt;/p&gt;

&lt;p&gt;Lets set that up now in &lt;code&gt;spec/factories/user.rb&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class="rb"&gt;FactoryGirl.define do
  sequence :email do |n|
    &amp;quot;person#{n}@example.com&amp;quot;
  end
end

FactoryGirl.define do
  factory :user, :class =&amp;gt; &amp;#39;User&amp;#39; do
    email
    password &amp;#39;12345678&amp;#39;
    password_confirmation &amp;#39;12345678&amp;#39;
  end
end
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Going back to the guard window, press &lt;em&gt;return&lt;/em&gt; to run everything again and verify.  (Guard doens&amp;#39;t know that the &lt;code&gt;posts_controller_spec.rb&lt;/code&gt; depends upon the user factory changing.)&lt;/p&gt;

&lt;h2 id="example-rspec-feature"&gt;Example rspec feature&lt;/h2&gt;

&lt;p&gt;Feature specs are more interesting, since they let you walk through the site and how it works.  Lets build one now:&lt;/p&gt;

&lt;pre&gt;&lt;code class="sh"&gt;$ rails g rspec:feature add_new_post
      create  spec/features/add_new_posts_spec.rb
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;And lets add something there now:&lt;/p&gt;

&lt;pre&gt;&lt;code class="rb"&gt;require &amp;#39;rails_helper&amp;#39;

feature &amp;quot;AddNewPosts&amp;quot;, :type =&amp;gt; :feature do
  it &amp;quot;should require the user log in before adding a post&amp;quot; do
    password = &amp;quot;123456789&amp;quot;
    u = create( :user, password: password, password_confirmation: password )

    visit new_post_path

    within &amp;quot;#new_user&amp;quot; do
      fill_in &amp;quot;user_email&amp;quot;, with: u.email
      fill_in &amp;quot;user_password&amp;quot;, with: password
    end

    click_button &amp;quot;Log in&amp;quot;

    within &amp;quot;#new_post&amp;quot; do
      fill_in &amp;quot;post_name&amp;quot;, with: &amp;quot;Post title&amp;quot;
    end

    click_link_or_button &amp;quot;Create Post&amp;quot;

    expect( Post.count ).to eq(1)
    expect( Post.first.name).to eq( &amp;quot;Post title&amp;quot;)
  end
end
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;This first creates a new user in the database, and then&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;Visits the &lt;code&gt;new_post_path&lt;/code&gt; url.&lt;br&gt;&lt;/li&gt;
&lt;li&gt;We should be shown the login form, and we fill it out&lt;/li&gt;
&lt;li&gt;Click the log in button&lt;/li&gt;
&lt;li&gt;Fill out the new post form&lt;/li&gt;
&lt;li&gt;Create the post&lt;/li&gt;
&lt;li&gt;Make sure that it&amp;#39;s in the database&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;If you want to skip the steps of manually logging in the user, you can use the &lt;code&gt;login_as&lt;/code&gt; method like so:&lt;/p&gt;

&lt;pre&gt;&lt;code class="rb"&gt;  it &amp;quot;should create a new post with a logged in user&amp;quot; do
    login_as create( :user ), scope: :user

    visit new_post_path
    # puts page.body

    within &amp;quot;#new_post&amp;quot; do
      fill_in &amp;quot;post_name&amp;quot;, with: &amp;quot;Post title&amp;quot;
    end

    click_link_or_button &amp;quot;Create Post&amp;quot;

    expect( Post.count ).to eq(1)
    expect( Post.first.name).to eq( &amp;quot;Post title&amp;quot;)

  end
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id="setting-up-webmock-and-vcr"&gt;Setting up webmock and VCR&lt;/h2&gt;

&lt;p&gt;Webmock stops requests from hitting the network in the test environment.  Lets turn this on by editing &lt;code&gt;rails_helper.rb&lt;/code&gt;:&lt;/p&gt;

&lt;p&gt;In &lt;code&gt;rails_helper.rb&lt;/code&gt;, below &lt;code&gt;require &amp;#39;rails/rspec&amp;#39;&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class="rb"&gt;require &amp;#39;webmock/rspec&amp;#39;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;And VCR lets you record and play back tests in the test environment, so the first time it&amp;#39;s called it lets it get through, and then on subsequent requests it plays back a known response.  Put this at the bottom of &lt;code&gt;rails_helper.rb&lt;/code&gt; to configure:&lt;/p&gt;

&lt;pre&gt;&lt;code class="rb"&gt;VCR.configure do |c|
  c.cassette_library_dir  = Rails.root.join(&amp;quot;spec&amp;quot;, &amp;quot;vcr&amp;quot;)
  c.hook_into :webmock
end
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id="example-usage-of-webmock-and-vcr"&gt;Example usage of webmock and VCR&lt;/h2&gt;

&lt;p&gt;Word comes down from up high that to facilitate decision making, a key bit of information is the current phase of the moon when something is posted to the site.  We can pull the data from the &lt;a href="http://cerridwen.readthedocs.org/en/latest/index.html"&gt;Cerridwen&lt;/a&gt; site, but how do we set up tests for this?  We certainly don&amp;#39;t want our test suite to fail because the phase of the moon changed!&lt;/p&gt;

&lt;p&gt;This is where webmock and VCR comes in.  Webmock by itself will throw an error when a request is made over the network.  VCR will let us record and play back network request -- using &lt;em&gt;cassettes&lt;/em&gt; no less -- so that we isolate changing API responses from our tests.&lt;/p&gt;

&lt;p&gt;First lets write our code to look up the phase of the moon on the create post action.  Let&amp;#39;s add a field&lt;/p&gt;

&lt;pre&gt;&lt;code class="rb"&gt;$ rails g migration add_phase_of_moon_to_posts moon_phase:string &amp;amp;&amp;amp; rake db:migrate
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Then add the lookup to our &lt;code&gt;app/controllers/posts_controller.rb&lt;/code&gt; and replace the &lt;code&gt;def create&lt;/code&gt; method:&lt;/p&gt;

&lt;pre&gt;&lt;code class="rb"&gt;  require &amp;#39;json&amp;#39;
  require &amp;#39;net/http&amp;#39;
  def create
    @post = Post.new(post_params)

    moon_json = Net::HTTP.get( URI.parse(&amp;quot;http://cerridwen.viridian-project.de/api/v1/moon&amp;quot; ))
    moon = JSON.parse( moon_json ).first

    @post.moon_phase = &amp;quot;#{moon[&amp;#39;phase&amp;#39;][&amp;#39;trend&amp;#39;]} in #{moon[&amp;#39;position&amp;#39;][&amp;#39;sign&amp;#39;]}&amp;quot;

    @post.save
    respond_with(@post)
  end
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;(This is not good style.)&lt;/p&gt;

&lt;p&gt;Now lets run our test again.&lt;/p&gt;

&lt;p&gt;Lots of unhandled http request errors!  I&amp;#39;m going to ignore the scaffold generate tests and focus on our rspec feature.  So, inside of &lt;code&gt;spec/features/add_new_posts_spec.rb&lt;/code&gt; we can link the click action inside of a use_cassette block like so::&lt;/p&gt;

&lt;pre&gt;&lt;code class="rb"&gt;  it &amp;quot;should create a new post with a logged in user&amp;quot; do
    login_as create( :user ), scope: :user

    visit new_post_path
    # puts page.body

    within &amp;quot;#new_post&amp;quot; do
      fill_in &amp;quot;post_name&amp;quot;, with: &amp;quot;Post title&amp;quot;
    end

    VCR.use_cassette &amp;quot;waxing_in_pisces&amp;quot; do
      click_link_or_button &amp;quot;Create Post&amp;quot;

      expect( Post.count ).to eq(1)
      expect( Post.first.name).to eq( &amp;quot;Post title&amp;quot;)
      expect( Post.first.moon_phase).to eq( &amp;quot;waxing in Pisces&amp;quot; )
    end
  end
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;And let the tests run.  When tests are run, VCR is going to look for the file &lt;code&gt;spec/vcr/waxing_in_pisces&lt;/code&gt;.  If it&amp;#39;s not found, then it will make the request to the server.  If the API requires authentication, for example an accesstoken when accessing a OAuth protected call, then you&amp;#39;ll need to configure you tests to have valid credentials for the first time.  These credentials could be written into the spec/vcr directory, so make sure that you scrub that before things get checked in.  (Or expire the access tokens.)&lt;/p&gt;

&lt;p&gt;If it is found, then it plays it back and so the next time the suite is run it plays it back.  Which is way faster.&lt;/p&gt;

&lt;h2 id="final-notes"&gt;Final notes&lt;/h2&gt;

&lt;p&gt;Testing has a place in software development, but it&amp;#39;s not actually clear where that is.  Setting up test haresses and building out tests for every feature really slows things down in the beginning, and probably isn&amp;#39;t appropriate for one off, exploratory things.  On the other hand, things tend to grow way past what anyone ever initially expected, and you always say &amp;quot;I wish there was a test suite&amp;quot; when inheriting code -- or even more likely, looking at something you haven&amp;#39;t seen for a few months.&lt;/p&gt;

&lt;p&gt;The rails community has a &lt;a href="http://martinfowler.com/articles/is-tdd-dead/"&gt;long history with Test Driven Development&lt;/a&gt;.  The biggest advantage of this is that you write code that is testable, and code that is testable has all sorts of other qualities that is great, from clearly defined boundries of responsibility, good encapulation, and being able to look at small isolated pieces of the system and having it make sense.  On the other hand, thebest code is the stuff you don&amp;#39;t need to maintain, and in some projects the weight of the test code is as large or larger than the code for the application features.&lt;/p&gt;

&lt;p&gt;The biggest problem with testing is that it gets you in a wonderful, but wrong, flow state of development.  In the begining of projects you should be focused on the user experience, and how the system is experienced from the outside.  The highest level tests tend to be are user stories, which is below the level of brand and user experience.&lt;/p&gt;
</content>
  </entry>
</feed>
