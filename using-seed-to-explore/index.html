<!DOCTYPE html>
<html class='no-js'>
  <head>
    <meta charset='utf-8'>
    <meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
    <title>Using seed to explore APIs | Blank Page Tech</title>
    <meta name="site" content="Blank Page Tech" />
    <meta name="og:site_name" content="Blank Page Tech" />
    <meta name="title" content="Using seed to explore APIs" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Using seed to explore APIs" />
    <meta name="twitter:site" content="@wschenk" />
    <meta name="og:title" content="Using seed to explore APIs" />
    <meta content='width=device-width' name='viewport'>
    <link href="../stylesheets/application-c2e1d785.css" rel="stylesheet" type="text/css" /><link href="../stylesheets/webicons-da5ecace.css" rel="stylesheet" type="text/css" /><link href="../stylesheets/googlecode-d3629bf4.css" rel="stylesheet" type="text/css" />
    <link href='//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.3/styles/default.min.css' rel='stylesheet'>
    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />
  </head>
  <body data-spy='scroll' data-target='.sidebar'>
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">
      <div class='visible-xs-block'>
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapsable">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a href="/" class="navbar-brand">
        Blank Page Tech
      </a>
        
      </div>
    </div>
    <div class='hidden-xs'>
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapsable">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a href="/" class="navbar-brand">
        Technology for the blank page
      </a>
        
      </div>
    </div>
    <div class="collapse navbar-collapse" id="navbar-collapsable">
      <ul class="nav navbar-nav navbar-right foo" id="menu">
      <li>
      <a href="/articles/">
        Articles
      </a>
    </li>
    <li class="dropdown">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown">Topics <b class="caret"></b></a>
      <ul class="dropdown-menu">
        <li>
      <a href="/tags/howto/">
        Howtos
      </a>
    </li>
    <li>
      <a href="/tags/overview/">
        Overviews
      </a>
    </li>
    <li>
      <a href="/tags/product/">
        Product
      </a>
    </li>
    <li>
      <a href="/tags/tools/">
        Tools
      </a>
    </li>
    <li>
      <a href="/tags/socialinvestigator/">
        Social Investigator
      </a>
    </li>
    <li>
      <a href="/tags/ruby/">
        Ruby & Rails
      </a>
    </li>
    
      </ul>
    </li>
    <li class="dropdown">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tags <b class="caret"></b></a>
      <ul class="dropdown-menu">
        <li>
      <a href="/bootstrap-advanced-grid-tricks/">
        bootstrap (1)
      </a>
    </li>
    <li>
      <a href="/tags/bots/">
        bots (2)
      </a>
    </li>
    <li>
      <a href="/using-rake-for-dataflow-programming-and-data-science/">
        data (1)
      </a>
    </li>
    <li>
      <a href="/osx-script-for-kiosk-mode/">
        gaze (1)
      </a>
    </li>
    <li class="active">
      <a href="/using-seed-to-explore/">
        github (1)
      </a>
    </li>
    <li>
      <a href="/pulling-data-out-of-google-analytics/">
        googleanalytics (1)
      </a>
    </li>
    <li>
      <a href="/tags/happy_seed/">
        happy_seed (4)
      </a>
    </li>
    <li>
      <a href="/tags/howto/">
        howto (17)
      </a>
    </li>
    <li>
      <a href="/bower-with-rails/">
        javascript (1)
      </a>
    </li>
    <li>
      <a href="/tags/middleman/">
        middleman (6)
      </a>
    </li>
    <li>
      <a href="/setting-up-devise-with-twitter-and-facebook-and-other-omniauth-schemes-without-email-addresses/">
        oauth (1)
      </a>
    </li>
    <li>
      <a href="/tags/osx/">
        osx (2)
      </a>
    </li>
    <li>
      <a href="/tags/overview/">
        overview (4)
      </a>
    </li>
    <li>
      <a href="/tags/product/">
        product (2)
      </a>
    </li>
    <li>
      <a href="/tags/rails/">
        rails (5)
      </a>
    </li>
    <li>
      <a href="/tags/rake/">
        rake (2)
      </a>
    </li>
    <li>
      <a href="/building-a-gui-for-managing-middleman-blogs/">
        react (1)
      </a>
    </li>
    <li>
      <a href="/how-to-track-your-coworkers/">
        redis (1)
      </a>
    </li>
    <li>
      <a href="/tags/ruby/">
        ruby (16)
      </a>
    </li>
    <li>
      <a href="/receiving-posted-json-with-sinatra/">
        sinatra (1)
      </a>
    </li>
    <li>
      <a href="/tags/socialinvestigator/">
        socialinvestigator (4)
      </a>
    </li>
    <li>
      <a href="/dateslice-writing-rails-extensions/">
        sql (1)
      </a>
    </li>
    <li>
      <a href="/field-of-dreams-is-25-years-old-and-hasn-t-aged-well/">
        startupmyths (1)
      </a>
    </li>
    <li>
      <a href="/tags/static_sites/">
        static_sites (2)
      </a>
    </li>
    <li>
      <a href="/setting-up-testing/">
        testing (1)
      </a>
    </li>
    <li>
      <a href="/making-a-command-line-utility-with-gems-and-thor/">
        thor (1)
      </a>
    </li>
    <li>
      <a href="/tags/tools/">
        tools (5)
      </a>
    </li>
    <li>
      <a href="/tags/toys/">
        toys (5)
      </a>
    </li>
    
      </ul>
    </li>
    <li class="dropdown">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown">Archives <b class="caret"></b></a>
      <ul class="dropdown-menu">
        <li>
      <a href="/inflight-internet/">
        Dec 2015 (1)
      </a>
    </li>
    <li class="active">
      <a href="/using-seed-to-explore/">
        Sep 2015 (1)
      </a>
    </li>
    <li>
      <a href="/2015/07/">
        Jul 2015 (3)
      </a>
    </li>
    <li>
      <a href="/adding-search-to-a-middleman-blog/">
        Jun 2015 (1)
      </a>
    </li>
    <li>
      <a href="/2015/05/">
        May 2015 (2)
      </a>
    </li>
    <li>
      <a href="/why-engineers-build-crappy-products/">
        Feb 2015 (1)
      </a>
    </li>
    <li>
      <a href="/2015/01/">
        Jan 2015 (2)
      </a>
    </li>
    <li>
      <a href="/2014/12/">
        Dec 2014 (5)
      </a>
    </li>
    <li>
      <a href="/2014/11/">
        Nov 2014 (10)
      </a>
    </li>
    <li>
      <a href="/how-to-track-your-coworkers/">
        Oct 2014 (1)
      </a>
    </li>
    
      </ul>
    </li>
    
    </ul>
    <form class='navbar-form navbar-right' id='search' role='search'>
      <div class='form-group dropdown'>
        <div class='input-group'>
          <input autocomplete='off' class='form-control' id='search_box' placeholder='Search' type='text'>
          <span class='input-group-btn'>
            <button class='btn btn-default'>
              <span class='glyphicon glyphicon-search'></span>
            </button>
          </span>
        </div>
        <ul class='dropdown-menu dropdown-menu-left results'>
          <a href="/url">Title</a>
        </ul>
      </div>
    </form>
    
    </div>
    
    </div>
    </nav>
    <div class='article-header  '>
      <h1>Using seed to explore APIs</h1>
      <h2>overview of what we're working on and how to explore apis</h2>
      <div class='tags'>
        <div class='tag'><a class="btn btn-primary" href="/tags/github/">github</a></div>
        <div class='tag'><a class="btn btn-primary" href="/tags/happy_seed/">happy_seed</a></div>
        <div class='tag'><a class="btn btn-primary" href="/tags/howto/">howto</a></div>
        <div class='tag'><a class="btn btn-primary" href="/tags/rails/">rails</a></div>
        <div class='tag'><a class="btn btn-primary" href="/tags/rake/">rake</a></div>
      </div>
      <a href='#comment_shower' id='comment_shower_scroll'>
        <span class='disqus-comment-count' data-disqus-identifier='2015-09-17-using-seed-to-explore.html'></span>
      </a>
    </div>
    <div class='content'>
      <div class='row'>
        <div class='sidebar'>
          <ul class='nav toc' data-offset-top='400' data-spy='affix'>
            <li><a href="#top">Using seed to explore APIs</a></li>
            <li><a href="#the-basic-process">The basic process</a></li>
            <li><a href="#using-seed-oauth-and-rake-to-explore-github-data">Using Seed, OAuth, and Rake to explore github data</a></li>
            <li><a href="#creating-a-github-application">Creating a github application</a></li>
            <li><a href="#create-a-seed_defaults-file">Create a seed_defaults file</a></li>
            <li><a href="#generate-the-app">Generate the app</a></li>
            <li><a href="#ask-for-more-scope">Ask for more scope</a></li>
            <li><a href="#lets-play">Lets play</a></li>
            <li><a href="#using-rake-to-pull-the-data-down">Using Rake to pull the data down</a></li>
            <li><a href="#massaging-the-data-into-something-usable">Massaging the data into something usable</a></li>
            <li><a href="#repeatable-data-in-10-minutes">Repeatable data in 10 minutes</a></li>
          </ul>
        </div>
        <div class='article' id='top'>
          <p>I&#39;ve been working to update seed, which is HappyFunCorp&#39;s app generator to make it easy to kick off MVPs.  Check out the website for more information.  One of the things that I&#39;ve started to do is to seperate out the dependancies more, and being tutorials on how to use each of the different features.  After I link to that stuff, let&#39;s walk through a way to combine different techniques we&#39;ve discussed together.</p>
          
          <ul>
          <li>Check out <a href="http://seed.happyfuncorp.com">the site</a></li>
          <li>Or watch the video:</li>
          </ul>
          
          <div class="embed-responsive embed-responsive-16by9">
            <iframe src="https://www.youtube.com/embed/hCsPDaKHw6I?rel=0" allowfullscreen></iframe>
          </div>
          
          <h2 id="the-basic-process">The basic process</h2>
          
          <ol>
          <li>Get access to the API.</li>
          <li>Open up a console and start playing with commands.</li>
          <li>Start storing the data locally once we need to get more.</li>
          <li>Play around with the data.</li>
          <li>Design a UI around in.</li>
          <li>Refactor the test &quot;scripts&quot; into ruby classes that fit that UI.</li>
          </ol>
          
          <h2 id="using-seed,-oauth,-and-rake-to-explore-github-data">Using Seed, OAuth, and Rake to explore github data</h2>
          
          <p>What I want to do is to look at all of the <code>Gemfile</code>s for all of our projects, and see which gems are the most popular, which versions we are using, and if we can develop some more expertise around it.  But first, I want to get the data.</p>
          
          <p>I could go to each of the repos in github, but there are well over a hundred so that doesn&#39;t work.  Github has an API, which is great, but I need oauth2 to access it.  Let&#39;s get going.</p>
          
          <h2 id="creating-a-github-application">Creating a github application</h2>
          
          <p>The first step is to make sure you have a github application. </p>
          
          <ol>
          <li>Go to <a href="https://github.com/settings/developers">developer applications</a></li>
          <li>Click <em>Register New Application</em></li>
          <li>Enter in <code>http://localhost:3000/users/auth/github/callback</code> as the callback URL.</li>
          <li>Fill in whatever else.</li>
          <li><em>Resister the Application</em></li>
          </ol>
          
          <p>At this point you should have the <em>Client ID</em> and the <em>Client Secret</em>.</p>
          
          <h2 id="create-a-seed_defaults-file">Create a seed_defaults file</h2>
          
          <p>Once I create a remote app, I like to put the credentials into the <code>~/.seed_defaults</code> file.  This will make it so the next time I generate a seed app, these are the default credentials that are used.</p>
          
          <pre><code>GITHUB_APP_ID=replace with client id&#x000A;GITHUB_APP_SECRET=replace with client secret&#x000A;</code></pre>
          
          <h2 id="generate-the-app">Generate the app</h2>
          
          <p>If you haven&#39;t installed <a href="http://seed.happyfuncorp.com">happy_seed</a> yet, do so now by typing <code>gem install happy_seed</code>.</p>
          
          <p>Then generate the app:</p>
          
          <pre><code>$ happy_seed rails project_stats&#x000A;</code></pre>
          
          <p>Now it&#39;s going to install things.  Inititally, just say no to everything.  Once it&#39;s done, install the github generator:</p>
          
          <pre><code>$ cd project_status&#x000A;$ rails g happy_seed:github&#x000A;</code></pre>
          
          <p>That will do its thing.  Then we need to create the database and get going:</p>
          
          <pre><code>$ rake db:migrate&#x000A;</code></pre>
          
          <h2 id="ask-for-more-scope">Ask for more scope</h2>
          
          <p>When the <em>github</em> generator is run, it configures the oauth scope that it requests in <code>config/initializers/devise.rb</code>.  We need to ask for a bit more permissions, so open up that file and change the scope requested to be <code>&quot;user,repo,read:org&quot;</code>, so:</p>
          
          <pre><code>config.omniauth :github, ENV[&#39;GITHUB_APP_ID&#39;], ENV[&#39;GITHUB_APP_SECRET&#39;], scope: &quot;user,repo,read:org&quot;&#x000A;</code></pre>
          
          <p>Now lets start the server and see what&#39;s up:</p>
          
          <pre><code>$ rails s&#x000A;</code></pre>
          
          <ol>
          <li>Point your browser to <a href="http://localhost:3000">http://localhost:3000</a></li>
          <li>Select &quot;Sign up&quot; from the &quot;Account&quot; menu.</li>
          <li>Press &quot;Sign in with Github&quot;</li>
          <li>You should be bounced to github and you have to accept.</li>
          <li>You should be back on localhost with the message <code>Successfully authenticated from Github account.</code></li>
          </ol>
          
          <h2 id="lets-play">Lets play</h2>
          
          <ol>
          <li><del>Get access to the API.</del></li>
          <li>Open up a console and start playing with commands.</li>
          <li>Start storing the data locally once we need to get more.</li>
          <li>Play around with the data.</li>
          <li>Design a UI around in.</li>
          <li>Refactor the test &quot;scripts&quot; into ruby classes that fit that UI.</li>
          </ol>
          
          <p>Lets get in that console and see what we can do.  If you look at <code>app/models/user.rb</code> you can see that there&#39;s code to setup the github client, and we can access it like so:</p>
          
          <pre><code>$ rails c&#x000A;Loading development environment (Rails 4.2.3)&#x000A;2.2.1 :001 &gt; gc = User.first.github_client&#x000A;  User Load (0.2ms)  SELECT  &quot;users&quot;.* FROM &quot;users&quot;  ORDER BY &quot;users&quot;.&quot;id&quot; ASC LIMIT 1&#x000A;  User Load (0.2ms)  SELECT  &quot;users&quot;.* FROM &quot;users&quot;  ORDER BY &quot;users&quot;.&quot;id&quot; ASC LIMIT 1&#x000A;  Identity Load (0.4ms)  SELECT  &quot;identities&quot;.* FROM &quot;identities&quot; WHERE &quot;identities&quot;.&quot;user_id&quot; = ? AND &quot;identities&quot;.&quot;provider&quot; = ?  ORDER BY &quot;identities&quot;.&quot;id&quot; ASC LIMIT 1  [[&quot;user_id&quot;, 1], [&quot;provider&quot;, &quot;github&quot;]]&#x000A;  Identity Load (0.4ms)  SELECT  &quot;identities&quot;.* FROM &quot;identities&quot; WHERE &quot;identities&quot;.&quot;user_id&quot; = ? AND &quot;identities&quot;.&quot;provider&quot; = ?  ORDER BY &quot;identities&quot;.&quot;id&quot; ASC LIMIT 1  [[&quot;user_id&quot;, 1], [&quot;provider&quot;, &quot;github&quot;]]&#x000A; =&gt; #&lt;Octokit::Client:0x007fe1f7bec7e8 &#x000A;&#x000A;2.2.1 :002 &gt; gc.org_repos( &#39;HappyFunCorp&#39;, {:type =&gt; &#39;private&#39;} ).count&#x000A; =&gt; 30 &#x000A;</code></pre>
          
          <p>Ok, now we can start figuring out what we need to do to get access to the data.  We have an authenticated user account, and we can start hitting the API.  I know for a fact that I have way more than 30 repos -- I mean, seriously -- so first thing is to figure out why that is and how to get more.  It&#39;s probably related to pagination.  </p>
          
          <pre><code>2.2.1 :003 &gt; gc.org_repos( &#39;HappyFunCorp&#39;, {:type =&gt; &#39;private&#39;, per_page: 100} ).count&#x000A; =&gt; 100 &#x000A;</code></pre>
          
          <p>OK, looking through the <a href="https://github.com/octokit/octokit.rb/issues/255">octokit issues</a> this can be dealt with by turning <code>auto_paginate: true</code> on when we load up the client.  So let&#39;s edit <code>app/models/user.rb</code> to do that:</p>
          
          <pre><code>@github_client ||= Octokit::Client.new(access_token: github.accesstoken, auto_paginate: true)&#x000A;</code></pre>
          
          <p>Back to the console, do <code>reload!</code> and load up our client again.  Notice that I&#39;m making this a one liner, since we&#39;re going to be doing it over and over its nice to use the arrow keys.</p>
          
          <pre><code>2.2.1 :004 &gt; reload!; gc = User.first.github_client&#x000A;Reloading...&#x000A;  User Load (0.1ms)  SELECT  &quot;users&quot;.* FROM &quot;users&quot;  ORDER BY &quot;users&quot;.&quot;id&quot; ASC LIMIT 1&#x000A;  User Load (0.1ms)  SELECT  &quot;users&quot;.* FROM &quot;users&quot;  ORDER BY &quot;users&quot;.&quot;id&quot; ASC LIMIT 1&#x000A;  Identity Load (0.2ms)  SELECT  &quot;identities&quot;.* FROM &quot;identities&quot; WHERE &quot;identities&quot;.&quot;user_id&quot; = ? AND &quot;identities&quot;.&quot;provider&quot; = ?  ORDER BY &quot;identities&quot;.&quot;id&quot; ASC LIMIT 1  [[&quot;user_id&quot;, 1], [&quot;provider&quot;, &quot;github&quot;]]&#x000A;  Identity Load (0.2ms)  SELECT  &quot;identities&quot;.* FROM &quot;identities&quot; WHERE &quot;identities&quot;.&quot;user_id&quot; = ? AND &quot;identities&quot;.&quot;provider&quot; = ?  ORDER BY &quot;identities&quot;.&quot;id&quot; ASC LIMIT 1  [[&quot;user_id&quot;, 1], [&quot;provider&quot;, &quot;github&quot;]]&#x000A; =&gt; #&lt;Octokit::Client:0x007fe1f7d986f0 @access_token=&quot;*.......&#x000A;&#x000A;2.2.1 :005 &gt; gc.org_repos( &#39;HappyFunCorp&#39;, {:type =&gt; &#39;private&#39;} ).count&#x000A; =&gt; 169 &#x000A;</code></pre>
          
          <p>OK, that looks better.  That will give us a list of all the repos, so now we just need to see how to get the contents of our file, and then we can put it all together.</p>
          
          <pre><code>2.2.1 :006 &gt; repo = gc.org_repos( &#39;HappyFunCorp&#39;, {:type =&gt; &#39;private&#39;} ).first&#x000A; =&gt; {:id=&gt;988713,&#x000A; :name=&gt;&quot;benchcoach&quot;,&#x000A; :full_name=&gt;&quot;HappyFunCorp/benchcoach&quot;,&#x000A; :owner=&gt;&#x000A; .....&#x000A;&#x000A;2.2.1 :007 &gt; repo.full_name&#x000A; =&gt; &quot;HappyFunCorp/benchcoach&quot; &#x000A;&#x000A;2.2.1 :008 &gt; content = gc.contents repo.full_name, path: &#39;Gemfile&#39;&#x000A; =&gt; {:name=&gt;&quot;Gemfile&quot;,&#x000A; :path=&gt;&quot;Gemfile&quot;,&#x000A; :sha=&gt;&quot;1d67bb85e43adab5b68ecc0eb3a5304e6ee2588e&quot;,....&#x000A;</code></pre>
          
          <p>Looking at this, we see that github returns the contents of the file base64 encoded.  I guess that makes sense, so if we want to print it out:</p>
          
          <pre><code>2.2.1 :009 &gt; Base64.decode64 content.content&#x000A;</code></pre>
          
          <h2 id="using-rake-to-pull-the-data-down">Using Rake to pull the data down</h2>
          
          <ol>
          <li><del>Get access to the API.</del></li>
          <li><del>Open up a console and start playing with commands.</del></li>
          <li>Start storing the data locally once we need to get more.</li>
          <li>Play around with the data.</li>
          <li>Design a UI around in.</li>
          <li>Refactor the test &quot;scripts&quot; into ruby classes that fit that UI.</li>
          </ol>
          
          <p>Lets use rake to start managing the data.  We&#39;re going to be using some of the techniques that were outlined in the <a href="/using-rake-for-dataflow-programming-and-data-science/]">using rake for dataflow programming and data science</a> post.  First step is to create a <code>lib/tasks/github.rake</code> file that we&#39;re going to put our tasks.</p>
          
          <pre><code>require &#39;fileutils&#39;&#x000A;&#x000A;file &quot;data/projects.json&quot; do&#x000A;  Rake::Task[&quot;environment&quot;].invoke&#x000A;  FileUtils.mkdir_p &quot;data&quot;&#x000A;&#x000A;  gc = User.first.github_client&#x000A;&#x000A;  data = gc.org_repos( &#39;HappyFunCorp&#39;, {:type =&gt; &#39;private&#39;} ).collect do |x|&#x000A;    { name: x[:name],&#x000A;      full_name: x[:full_name],&#x000A;      url: x[:url] }&#x000A;  end&#x000A;&#x000A;  File.open( &quot;data/projects.json&quot;, &quot;w&quot; ) do |out|&#x000A;    out.puts JSON.unparse( data )&#x000A;  end&#x000A;end&#x000A;</code></pre>
          
          <p><em>Be sure to change the <code>HappyFunCorp</code> to your organization, or use the <code>repos</code> call instead of the organization one.</em></p>
          
          <p>Now lets run <code>rake data/projects.json</code>.  If you run it a second time, notice that rake returns imediately and doesn&#39;t hit the remote server.</p>
          
          <ol>
          <li>The <code>file</code> task only runs if the file doesn&#39;t exist.</li>
          <li><code>Rake::Task[&quot;environment&quot;].invoke</code> is a way to ensure that a task as been run without forcing it to run.</li>
          <li>The API calls are from our console experiments.</li>
          <li>Just save it to a file.</li>
          </ol>
          
          <p>OK, now lets be able to loop over everything to load the files that we want.  First we define a method that lets us define a task to loop over all the entries in a JSON array, and then we&#39;ll call it with our block which loads up the contents.  (Add this to the end of the <code>github.rake</code> file)</p>
          
          <pre><code>def for_each_elem( name, file )&#x000A;  task name =&gt; file do&#x000A;    JSON.parse( File.read( file ) ).each do |record|&#x000A;      yield record&#x000A;    end&#x000A;  end&#x000A;end&#x000A;&#x000A;for_each_elem &quot;load_gemfiles&quot;, &quot;data/projects.json&quot; do |repo|&#x000A;  outfile = &quot;data/gemfiles/#{repo[&#39;name&#39;]}.Gemfile.lock&quot;&#x000A;  FileUtils.mkdir_p &quot;data/gemfiles&quot;&#x000A;&#x000A;  file outfile do&#x000A;    Rake::Task[&quot;environment&quot;].invoke&#x000A;&#x000A;    gc = User.first.github_client&#x000A;&#x000A;    begin&#x000A;      content = gc.contents repo[&#39;full_name&#39;], path: &#39;Gemfile.lock&#39;&#x000A;&#x000A;      File.open outfile, &quot;w&quot; do |out|&#x000A;        out.puts Base64.decode64 content.content&#x000A;      end&#x000A;    rescue Octokit::NotFound&#x000A;      puts &quot;No Gemfile.lock found for #{repo[&#39;full_name&#39;]}&quot;&#x000A;    end&#x000A;  end&#x000A;&#x000A;  Rake::Task[outfile].invoke&#x000A;end&#x000A;</code></pre>
          
          <p>And run it, <code>rake load_gemfiles</code>.  Depending upon how many repos you have, this could take a few seconds.  (Also make sure you&#39;ve updated the organization!)</p>
          
          <ol>
          <li>Define a file task for each output file, that we will <code>invoke</code> at the very end.</li>
          <li>Inside the task, make sure that the <code>environment</code> is loaded.</li>
          <li>Pull down the contents of the Gemfile.lock from the API.</li>
          </ol>
          
          <p>If you run this a second time, notice that it only attempts to load from the files that weren&#39;t loaded before.</p>
          
          <p>For fun, delete the <code>data</code> directly and run the rake task again.  BOOM!</p>
          
          <h2 id="massaging-the-data-into-something-usable">Massaging the data into something usable</h2>
          
          <ol>
          <li><del>Get access to the API.</del></li>
          <li><del>Open up a console and start playing with commands.</del></li>
          <li><del>Start storing the data locally once we need to get more.</del></li>
          <li>Play around with the data.</li>
          <li>Design a UI around in.</li>
          <li>Refactor the test &quot;scripts&quot; into ruby classes that fit that UI.</li>
          </ol>
          
          <p>OK, now that we have all the data, lets figure out how to slice and dice it.  Lets just wire together some standard UNIX tools to filter and get some info.</p>
          
          <pre><code>for_each_elem &quot;filter_gemfiles&quot;, &quot;data/projects.json&quot; do |repo|&#x000A;  sourcefile = &quot;data/gemfiles/#{repo[&#39;name&#39;]}.Gemfile.lock&quot;&#x000A;  outfile = &quot;data/filtered/#{repo[&#39;name&#39;]}.gems&quot;&#x000A;  FileUtils.mkdir_p &quot;data/filtered&quot;&#x000A;&#x000A;  if File.exists?( sourcefile )&#x000A;    file outfile do&#x000A;      system( &quot;awk &#39;/^    [^ ]/ { print $1, $2 }&#39; #{sourcefile} &gt; #{outfile}&quot; )&#x000A;    end&#x000A;    Rake::Task[outfile].invoke&#x000A;  end&#x000A;end&#x000A;</code></pre>
          
          <p>Running <code>rake filter_gemfiles</code> will go through and only show the specific gems that were locked out the Gemfile.locks.  Obviously, filtering the file based on the fact that it has exactly 4 spaces isn&#39;t robust, but it works.</p>
          
          <p>Lets add a couple of other nifty methods:</p>
          
          <pre><code>file &quot;data/versioned.list&quot; do&#x000A;  system( &quot;cat data/filtered/* | sort | uniq -c | sort -rn &gt; data/versioned.list&quot; )&#x000A;end&#x000A;&#x000A;file &quot;data/gems.list&quot; do&#x000A;  system( &quot;awk &#39;{print $1}&#39; data/filtered/* | sort | uniq -c | sort -rn &gt; data/gems.list&quot;)&#x000A;end&#x000A;</code></pre>
          
          <p>I&#39;m going to stop here, but in case you are wondering the top gems that we use are:</p>
          
          <ol>
          <li>(82) json</li>
          <li>(81) tzinfo</li>
          <li>(81) i18n</li>
          <li>(81) activesupport</li>
          <li>(79) rack</li>
          <li>(79) multi_json</li>
          <li>(78) sass</li>
          <li>(77) rack-test</li>
          <li>(76) tilt</li>
          <li>(76) mime-types</li>
          </ol>
          
          <h2 id="repeatable-data-in-10-minutes">Repeatable data in 10 minutes</h2>
          
          <p>There&#39;s lots of stuff you can do from there, the most likely one being &quot;sending an email and forgetting about it.&quot;  But lets look at what we have.</p>
          
          <ol>
          <li>The access key isn&#39;t hard coded anywhere.  When you come back to this, if it expires, you just reconnect on the website.</li>
          <li>Way easier to get access keys this way, only a few oauth providers make this simple.  (Twitter does, for example, github doesn&#39;t.)</li>
          <li>There&#39;s a direct process transitioning from &#39;playing around&#39; to automated.</li>
          <li>Loading the data from the remote API is automated and repeatable.  If you&#39;ve setup the dependancies correctly, you can run the rake tasks and things magically get up to date.</li>
          <li>If you do want to build a UI around this, you already have a webapp up and running...</li>
          </ol>
          
          <p>Importantly, this is something that you can get up and going with in under 10 minutes, at least if you know how the API works.  It takes less that 1 minute to get to the point where you have an authenticated client to the remote service and you can spend time exploring.</p>
          
          <p>One of the reasons I like having seed around to help prototype and explore ideas!</p>
          
          <p>Source code can be found: <a href="https://github.com/wschenk/project_stats_demo">https://github.com/wschenk/project_stats_demo</a></p>
        </div>
        <div class='navigation' data-offset-top='400' data-spy='affix'>
          <div class='next'>
            <p>
              Next in
              <a href="/articles/">Chronological</a>
              <a href="/tags/howto/">Howto</a>
            </p>
            <p class='title'><a href="/inflight-internet/">Inflight internet</a></p>
          </div>
          <div class='prev'>
            <p>
              Previously in
              <a href="/articles/">Chronological</a>
            </p>
            <p class='title'><a href="/building-a-gui-for-managing-middleman-blogs/">Building a GUI for managing middleman blogs</a></p>
            <p>
              Previously in
              <a href="/tags/happy_seed/">Happy_seed</a>
            </p>
            <p class='title'><a href="/setting-up-testing/">Setting up Rails testing with rspec, devise, and the gang</a></p>
            <p>
              Previously in
              <a href="/tags/rails/">Rails</a>
            </p>
            <p class='title'><a href="/bower-with-rails/">Bower with Rails</a></p>
            <p>
              Previously in
              <a href="/tags/howto/">Howto</a>
            </p>
            <p class='title'><a href="/adding-search-to-a-middleman-blog/">Adding search to a middleman blog</a></p>
            <p>
              Previously in
              <a href="/tags/rake/">Rake</a>
            </p>
            <p class='title'><a href="/using-rake-for-dataflow-programming-and-data-science/">Using rake for dataflow programming and data science</a></p>
          </div>
        </div>
      </div>
      <div class="row article_footer">
        <div class="comments">
            <a href="#" id="comment_shower">
              <p class="disqus-comment-count" data-disqus-identifier="2015-09-17-using-seed-to-explore.html">Be the first to comment.</p>
            </a>
        </div>
        <div class="sharing">
          <a href="http://www.twitter.com/share?url=http://willschenk.com/using-seed-to-explore/&amp;text=Using seed to explore APIs by @wschenk" title="Share this post on Twitter" data-lang="en" onclick="return !window.open(this.href, 'Twitter', 'width=640,height=300')" class="webicon twitter"></a>
      
          <a target="_blank" onclick="return !window.open(this.href, 'Facebook', 'width=640,height=300')" href="http://www.facebook.com/sharer/sharer.php?u=http://willschenk.com/using-seed-to-explore/" title="Share this post on Facebook" class="webicon facebook"></a>
      
          <a href="http://plus.google.com/share?url=http://willschenk.com/using-seed-to-explore/" target="_blank" onclick="return !window.open(this.href, 'Google +', 'width=640,height=300')" title="Share this post on Google +" class="webicon google"></a>
        </div>
      </div>
        <div class="comment_row">
          <div class="comment_universe">
            <div id="disqus_thread" class="col-sm-10 col-sm-offset-1"></div>
          </div>
        </div>
    </div>
    <footer class='codex'>
      <div class='container'>
        <div class='row'>
          <div class='logo'>
            <a href='http://codex.happyfuncorp.com/'>
              <img src="../images/ted-16edc59a.png" />
              <img src="../images/codex_logo-02a37740.png" />
            </a>
          </div>
        </div>
        <div class='row'>
          <div class='body'>
            <h3>
              If you find this blog helpful, check out
              <a href='http://codex.happyfuncorp.com/'>
                codex
              </a>
            </h3>
            <p>Product, development, design and a whole slew of other things you need to know.</p>
            <p>
              From the fancy folks at
              <a href="http://happyfuncorp.com">HappyFunCorp</a>
            </p>
          </div>
        </div>
      </div>
    </footer>
    <footer class='footer  '>
      <div class='container'>
        <div class='row'>
          <div class='social'>
            <span>
              <a class='webicon twitter' href='http://twitter.com/wschenk'></a>
            </span>
            <span>
              <a class='webicon tumblr' href='http://sublimeguile.com/'></a>
            </span>
            <span>
              <a class='webicon instagram' href='http://instagram.com/wschenk'></a>
            </span>
            <span>
              <a class='webicon linkedin' href='http://www.linkedin.com/pub/will-schenk/0/266/420/'></a>
            </span>
            <span>
              <a class='webicon github' href='https://github.com/wschenk'></a>
            </span>
            <span>
              <a class='webicon rss' href='http://willschenk.com/feed.xml'></a>
            </span>
            <span>
              <a class='webicon mail' href='mailto:will@happyfuncorp.com'></a>
            </span>
          </div>
          <div class='made_in_bk'>
            <h3>Made in Brooklyn, NY</h3>
          </div>
        </div>
      </div>
    </footer>
    <script src="../javascripts/application-b5017286.js" type="text/javascript"></script><script src="../javascripts/modernizr-84a49412.js" type="text/javascript"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.3/highlight.min.js"></script>
    <script type="text/javascript">
      var _gaq=[['_setAccount','UA-56296045-1'],['_trackPageview']];
      (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
      g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
      s.parentNode.insertBefore(g,s)}(document,'script'));
    </script>
    
    <script type="text/javascript">
      hljs.initHighlightingOnLoad();
      $(".article img").addClass( "img-responsive");
      $("iframe").map( function(e) {
        $(this).css( "max-width", $(this).width() );
        $(this).width( "100%" );
      });
      var _gaq=[['_setAccount','UA-56296045-1'],['_trackPageview']];
      (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
      g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
      s.parentNode.insertBefore(g,s)}(document,'script'));
      var disqus_shortname = 'willschenk';
      var disqus_url = 'http://willschenk.com/using-seed-to-explore/';
        var disqus_identifier = '2015-09-17-using-seed-to-explore.html';
            
      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
      (function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
    </script>
  </body>
</html>
