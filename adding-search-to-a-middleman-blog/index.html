<!DOCTYPE html>
<html class='no-js'>
  <head>
    <meta charset='utf-8'>
    <meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
    <title>Adding search to a middleman blog | Blank Page Tech</title>
    <meta name="site" content="Blank Page Tech" />
    <meta name="og:site_name" content="Blank Page Tech" />
    <meta name="title" content="Adding search to a middleman blog" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Adding search to a middleman blog" />
    <meta name="twitter:site" content="@wschenk" />
    <meta name="og:title" content="Adding search to a middleman blog" />
    <meta content='width=device-width' name='viewport'>
    <link href="../stylesheets/application-635fa4f1.css" rel="stylesheet" type="text/css" /><link href="../stylesheets/webicons-da5ecace.css" rel="stylesheet" type="text/css" /><link href="../stylesheets/googlecode-d3629bf4.css" rel="stylesheet" type="text/css" />
    <link href='//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.3/styles/default.min.css' rel='stylesheet'>
    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />
  </head>
  <body data-spy='scroll' data-target='.sidebar'>
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">
      <div class='visible-xs-block'>
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapsable">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a href="/" class="navbar-brand">
        Blank Page Tech
      </a>
        
      </div>
    </div>
    <div class='hidden-xs'>
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapsable">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a href="/" class="navbar-brand">
        Technology for the blank page
      </a>
        
      </div>
    </div>
    <div class="collapse navbar-collapse" id="navbar-collapsable">
      <ul class="nav navbar-nav navbar-right foo" id="menu">
      <li>
      <a href="/articles/">
        Articles
      </a>
    </li>
    <li class="dropdown">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown">Topics <b class="caret"></b></a>
      <ul class="dropdown-menu">
        <li>
      <a href="/tags/howto/">
        Howtos
      </a>
    </li>
    <li>
      <a href="/tags/overview/">
        Overviews
      </a>
    </li>
    <li>
      <a href="/tags/product/">
        Product
      </a>
    </li>
    <li>
      <a href="/tags/tools/">
        Tools
      </a>
    </li>
    <li>
      <a href="/tags/socialinvestigator/">
        Social Investigator
      </a>
    </li>
    <li>
      <a href="/tags/ruby/">
        Ruby & Rails
      </a>
    </li>
    
      </ul>
    </li>
    <li class="dropdown">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tags <b class="caret"></b></a>
      <ul class="dropdown-menu">
        <li>
      <a href="/bootstrap-advanced-grid-tricks/">
        bootstrap (1)
      </a>
    </li>
    <li>
      <a href="/tags/bots/">
        bots (2)
      </a>
    </li>
    <li>
      <a href="/using-rake-for-dataflow-programming-and-data-science/">
        data (1)
      </a>
    </li>
    <li>
      <a href="/osx-script-for-kiosk-mode/">
        gaze (1)
      </a>
    </li>
    <li>
      <a href="/pulling-data-out-of-google-analytics/">
        googleanalytics (1)
      </a>
    </li>
    <li>
      <a href="/tags/happy_seed/">
        happy_seed (3)
      </a>
    </li>
    <li>
      <a href="/tags/howto/">
        howto (15)
      </a>
    </li>
    <li>
      <a href="/bower-with-rails/">
        javascript (1)
      </a>
    </li>
    <li>
      <a href="/tags/middleman/">
        middleman (6)
      </a>
    </li>
    <li>
      <a href="/setting-up-devise-with-twitter-and-facebook-and-other-omniauth-schemes-without-email-addresses/">
        oauth (1)
      </a>
    </li>
    <li>
      <a href="/tags/osx/">
        osx (2)
      </a>
    </li>
    <li>
      <a href="/tags/overview/">
        overview (4)
      </a>
    </li>
    <li>
      <a href="/tags/product/">
        product (2)
      </a>
    </li>
    <li>
      <a href="/tags/rails/">
        rails (4)
      </a>
    </li>
    <li>
      <a href="/using-rake-for-dataflow-programming-and-data-science/">
        rake (1)
      </a>
    </li>
    <li>
      <a href="/building-a-gui-for-managing-middleman-blogs/">
        react (1)
      </a>
    </li>
    <li>
      <a href="/how-to-track-your-coworkers/">
        redis (1)
      </a>
    </li>
    <li>
      <a href="/tags/ruby/">
        ruby (16)
      </a>
    </li>
    <li>
      <a href="/receiving-posted-json-with-sinatra/">
        sinatra (1)
      </a>
    </li>
    <li>
      <a href="/tags/socialinvestigator/">
        socialinvestigator (4)
      </a>
    </li>
    <li>
      <a href="/dateslice-writing-rails-extensions/">
        sql (1)
      </a>
    </li>
    <li>
      <a href="/field-of-dreams-is-25-years-old-and-hasn-t-aged-well/">
        startupmyths (1)
      </a>
    </li>
    <li>
      <a href="/tags/static_sites/">
        static_sites (2)
      </a>
    </li>
    <li>
      <a href="/setting-up-testing/">
        testing (1)
      </a>
    </li>
    <li>
      <a href="/making-a-command-line-utility-with-gems-and-thor/">
        thor (1)
      </a>
    </li>
    <li>
      <a href="/tags/tools/">
        tools (5)
      </a>
    </li>
    <li>
      <a href="/tags/toys/">
        toys (4)
      </a>
    </li>
    
      </ul>
    </li>
    <li class="dropdown">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown">Archives <b class="caret"></b></a>
      <ul class="dropdown-menu">
        <li>
      <a href="/2015/07/">
        Jul 2015 (3)
      </a>
    </li>
    <li class="active">
      <a href="/adding-search-to-a-middleman-blog/">
        Jun 2015 (1)
      </a>
    </li>
    <li>
      <a href="/2015/05/">
        May 2015 (2)
      </a>
    </li>
    <li>
      <a href="/why-engineers-build-crappy-products/">
        Feb 2015 (1)
      </a>
    </li>
    <li>
      <a href="/2015/01/">
        Jan 2015 (2)
      </a>
    </li>
    <li>
      <a href="/2014/12/">
        Dec 2014 (5)
      </a>
    </li>
    <li>
      <a href="/2014/11/">
        Nov 2014 (10)
      </a>
    </li>
    <li>
      <a href="/how-to-track-your-coworkers/">
        Oct 2014 (1)
      </a>
    </li>
    
      </ul>
    </li>
    
    </ul>
    <form class='navbar-form navbar-right' id='search' role='search'>
      <div class='form-group dropdown'>
        <div class='input-group'>
          <input autocomplete='off' class='form-control' id='search_box' placeholder='Search' type='text'>
          <span class='input-group-btn'>
            <button class='btn btn-default'>
              <span class='glyphicon glyphicon-search'></span>
            </button>
          </span>
        </div>
        <ul class='dropdown-menu dropdown-menu-left results'>
          <a href="/url">Title</a>
        </ul>
      </div>
    </form>
    
    </div>
    
    </div>
    </nav>
    <div class='article-header  '>
      <h1>Adding search to a middleman blog</h1>
      <h2>slightly simplier than google</h2>
      <div class='tags'>
        <div class='tag'><a class="btn btn-primary" href="/tags/howto/">howto</a></div>
        <div class='tag'><a class="btn btn-primary" href="/tags/middleman/">middleman</a></div>
        <div class='tag'><a class="btn btn-primary" href="/tags/ruby/">ruby</a></div>
      </div>
      <a href='#comment_shower' id='comment_shower_scroll'>
        <span class='disqus-comment-count' data-disqus-identifier='2015-06-07-adding-search-to-a-middleman-blog.html'></span>
      </a>
    </div>
    <div class='content'>
      <div class='row'>
        <div class='sidebar'>
          <ul class='nav toc' data-offset-top='400' data-spy='affix'>
            <li><a href="#top">Adding search to a middleman blog</a></li>
            <li><a href="#building-the-index">Building the index</a></li>
            <li><a href="#now-lets-add-some-markup-to-the-blog">Now lets add some markup to the blog</a></li>
            <li><a href="#loading-and-querying-the-index">Loading and Querying the index</a></li>
            <li><a href="#wiring-it-up">Wiring it up</a></li>
            <li><a href="#next-steps">Next steps</a></li>
          </ul>
        </div>
        <div class='article' id='top'>
          <p>We&#39;re going to build a simple, niave search for middleman blogs.  We&#39;re going to build a <em>search index</em> at build time, and then use that index to perform the search itself on the client side.</p>
          
          <h2 id="building-the-index">Building the index</h2>
          
          <p>When you typed in something in google, it doesn&#39;t then go and hit every page on the internet to check to see if there&#39;s a match.  It doesn&#39;t even look at every page that it has squirreled away somewhere in the googleplex.  What it consults is an <em>index</em> of the documents out there, and the index points to the page information.  (We all know that it&#39;s a lot more complicated than that really, but run with it.)</p>
          
          <p>First thing we&#39;re going to do is create a very simple version of this index for your site.  This is going to be in a file called <code>source/article.index.json.erb</code>.</p>
          
          <ol>
          <li>Go through all of the articles.</li>
          <li>Add meta data for the article into the master map.</li>
          <li>Find all of the words in the article, by stripping out all of the html tags, making things lowercase, and breaking it apart by white space.</li>
          <li>Insert all of those words into our index.</li>
          <li>Convert the whole sucker to JSON.</li>
          </ol>
          
          <pre><code class="erb">&lt;%&#x000A;  map = {articles:{}}&#x000A;  index = {}&#x000A;  blog.articles.each do |article|&#x000A;    map[:articles][article.url] = {&#x000A;      title: article.title, &#x000A;      date: article.date, &#x000A;      tags: article.tags &#x000A;    }&#x000A;&#x000A;    words = &quot;#{article.title} #{article.body}&quot;&#x000A;    words = words&#x000A;      .downcase              # make lowercase&#x000A;      .gsub( /&lt;.*?&gt;/, &quot;&quot; )   # get rid of tags&#x000A;      .gsub( /[^\w ]/, &quot;&quot; )  # get rid of not letters&#x000A;      .split( /\s+/ )        # split by words&#x000A;      .sort.uniq&#x000A;&#x000A;    words.each do |w|&#x000A;      index[w] ||= []&#x000A;      index[w] &lt;&lt; article.url&#x000A;    end&#x000A;  end&#x000A;  map[:index] = index&#x000A;%&gt;&#x000A;&lt;%= map.to_json %&gt;&#x000A;</code></pre>
          
          <h2 id="now-lets-add-some-markup-to-the-blog">Now lets add some markup to the blog</h2>
          
          <p>I&#39;m sticking this in the header, as you see above:</p>
          
          <pre><code class="haml">%form.navbar-form.navbar-right#search{ role: &quot;search&quot; }&#x000A;  .form-group.dropdown&#x000A;    .input-group&#x000A;      %input.form-control#search_box{ type: &quot;text&quot;, placeholder: &quot;Search&quot;, autocomplete: &quot;off&quot; }&#x000A;      %span.input-group-btn&#x000A;        %button.btn.btn-default&#x000A;          %span.glyphicon.glyphicon-search&#x000A;    %ul.dropdown-menu.dropdown-menu-left.results&#x000A;      = link_to &quot;Title&quot;, &quot;/url&quot;&#x000A;</code></pre>
          
          <h2 id="loading-and-querying-the-index">Loading and Querying the index</h2>
          
          <p>Ok, lets build this from the ground up.  All this goes into <code>application.js</code>.First we&#39;re create a method that loads up the index if we need it.  We&#39;re going to use a promise here, so if multiple request come in at the same time only one will go to the server:</p>
          
          <pre><code class="js">var article_index = function() {&#x000A;  if( window.article_promise === undefined ) {&#x000A;    console.log( &quot;Loading article index&quot; );&#x000A;    window.article_promise = $.Deferred();&#x000A;&#x000A;    $.get( &quot;/articles.index.json&quot; ).done( function(data) {&#x000A;      console.log( &quot;Loaded article index&quot; );&#x000A;      window.article_promise.resolve( data );&#x000A;    } );&#x000A;  }&#x000A;&#x000A;  return window.article_promise;&#x000A;}&#x000A;</code></pre>
          
          <p>This is called like <code>article_index().done( function( index ) { console.log( index )})</code>  The second time it calls, it returns the first promise again so everything is nice and fast.</p>
          
          <p>To query the index itself we need to look through all of the words and return a list of urls that match:</p>
          
          <pre><code class="js">var match_index = function( word, index ) {&#x000A;  var result = [];&#x000A;  var matcher = new RegExp( word );&#x000A;&#x000A;  $.each( index.index, function( i ) {&#x000A;    if( matcher.exec( i ) ) {&#x000A;      $.each( index.index[i], function( idx, url ) {&#x000A;        if( result.indexOf( url ) &lt; 0 ) {&#x000A;          result.push( url );&#x000A;        }&#x000A;      } );&#x000A;    }&#x000A;  });&#x000A;&#x000A;  return result;&#x000A;}&#x000A;</code></pre>
          
          <p>Now lets build a simple search.  This is a little complicated, since we need to compute the intersection of the results if the user types in multiple words.  Here&#39;s what&#39;s happening:</p>
          
          <ol>
          <li>We create a promise, since we may need wait for the index to load.</li>
          <li>We split the search term into multiple words.</li>
          <li>Collect the results of the <code>match_index</code> function.</li>
          <li>Compute the intersections of all the results</li>
          <li>Look up the meta data based on the url.</li>
          <li>Resolve the promise with the results.</li>
          </ol>
          
          <pre><code class="js">var find_article = function( search ) {&#x000A;  var search_results = $.Deferred();&#x000A;&#x000A;  article_index().done( function( index ) {&#x000A;    // Split the search by widespace&#x000A;    var words = search.toLowerCase().replace(/\s+$/, &#39;&#39;).split( /\s+/ );&#x000A;&#x000A;    // Lookup the matches for each word&#x000A;    // Note using $.map seems to flatten the result.&#x000A;    var full_results = [];&#x000A;    $.each( words, function( i, word ) {&#x000A;      full_results.push( match_index( word, index ) );&#x000A;    } );&#x000A;&#x000A;    var urls = full_results[0];&#x000A;&#x000A;    // If there are multiple words, compute the intersection&#x000A;    if( full_results.length &gt; 1 ) {&#x000A;      var url_counts = {}&#x000A;      $.each( full_results, function( i, set ) {&#x000A;        $.each( set, function( i, url ) {&#x000A;          url_counts[url] = (url_counts[url]||0)+1;&#x000A;        } )&#x000A;      } );&#x000A;&#x000A;      urls = [];&#x000A;      $.each( url_counts, function( url, count ) {&#x000A;        if( count == full_results.length ) {&#x000A;          urls.push( url );&#x000A;        }&#x000A;      } );&#x000A;    }&#x000A;&#x000A;    // Pull in the metadata&#x000A;    var results = {};&#x000A;    $.each( urls, function( i, url ) {&#x000A;      results[url] = index.articles[url];&#x000A;    } );&#x000A;&#x000A;    search_results.resolve( results );&#x000A;  });&#x000A;&#x000A;  return search_results;&#x000A;};&#x000A;</code></pre>
          
          <h2 id="wiring-it-up">Wiring it up</h2>
          
          <p>First we need to call our code when the user inputs something in the text area:</p>
          
          <pre><code class="js">$(function() {&#x000A;  $( &quot;#search_box&quot; ).on( &#39;input&#39;, search_typing );&#x000A;});&#x000A;</code></pre>
          
          <p>Then we wire everything together:</p>
          
          <ol>
          <li>If the field is empty, hide the dropdown.</li>
          <li>Otherwise show the dropdown and a loading message</li>
          <li>Call <code>find_article</code> and when it returns</li>
          <li>Put the results in the result dropdown.</li>
          </ol>
          
          <pre><code class="js">var search_typing = function() {&#x000A;  var val = $(this).val();&#x000A;&#x000A;  if( val == &quot;&quot; ) {&#x000A;    $(&quot;#search .dropdown&quot;).removeClass( &quot;open&quot; );&#x000A;  } else {&#x000A;    $(&quot;#search .dropdown&quot;).addClass( &quot;open&quot; );&#x000A;    $(&quot;#search .dropdown-menu&quot;).html(&quot;&lt;li class=&#39;disabled&#39;&gt;&lt;a href=&#39;#&#39;&gt;Loading &quot; + val +&quot;&lt;/a&gt;&lt;/li&gt;&quot;)&#x000A;    find_article( val ).done( function(results) {&#x000A;      var menu = $(&quot;#search .dropdown-menu&quot;).html(&quot;&quot;);&#x000A;      if( $.isEmptyObject( results ) ) {&#x000A;        $(&quot;#search .dropdown-menu&quot;).html(&quot;&lt;li class=&#39;disabled&#39;&gt;&lt;a href=&#39;#&#39;&gt;No results for: &quot; + val +&quot;&lt;/a&gt;&lt;/li&gt;&quot;)&#x000A;      }&#x000A;      $.each( results, function( url, info ) {&#x000A;        menu.append( &quot;&lt;li&gt;&lt;a href=\&quot;&quot; + url + &quot;\&quot;&gt;&quot; + info.title + &quot;&lt;/a&gt;&lt;/li&gt;&quot;);&#x000A;      });&#x000A;    });&#x000A;  }&#x000A;}&#x000A;</code></pre>
          
          <h2 id="next-steps">Next steps</h2>
          
          <ol>
          <li>Language stemming</li>
          <li>Logical operations</li>
          <li>Showing more metadata in the search results.</li>
          </ol>
        </div>
        <div class='navigation' data-offset-top='400' data-spy='affix'>
          <div class='next'>
            <p>
              Next in
              <a href="/articles/">Chronological</a>
            </p>
            <p class='title'><a href="/bower-with-rails/">Bower with Rails</a></p>
            <p>
              Next in
              <a href="/tags/middleman/">Middleman</a>
            </p>
            <p class='title'><a href="/building-a-gui-for-managing-middleman-blogs/">Building a GUI for managing middleman blogs</a></p>
            <p>
              Next in
              <a href="/tags/ruby/">Ruby</a>
            </p>
            <p class='title'><a href="/receiving-posted-json-with-sinatra/">Receiving posted JSON with Sinatra</a></p>
          </div>
          <div class='prev'>
            <p>
              Previously in
              <a href="/articles/">Chronological</a>
              <a href="/tags/howto/">Howto</a>
            </p>
            <p class='title'><a href="/osx-script-for-kiosk-mode/">OSX Script for Kiosk Mode</a></p>
            <p>
              Previously in
              <a href="/tags/middleman/">Middleman</a>
              <a href="/tags/ruby/">Ruby</a>
            </p>
            <p class='title'><a href="/slow-data-and-fast-sites/">Slow data and Fast Sites</a></p>
          </div>
        </div>
      </div>
      <div class="row article_footer">
        <div class="comments">
            <a href="#" id="comment_shower">
              <p class="disqus-comment-count" data-disqus-identifier="2015-06-07-adding-search-to-a-middleman-blog.html">Be the first to comment.</p>
            </a>
        </div>
        <div class="sharing">
          <a href="http://www.twitter.com/share?url=http://willschenk.com/adding-search-to-a-middleman-blog/&amp;text=Adding search to a middleman blog by @wschenk" title="Share this post on Twitter" data-lang="en" onclick="return !window.open(this.href, 'Twitter', 'width=640,height=300')" class="webicon twitter"></a>
      
          <a target="_blank" onclick="return !window.open(this.href, 'Facebook', 'width=640,height=300')" href="http://www.facebook.com/sharer/sharer.php?u=http://willschenk.com/adding-search-to-a-middleman-blog/" title="Share this post on Facebook" class="webicon facebook"></a>
      
          <a href="http://plus.google.com/share?url=http://willschenk.com/adding-search-to-a-middleman-blog/" target="_blank" onclick="return !window.open(this.href, 'Google +', 'width=640,height=300')" title="Share this post on Google +" class="webicon google"></a>
        </div>
      </div>
        <div class="comment_row">
          <div class="comment_universe">
            <div id="disqus_thread" class="col-sm-10 col-sm-offset-1"></div>
          </div>
        </div>
    </div>
    <footer class='codex'>
      <div class='container'>
        <div class='row'>
          <div class='logo'>
            <a href='http://codex.happyfuncorp.com/'>
              <img src="../images/ted-16edc59a.png" />
              <img src="../images/codex_logo-02a37740.png" />
            </a>
          </div>
        </div>
        <div class='row'>
          <div class='body'>
            <h3>
              If you find this blog helpful, check out
              <a href='http://codex.happyfuncorp.com/'>
                codex
              </a>
            </h3>
            <p>Product, development, design and a whole slew of other things you need to know.</p>
            <p>
              From the fancy folks at
              <a href="http://happyfuncorp.com">HappyFunCorp</a>
            </p>
          </div>
        </div>
      </div>
    </footer>
    <footer class='footer  '>
      <div class='container'>
        <div class='row'>
          <div class='social'>
            <span>
              <a class='webicon twitter' href='http://twitter.com/wschenk'></a>
            </span>
            <span>
              <a class='webicon tumblr' href='http://sublimeguile.com/'></a>
            </span>
            <span>
              <a class='webicon instagram' href='http://instagram.com/wschenk'></a>
            </span>
            <span>
              <a class='webicon linkedin' href='http://www.linkedin.com/pub/will-schenk/0/266/420/'></a>
            </span>
            <span>
              <a class='webicon github' href='https://github.com/wschenk'></a>
            </span>
            <span>
              <a class='webicon rss' href='http://willschenk.com/feed.xml'></a>
            </span>
            <span>
              <a class='webicon mail' href='mailto:will@happyfuncorp.com'></a>
            </span>
          </div>
          <div class='made_in_bk'>
            <h3>Made in Brooklyn, NY</h3>
          </div>
        </div>
      </div>
    </footer>
    <script src="../javascripts/application-b5017286.js" type="text/javascript"></script><script src="../javascripts/modernizr-84a49412.js" type="text/javascript"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.3/highlight.min.js"></script>
    <script type="text/javascript">
      var _gaq=[['_setAccount','UA-56296045-1'],['_trackPageview']];
      (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
      g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
      s.parentNode.insertBefore(g,s)}(document,'script'));
    </script>
    
    <script type="text/javascript">
      hljs.initHighlightingOnLoad();
      $(".article img").addClass( "img-responsive");
      $("iframe").map( function(e) {
        $(this).css( "max-width", $(this).width() );
        $(this).width( "100%" );
      });
      var _gaq=[['_setAccount','UA-56296045-1'],['_trackPageview']];
      (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
      g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
      s.parentNode.insertBefore(g,s)}(document,'script'));
      var disqus_shortname = 'willschenk';
      var disqus_url = 'http://willschenk.com/adding-search-to-a-middleman-blog/';
        var disqus_identifier = '2015-06-07-adding-search-to-a-middleman-blog.html';
            
      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
      (function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
    </script>
  </body>
</html>
