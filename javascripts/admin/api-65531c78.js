(function(){this.API={loadUrl:function(n){return console.log("Loading",n),this.promises||(console.log("Creating promise"),this.promises={}),this.promises[n]||(console.log("Fetching",n),this.promises[n]=$.Deferred(),$.ajax(n).success(function(o){return function(t){return console.log("Got back: ",t),console.log(o.promises[n]),o.promises[n].resolve(t)}}(this),function(o){return function(t){return o.promises[n].reject(t)}}(this))),this.promises[n]},loadPost:function(n){var o;return o=$.Deferred(),$.ajax("/api/post",{data:{path:n}}).success(function(){return function(n){return console.log("Got post back",n),o.resolve(n)}}(this)).fail(function(){return function(n){return o.reject(n.responseJSON)}}(this)),o},savePost:function(n,o,t){var e;return e=$.Deferred(),$.ajax("/api/post",{method:"POST",data:{path:n,meta:o,body:t}}).success(function(){return function(n){return console.log("Saved post"),e.resolve(n)}}(this)).fail(function(){return function(n){return console.log("Error saving post"),e.reject(n.responseJSON)}}(this)),e},newDraft:function(n){return $.post("/api/drafts",n)},publishDraft:function(n){return $.post("/api/publish",{path:n})},uploadFile:function(n,o,t){var e;return console.log("Uploading image to path"),e=new FormData,e.append("path",n),e.append("file",o.dataTransfer.files[0]),$.ajax({type:"post",url:"/api/images",xhr:function(){var n;return n=new XMLHttpRequest,n.upload.onprogress=t,n},cache:!1,contentType:!1,processData:!1,data:e})},runCommand:function(n,o){var t;return console.log("Running command",n,o),t=function(n){return console.log("Got change"),console.log(n),!0},$.ajax({type:"post",url:"/api/"+n,data:{path:o},xhr:function(){var n;return n=new XMLHttpRequest,n.onprogress=t,n}})},loadDrafts:function(){return this.loadUrl("/admin/drafts.json")},loadPublished:function(){return this.loadUrl("/admin/published.json")}}}).call(this);