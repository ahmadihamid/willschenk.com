(function(){this.runCommand=Reflux.createAction({asyncResult:!0}),this.createNewDraft=Reflux.createAction({asyncResult:!0}),this.runLater=function(t,e){return function(){return runCommand(t,e)}},this.commandResultStore=Reflux.createStore({init:function(){return this.state=this.defaultState(),this.listenTo(runCommand,this.onRunCommand),this.listenTo(createNewDraft,this.onCreateNewDraft)},defaultState:function(){return{command:"",running:!1,result:""}},onRunCommand:function(t,e){return console.log("Running command",t,e),this.state=this.defaultState(),this.state.running=!0,this.state.result="",this.state.command=t,this.trigger(this.state),request.post("/api/"+t).query({path:e}).end(function(t){return function(e,n){return console.log(n),n.ok?(runCommand.completed(n.body),t.state.running=!1,t.state.result=n.text,t.trigger(t.state)):runCommand.failed(n.error)}}(this))},onCreateNewDraft:function(t){return window.LiveReload&&window.LiveReload.shutDown(),console.log("Creating new draft",t),this.state=this.defaultState(),this.state.running=!0,this.state.command="Creating new draft",this.trigger(this.state),request.post("/api/drafts").type("form").send(t).end(function(t){return function(e,n){return n.ok?(t.state.running=!1,t.state.result=n.text,t.state.command="",t.trigger(t.state),viewPath(n.body.created)):void 0}}(this))}})}).call(this);