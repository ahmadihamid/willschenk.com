(function(){this.viewPath=Reflux.createAction({asyncResult:!0}),this.updateMarkdown=Reflux.createAction(),this.updateMetadata=Reflux.createAction(),this.saveCurrentArticle=Reflux.createAction(),this.pathStore=Reflux.createStore({init:function(){return this.state=this.defaultState(),this.listenTo(viewPath,this.onViewPath),this.listenTo(updateMarkdown,this.onUpdateMarkdown),this.listenTo(updateMetadata,this.onUpdateMetadata),this.listenTo(saveCurrentArticle,this.onSaveCurrentArticle)},defaultState:function(){return{loading:!1,dirty:!1,path:null,metadata:{},markdown:""}},onViewPath:function(t){return console.log("Loading path",t),this.state=this.defaultState(),this.state.path=t,this.state.loading=!0,this.trigger(this.state),request.get("/api/post").query({path:t}).end(function(t){return function(e,a){var i;return console.log(a),a.ok?(viewPath.completed(a.body),i=a.body,t.state.loading=!1,t.state.metadata=i.meta,t.state.markdown=i.content,t.trigger(t.state)):viewPath.failed(a.error)}}(this))},onUpdateMetadata:function(t){return this.state.metadata=t,this.state.dirty=!0,this.trigger(this.state)},onUpdateMarkdown:function(t){return this.state.markdown=t,this.state.dirty=!0,this.trigger(this.state)},onSaveCurrentArticle:function(){return this.state.saving=!0,this.trigger(this.state),request.post("/api/post").set("Content-Type","application/json").send({path:this.state.path,meta:this.state.metadata,body:this.state.markdown}).end(function(t){return function(e,a){return a.ok?(t.state.saving=!1,t.state.dirty=!1,t.trigger(t.state)):void 0}}(this))}})}).call(this);